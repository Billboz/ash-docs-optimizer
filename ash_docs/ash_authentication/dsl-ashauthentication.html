<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.34.2">
    <meta name="project" content="ash_authentication v4.0.4">


    <title>DSL: AshAuthentication — ash_authentication v4.0.4</title>
    <link rel="stylesheet" href="dist/html-elixir-F2VRIOKR.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-K7URE6B4.js"></script>
    <script src="dist/sidebar_items-BF9EDA45.js"></script>
    <script src="docs_config.js"></script>
    <script async src="dist/html-YIPIRHGU.js"></script>
<script>
  if (location.hostname === "hexdocs.pm") {
    var script = document.createElement("script");
    script.src = "https://plausible.io/js/script.js";
    script.setAttribute("defer", "defer")
    script.setAttribute("data-domain", "ashhexdocs")
    document.head.appendChild(script);
  }
</script>

  </head>
  <body data-type="extras" class="page-extra">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="readme.html" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="ash_authentication" />
        </a>

      <div>
        <a href="readme.html" class="sidebar-projectName" translate="no">
ash_authentication
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v4.0.4
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
GUIDES
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


</nav>

<main class="content">
  <output role="status" id="toast"></output>

  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of ash_authentication</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search">
            <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <h1>

      <a href="https://github.com/team-alembic/ash_authentication/blob/main/documentation/dsls/DSL:-AshAuthentication.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>


    <span>DSL: AshAuthentication</span>
  </h1>

<p>AshAuthentication provides a turn-key authentication solution for folks using
<a href="https://www.ash-hq.org/">Ash</a>.</p><h2 id="usage" class="section-heading">
  <a href="#usage" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Usage</span>
</h2>
<p>This package assumes that you have <a href="https://ash-hq.org/">Ash</a> installed and
configured.  See the Ash documentation for details.</p><p>Once installed you can easily add support for authentication by configuring
the <a href="AshAuthentication.html"><code class="inline">AshAuthentication</code></a> extension on your resource:</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">MyApp.Accounts.User</span><span class="w"> </span><span class="k" data-group-id="6681594100-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Ash.Resource</span><span class="p">,</span><span class="w">
    </span><span class="ss">extensions</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6681594100-2">[</span><span class="nc">AshAuthentication</span><span class="p" data-group-id="6681594100-2">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">domain</span><span class="p">:</span><span class="w"> </span><span class="nc">MyApp.Accounts</span><span class="w">

  </span><span class="n">attributes</span><span class="w"> </span><span class="k" data-group-id="6681594100-3">do</span><span class="w">
    </span><span class="n">uuid_primary_key</span><span class="w"> </span><span class="ss">:id</span><span class="w">
    </span><span class="n">attribute</span><span class="w"> </span><span class="ss">:email</span><span class="p">,</span><span class="w"> </span><span class="ss">:ci_string</span><span class="p">,</span><span class="w"> </span><span class="ss">allow_nil?</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="w">
    </span><span class="n">attribute</span><span class="w"> </span><span class="ss">:hashed_password</span><span class="p">,</span><span class="w"> </span><span class="ss">:string</span><span class="p">,</span><span class="w"> </span><span class="ss">allow_nil?</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p">,</span><span class="w"> </span><span class="ss">sensitive?</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="w">
  </span><span class="k" data-group-id="6681594100-3">end</span><span class="w">

  </span><span class="n">authentication</span><span class="w"> </span><span class="k" data-group-id="6681594100-4">do</span><span class="w">
    </span><span class="n">strategies</span><span class="w"> </span><span class="k" data-group-id="6681594100-5">do</span><span class="w">
      </span><span class="n">password</span><span class="w"> </span><span class="ss">:password</span><span class="w"> </span><span class="k" data-group-id="6681594100-6">do</span><span class="w">
        </span><span class="n">identity_field</span><span class="w"> </span><span class="ss">:email</span><span class="w">
        </span><span class="n">hashed_password_field</span><span class="w"> </span><span class="ss">:hashed_password</span><span class="w">
      </span><span class="k" data-group-id="6681594100-6">end</span><span class="w">
    </span><span class="k" data-group-id="6681594100-5">end</span><span class="w">
  </span><span class="k" data-group-id="6681594100-4">end</span><span class="w">

  </span><span class="n">identities</span><span class="w"> </span><span class="k" data-group-id="6681594100-7">do</span><span class="w">
    </span><span class="n">identity</span><span class="w"> </span><span class="ss">:unique_email</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6681594100-8">[</span><span class="ss">:email</span><span class="p" data-group-id="6681594100-8">]</span><span class="w">
  </span><span class="k" data-group-id="6681594100-7">end</span><span class="w">
</span><span class="k" data-group-id="6681594100-1">end</span></code></pre><p>If you plan on providing authentication via the web, then you will need to
define a plug using <a href="AshAuthentication.Plug.html"><code class="inline">AshAuthentication.Plug</code></a> which builds a <a href="https://hexdocs.pm/plug/1.16.1/Plug.Router.html"><code class="inline">Plug.Router</code></a> that
routes incoming authentication requests to the correct provider and provides
callbacks for you to manipulate the conn after success or failure.</p><p>If you're using AshAuthentication with Phoenix, then check out
<a href="https://github.com/team-alembic/ash_authentication_phoenix"><code class="inline">ash_authentication_phoenix</code></a>
which provides route helpers, a controller abstraction and LiveView components
for easy set up.</p><h2 id="authentication-strategies" class="section-heading">
  <a href="#authentication-strategies" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Authentication Strategies</span>
</h2>
<p>Currently supported strategies:</p><ol><li><a href="AshAuthentication.Strategy.Password.html"><code class="inline">AshAuthentication.Strategy.Password</code></a><ul><li>authenticate users against your local database using a unique identity
(such as username or email address) and a password.</li></ul></li><li><a href="AshAuthentication.Strategy.OAuth2.html"><code class="inline">AshAuthentication.Strategy.OAuth2</code></a><ul><li>authenticate using local or remote <a href="https://oauth.net/2/">OAuth 2.0</a> compatible services.</li><li>also includes:<ul><li><a href="AshAuthentication.Strategy.Auth0.html"><code class="inline">AshAuthentication.Strategy.Auth0</code></a></li><li><a href="AshAuthentication.Strategy.Github.html"><code class="inline">AshAuthentication.Strategy.Github</code></a></li><li><a href="AshAuthentication.Strategy.Google.html"><code class="inline">AshAuthentication.Strategy.Google</code></a></li><li><a href="AshAuthentication.Strategy.Oidc.html"><code class="inline">AshAuthentication.Strategy.Oidc</code></a></li></ul></li></ul></li><li><a href="AshAuthentication.Strategy.MagicLink.html"><code class="inline">AshAuthentication.Strategy.MagicLink</code></a><ul><li>authenticate by sending a single-use link to the user.</li></ul></li></ol><h3 id="http-client-settings" class="section-heading">
  <a href="#http-client-settings" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">HTTP client settings</span>
</h3>
<p>Most of the authentication strategies based on <code class="inline">OAuth2</code> wrap the <a href="https://hex.pm/packages/assent"><code class="inline">assent</code></a> package.</p><p>If you needs to customize the behavior of the http client used by <code class="inline">assent</code>, define a custom <code class="inline">http_adapter</code> in the 
application settings:</p><p><code class="inline">config :ash_authentication, :http_adapter, {Assent.HTTPAdapter.Finch, supervisor: MyApp.CustomFinch}</code></p><p>See <a href="https://hexdocs.pm/assent/README.html#http-client"><code class="inline">assent's documentation</code></a> for more details on the supported 
http clients and their configuration.</p><h2 id="add-ons" class="section-heading">
  <a href="#add-ons" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Add-ons</span>
</h2>
<p>Add-ons are like strategies, except that they don't actually provide
authentication - they just provide features adjacent to authentication.
Current add-ons:</p><ol><li><a href="AshAuthentication.AddOn.Confirmation.html"><code class="inline">AshAuthentication.AddOn.Confirmation</code></a><ul><li>allows you to force the user to confirm changes using a confirmation
token (eg. sending a confirmation email when a new user registers).</li></ul></li></ol><h2 id="supervisor" class="section-heading">
  <a href="#supervisor" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Supervisor</span>
</h2>
<p>Some add-ons or strategies may require processes to be started which manage
their state over the lifetime of the application (eg periodically deleting
expired token revocations).  Because of this you should add
<code class="inline">{AshAuthentication.Supervisor, otp_app: :my_app}</code> to your application's
supervision tree.  See <a href="https://hexdocs.pm/elixir/Application.html#module-the-application-callback-module">the Elixir
docs</a>
for more information.</p><h2 id="authentication" class="section-heading">
  <a href="#authentication" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">authentication</span>
</h2>
<p>Configure authentication for this resource</p><h3 id="nested-dsls" class="section-heading">
  <a href="#nested-dsls" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Nested DSLs</span>
</h3>
<ul><li><a href="#authentication-tokens">tokens</a></li><li><a href="#authentication-strategies">strategies</a></li><li><a href="#authentication-add_ons">add_ons</a></li></ul><h3 id="options" class="section-heading">
  <a href="#options" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Options</span>
</h3>
<table><thead><tr><th style="text-align: left;">Name</th><th style="text-align: left;">Type</th><th style="text-align: left;">Default</th><th style="text-align: left;">Docs</th></tr></thead><tbody><tr><td style="text-align: left;"><a href="#authentication-subject_name" id="authentication-subject_name"><code class="inline">subject_name</code></a></td><td style="text-align: left;"><code class="inline">atom</code></td><td style="text-align: left;"></td><td style="text-align: left;">The subject name is used anywhere that a short version of your resource name is needed.  Must be unique system-wide and will be inferred from the resource name by default (ie <code class="inline">MyApp.Accounts.User</code> -&gt; <code class="inline">user</code>).</td></tr><tr><td style="text-align: left;"><a href="#authentication-domain" id="authentication-domain"><code class="inline">domain</code></a></td><td style="text-align: left;"><code class="inline">module</code></td><td style="text-align: left;"></td><td style="text-align: left;">The name of the Ash domain to use to access this resource when doing anything authentication related.</td></tr><tr><td style="text-align: left;"><a href="#authentication-get_by_subject_action_name" id="authentication-get_by_subject_action_name"><code class="inline">get_by_subject_action_name</code></a></td><td style="text-align: left;"><code class="inline">atom</code></td><td style="text-align: left;"><code class="inline">:get_by_subject</code></td><td style="text-align: left;">The name of the read action used to retrieve records. If the action doesn't exist, one will be generated for you.</td></tr><tr><td style="text-align: left;"><a href="#authentication-select_for_senders" id="authentication-select_for_senders"><code class="inline">select_for_senders</code></a></td><td style="text-align: left;"><code class="inline">list(atom)</code></td><td style="text-align: left;"></td><td style="text-align: left;">A list of fields that we will ensure are selected whenever a sender will be invoked.  Defaults to <code class="inline">[:email]</code> if there is an <code class="inline">:email</code> attribute on the resource, and <code class="inline">[]</code> otherwise.</td></tr></tbody></table><h2 id="authentication-tokens" class="section-heading">
  <a href="#authentication-tokens" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">authentication.tokens</span>
</h2>
<p>Configure JWT settings for this resource</p><h3 id="options-1" class="section-heading">
  <a href="#options-1" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Options</span>
</h3>
<table><thead><tr><th style="text-align: left;">Name</th><th style="text-align: left;">Type</th><th style="text-align: left;">Default</th><th style="text-align: left;">Docs</th></tr></thead><tbody><tr><td style="text-align: left;"><a class="spark-required" href="#authentication-tokens-token_resource" id="authentication-tokens-token_resource"><code class="inline">token_resource</code></a></td><td style="text-align: left;"><code class="inline">module | false</code></td><td style="text-align: left;"></td><td style="text-align: left;">The resource used to store token information, such as in-flight confirmations, revocations, and if <code class="inline">store_all_tokens?</code> is enabled, authentication tokens themselves.</td></tr><tr><td style="text-align: left;"><a href="#authentication-tokens-enabled?" id="authentication-tokens-enabled?"><code class="inline">enabled?</code></a></td><td style="text-align: left;"><code class="inline">boolean</code></td><td style="text-align: left;"><code class="inline">false</code></td><td style="text-align: left;">Should JWTs be generated by this resource?</td></tr><tr><td style="text-align: left;"><a href="#authentication-tokens-store_all_tokens?" id="authentication-tokens-store_all_tokens?"><code class="inline">store_all_tokens?</code></a></td><td style="text-align: left;"><code class="inline">boolean</code></td><td style="text-align: left;"><code class="inline">false</code></td><td style="text-align: left;">Store all tokens in the <code class="inline">token_resource</code>. See the <a href="tokens.html">tokens guide</a> for more.</td></tr><tr><td style="text-align: left;"><a href="#authentication-tokens-require_token_presence_for_authentication?" id="authentication-tokens-require_token_presence_for_authentication?"><code class="inline">require_token_presence_for_authentication?</code></a></td><td style="text-align: left;"><code class="inline">boolean</code></td><td style="text-align: left;"><code class="inline">false</code></td><td style="text-align: left;">Require a locally-stored token for authentication. See the <a href="tokens.html">tokens guide</a> for more.</td></tr><tr><td style="text-align: left;"><a href="#authentication-tokens-signing_algorithm" id="authentication-tokens-signing_algorithm"><code class="inline">signing_algorithm</code></a></td><td style="text-align: left;"><code class="inline">String.t</code></td><td style="text-align: left;"><code class="inline">&quot;HS256&quot;</code></td><td style="text-align: left;">The algorithm to use for token signing. Available signing algorithms are; EdDSA, Ed448ph, Ed448, Ed25519ph, Ed25519, PS512, PS384, PS256, ES512, ES384, ES256, RS512, RS384, RS256, HS512, HS384 and HS256.</td></tr><tr><td style="text-align: left;"><a href="#authentication-tokens-token_lifetime" id="authentication-tokens-token_lifetime"><code class="inline">token_lifetime</code></a></td><td style="text-align: left;"><code class="inline">pos_integer | {pos_integer, :days | :hours | :minutes | :seconds}</code></td><td style="text-align: left;"><code class="inline">{14, :days}</code></td><td style="text-align: left;">How long a token should be valid. See <a href="tokens.html">the tokens guide</a> for more.</td></tr><tr><td style="text-align: left;"><a href="#authentication-tokens-signing_secret" id="authentication-tokens-signing_secret"><code class="inline">signing_secret</code></a></td><td style="text-align: left;"><code class="inline">(any, any -&gt; any) | module | String.t</code></td><td style="text-align: left;"></td><td style="text-align: left;">The secret used to sign tokens.  Takes either a module which implements the <a href="AshAuthentication.Secret.html"><code class="inline">AshAuthentication.Secret</code></a> behaviour, a 2 arity anonymous function or a string.</td></tr></tbody></table><h2 id="authentication-strategies-1" class="section-heading">
  <a href="#authentication-strategies-1" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">authentication.strategies</span>
</h2>
<p>Configure authentication strategies on this resource</p><h2 id="authentication-add_ons" class="section-heading">
  <a href="#authentication-add_ons" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">authentication.add_ons</span>
</h2>
<p>Additional add-ons related to, but not providing authentication</p><style type="text/css">.spark-required::after { content: "*"; color: red !important; }</style>
</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="upgrading.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Upgrading
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="dsl-ashauthentication-addon-confirmation.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
DSL: AshAuthentication.AddOn.Confirmation
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

          <span class="line">
            <a href="https://hex.pm/packages/ash_authentication/4.0.4" class="footer-hex-package">Hex Package</a>

            <a href="https://preview.hex.pm/preview/ash_authentication/4.0.4">Hex Preview</a>

              (<a href="https://preview.hex.pm/preview/ash_authentication/4.0.4/show/documentation/dsls/DSL:-AshAuthentication.md">current file</a>)

          </span>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="ash_authentication.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.34.2) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
