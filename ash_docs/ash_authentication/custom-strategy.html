<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.34.2">
    <meta name="project" content="ash_authentication v4.0.4">


    <title>Defining Custom Authentication Strategies â€” ash_authentication v4.0.4</title>
    <link rel="stylesheet" href="dist/html-elixir-F2VRIOKR.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-K7URE6B4.js"></script>
    <script src="dist/sidebar_items-BF9EDA45.js"></script>
    <script src="docs_config.js"></script>
    <script async src="dist/html-YIPIRHGU.js"></script>
<script>
  if (location.hostname === "hexdocs.pm") {
    var script = document.createElement("script");
    script.src = "https://plausible.io/js/script.js";
    script.setAttribute("defer", "defer")
    script.setAttribute("data-domain", "ashhexdocs")
    document.head.appendChild(script);
  }
</script>

  </head>
  <body data-type="extras" class="page-extra">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="readme.html" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="ash_authentication" />
        </a>

      <div>
        <a href="readme.html" class="sidebar-projectName" translate="no">
ash_authentication
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v4.0.4
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
GUIDES
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


</nav>

<main class="content">
  <output role="status" id="toast"></output>

  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of ash_authentication</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search">
            <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <h1>

      <a href="https://github.com/team-alembic/ash_authentication/blob/main/documentation/topics/custom-strategy.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>


    <span>Defining Custom Authentication Strategies</span>
  </h1>

<p>AshAuthentication allows you to bring your own authentication strategy without
having to change the Ash Authentication codebase.</p><blockquote><h4 class="info">Add-on vs Strategy?</h4><p>There is functionally no difference between &quot;add ons&quot; and &quot;strategies&quot; other
than where they appear in the DSL. We invented &quot;add ons&quot; because it felt
weird calling &quot;confirmation&quot; an authentication strategy.</p></blockquote><p>There are several moving parts which must all work together so hold on to your hat!</p><ol><li>A <a href="https://hexdocs.pm/spark/2.2.23/Spark.Dsl.Entity.html"><code class="inline">Spark.Dsl.Entity</code></a> struct. This is used to define the strategy DSL
inside the <code class="inline">strategies</code> (or <code class="inline">add_ons</code>) section of the <code class="inline">authentication</code> DSL.</li><li>A strategy struct, which stores information about the strategy as
configured on a resource which must comply with a few rules.</li><li>An optional transformer, which can be used to manipulate the DSL state of
the entity and the resource.</li><li>An optional verifier, which can be used to verify the DSL state of the
entity and the resource after compilation.</li><li>The <a href="AshAuthentication.Strategy.html"><code class="inline">AshAuthentication.Strategy</code></a> protocol, which provides the glue needed
for everything to wire up and wrappers around the actions needed to run on
the resource.</li></ol><p>We're going to define an extremely dumb strategy which lets anyone with a name
that starts with &quot;Marty&quot; sign in with just their name. Of course you would
never do this in real life, but this isn't real life - it's documentation!</p><h2 id="dsl-setup" class="section-heading">
  <a href="#dsl-setup" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">DSL setup</span>
</h2>
<p>Let's start by defining a module for our strategy to live in. Let's call it
<code class="inline">OnlyMartiesAtTheParty</code>:</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">OnlyMartiesAtTheParty</span><span class="w"> </span><span class="k" data-group-id="6143902880-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">AshAuthentication.Strategy.Custom</span><span class="w">
</span><span class="k" data-group-id="6143902880-1">end</span></code></pre><p>Sadly, this isn't enough to make the magic happen. We need to define our DSL
entity by adding it to the <code class="inline">use</code> statement:</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">OnlyMartiesAtTheParty</span><span class="w"> </span><span class="k" data-group-id="2842125863-1">do</span><span class="w">
  </span><span class="na">@entity</span><span class="w"> </span><span class="p" data-group-id="2842125863-2">%</span><span class="nc" data-group-id="2842125863-2">Spark.Dsl.Entity</span><span class="p" data-group-id="2842125863-2">{</span><span class="w">
    </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="ss">:only_marty</span><span class="p">,</span><span class="w">
    </span><span class="ss">describe</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Strategy which only allows folks whose name starts with </span><span class="se">\&quot;</span><span class="s">Marty</span><span class="se">\&quot;</span><span class="s"> to sign in.&quot;</span><span class="p">,</span><span class="w">
    </span><span class="ss">examples</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2842125863-3">[</span><span class="w">
      </span><span class="s">&quot;&quot;&quot;
      only_marty do
        case_sensitive? true
        name_field :name
      end
      &quot;&quot;&quot;</span><span class="w">
    </span><span class="p" data-group-id="2842125863-3">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">target</span><span class="p">:</span><span class="w"> </span><span class="bp">__MODULE__</span><span class="p">,</span><span class="w">
    </span><span class="ss">args</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2842125863-4">[</span><span class="p" data-group-id="2842125863-5">{</span><span class="ss">:optional</span><span class="p">,</span><span class="w"> </span><span class="ss">:name</span><span class="p">,</span><span class="w"> </span><span class="ss">:marty</span><span class="p" data-group-id="2842125863-5">}</span><span class="p" data-group-id="2842125863-4">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">schema</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2842125863-6">[</span><span class="w">
      </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2842125863-7">[</span><span class="w">
        </span><span class="ss">type</span><span class="p">:</span><span class="w"> </span><span class="ss">:atom</span><span class="p">,</span><span class="w">
        </span><span class="ss">doc</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;&quot;
        The strategy name.
        &quot;&quot;&quot;</span><span class="p">,</span><span class="w">
        </span><span class="ss">required</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="w">
      </span><span class="p" data-group-id="2842125863-7">]</span><span class="p">,</span><span class="w">
      </span><span class="ss">case_sensitive?</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2842125863-8">[</span><span class="w">
        </span><span class="ss">type</span><span class="p">:</span><span class="w"> </span><span class="ss">:boolean</span><span class="p">,</span><span class="w">
        </span><span class="ss">doc</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;&quot;
        Ignore letter case when comparing?
        &quot;&quot;&quot;</span><span class="p">,</span><span class="w">
        </span><span class="ss">required</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p">,</span><span class="w">
        </span><span class="ss">default</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="w">
      </span><span class="p" data-group-id="2842125863-8">]</span><span class="p">,</span><span class="w">
      </span><span class="ss">name_field</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="2842125863-9">[</span><span class="w">
        </span><span class="ss">type</span><span class="p">:</span><span class="w"> </span><span class="ss">:atom</span><span class="p">,</span><span class="w">
        </span><span class="ss">doc</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;&quot;
        The field to check for the users&#39; name.
        &quot;&quot;&quot;</span><span class="p">,</span><span class="w">
        </span><span class="ss">required</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="w">
      </span><span class="p" data-group-id="2842125863-9">]</span><span class="w">
    </span><span class="p" data-group-id="2842125863-6">]</span><span class="w">
  </span><span class="p" data-group-id="2842125863-2">}</span><span class="w">

  </span><span class="kn">use</span><span class="w"> </span><span class="nc">AshAuthentication.Strategy.Custom</span><span class="p">,</span><span class="w"> </span><span class="ss">entity</span><span class="p">:</span><span class="w"> </span><span class="na">@entity</span><span class="w">
</span><span class="k" data-group-id="2842125863-1">end</span></code></pre><p>If you haven't you should take a look at the docs for <a href="https://hexdocs.pm/spark/2.2.23/Spark.Dsl.Entity.html"><code class="inline">Spark.Dsl.Entity</code></a>, but
here's a brief overview of what each field we've set does:</p><ul><li><code class="inline">name</code> is the name for which the helper function will be generated in
the DSL (ie <code class="inline">only_marty do #... end</code>).</li><li><code class="inline">describe</code> and <code class="inline">examples</code> are used when generating documentation.</li><li><code class="inline">target</code> is the name of the module which defines our entity struct. We've
set it to <code class="inline">__MODULE__</code> which means that we'll have to define the struct on
this module.</li><li><code class="inline">schema</code> is a keyword list that defines an options schema. See <a href="https://hexdocs.pm/spark/2.2.23/Spark.Options.html"><code class="inline">Spark.Options</code></a>.</li></ul><blockquote><p>By default the entity is added to the <code class="inline">authentication / strategy</code> DSL, however
if you want it in the <code class="inline">authentication / add_ons</code> DSL instead you can also pass
<code class="inline">style: :add_on</code> in the <code class="inline">use</code> statement.</p></blockquote><p>Next up, we need to define our struct. The struct should have <em>at least</em> the
fields named in the entity schema. Additionally, Ash Authentication requires
that it have a <code class="inline">resource</code> field which will be set to the module of the resource
it's attached to during compilation.</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">OnlyMartiesAtTheParty</span><span class="w"> </span><span class="k" data-group-id="0977752175-1">do</span><span class="w">
  </span><span class="kd">defstruct</span><span class="w"> </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="ss">:marty</span><span class="p">,</span><span class="w"> </span><span class="ss">case_sensitive?</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p">,</span><span class="w"> </span><span class="ss">name_field</span><span class="p">:</span><span class="w"> </span><span class="no">nil</span><span class="p">,</span><span class="w"> </span><span class="ss">resource</span><span class="p">:</span><span class="w"> </span><span class="no">nil</span><span class="w">

  </span><span class="c1"># ...</span><span class="w">

  </span><span class="kn">use</span><span class="w"> </span><span class="nc">AshAuthentication.Strategy.Custom</span><span class="p">,</span><span class="w"> </span><span class="ss">entity</span><span class="p">:</span><span class="w"> </span><span class="na">@entity</span><span class="w">

  </span><span class="c1"># other code elided ...</span><span class="w">
</span><span class="k" data-group-id="0977752175-1">end</span></code></pre><p>Now it would be theoretically possible to add this custom strategies to your app
by adding it to the <code class="inline">extensions</code> section of your resource:</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">MyApp.Accounts.User</span><span class="w"> </span><span class="k" data-group-id="5815216704-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Ash.Resource</span><span class="p">,</span><span class="w">
    </span><span class="ss">extensions</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5815216704-2">[</span><span class="nc">AshAuthentication</span><span class="p">,</span><span class="w"> </span><span class="nc">OnlyMartiesAtTheParty</span><span class="p" data-group-id="5815216704-2">]</span><span class="p">,</span><span class="w">
    </span><span class="ss">domain</span><span class="p">:</span><span class="w"> </span><span class="nc">MyApp.Accounts</span><span class="w">

  </span><span class="n">authentication</span><span class="w"> </span><span class="k" data-group-id="5815216704-3">do</span><span class="w">
    </span><span class="n">strategies</span><span class="w"> </span><span class="k" data-group-id="5815216704-4">do</span><span class="w">
      </span><span class="n">only_marty</span><span class="w"> </span><span class="k" data-group-id="5815216704-5">do</span><span class="w">
        </span><span class="n">name_field</span><span class="w"> </span><span class="ss">:name</span><span class="w">
      </span><span class="k" data-group-id="5815216704-5">end</span><span class="w">
    </span><span class="k" data-group-id="5815216704-4">end</span><span class="w">
  </span><span class="k" data-group-id="5815216704-3">end</span><span class="w">

  </span><span class="n">attributes</span><span class="w"> </span><span class="k" data-group-id="5815216704-6">do</span><span class="w">
    </span><span class="n">uuid_primary_key</span><span class="w">
    </span><span class="n">attribute</span><span class="w"> </span><span class="ss">:name</span><span class="p">,</span><span class="w"> </span><span class="ss">:string</span><span class="p">,</span><span class="w"> </span><span class="ss">allow_nil?</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="w">
  </span><span class="k" data-group-id="5815216704-6">end</span><span class="w">
</span><span class="k" data-group-id="5815216704-1">end</span></code></pre><h2 id="implementing-the-ashauthentication-strategy-protocol" class="section-heading">
  <a href="#implementing-the-ashauthentication-strategy-protocol" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Implementing the <a href="AshAuthentication.Strategy.html"><code class="inline">AshAuthentication.Strategy</code></a> protocol</span>
</h2>
<p>The Strategy protocol is used to introspect the strategy so that it can
seamlessly fit in with the rest of Ash Authentication. Here are the key
concepts:</p><ul><li>&quot;phases&quot; - in terms of HTTP, each strategy is likely to have many phases (eg OAuth 2.0's &quot;request&quot; and &quot;callback&quot; phases). Essentially you need one phase for each HTTP endpoint you wish to support with your strategy. In our case we just want one sign in endpoint.</li><li>&quot;actions&quot; - actions are exactly as they sound - Resource actions which can be executed by the strategy, whether generated by the strategy (as in the password strategy) or typed in by the user (as in the OAuth 2.0 strategy). The reason that we wrap the strategy's actions this way is that all the built-in strategies (and we hope yours too) allow the user to customise the name of the actions that it uses. At the very least it should probably append the strategy name to the action. Using <code class="inline">Strategy.action/4</code> allows us to refer these by a more generic name rather than via the user-specified one (eg <code class="inline">:register</code> vs <code class="inline">:register_with_password</code>).</li><li>&quot;routes&quot; - <a href="AshAuthentication.Plug.html"><code class="inline">AshAuthentication.Plug</code></a> (or <a href="https://hexdocs.pm/ash_authentication_phoenix/AshAuthentication.Phoenix.Router.html"><code class="inline">AshAuthentication.Phoenix.Router.html</code></a>) will generate routes using <a href="https://hexdocs.pm/plug/1.16.1/Plug.Router.html"><code class="inline">Plug.Router</code></a> (or <a href="https://hexdocs.pm/phoenix/Phoenix.Router.html"><code class="inline">Phoenix.Router</code></a>) - the <code class="inline">routes/1</code> callback is used to retrieve this information from the strategy.</li></ul><p>Given this information, let's implement the strategy. It's quite long, so I'm
going to break it up into smaller chunks.</p><pre><code class="makeup elixir" translate="no"><span class="kd">defimpl</span><span class="w"> </span><span class="nc">AshAuthentication.Strategy</span><span class="p">,</span><span class="w"> </span><span class="ss">for</span><span class="p">:</span><span class="w"> </span><span class="nc">OnlyMartiesAtTheParty</span><span class="w"> </span><span class="k" data-group-id="3712419834-1">do</span></code></pre><p>The <code class="inline">name/1</code> function is used to uniquely identify the strategy. It <em>must</em> be an
atom and <em>should</em> be the same as the path fragment used in the generated routes.</p><pre><code class="makeup elixir" translate="no"><span class="w">  </span><span class="kd">def</span><span class="w"> </span><span class="nf">name</span><span class="p" data-group-id="9175239276-1">(</span><span class="n">strategy</span><span class="p" data-group-id="9175239276-1">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="n">strategy</span><span class="o">.</span><span class="n">name</span></code></pre><p>Since our strategy only supports sign-in we only need a single <code class="inline">:sign_in</code> phase
and action.</p><pre><code class="makeup elixir" translate="no"><span class="w">  </span><span class="kd">def</span><span class="w"> </span><span class="nf">phases</span><span class="p" data-group-id="0305704126-1">(</span><span class="bp">_</span><span class="p" data-group-id="0305704126-1">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0305704126-2">[</span><span class="ss">:sign_in</span><span class="p" data-group-id="0305704126-2">]</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">actions</span><span class="p" data-group-id="0305704126-3">(</span><span class="bp">_</span><span class="p" data-group-id="0305704126-3">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0305704126-4">[</span><span class="ss">:sign_in</span><span class="p" data-group-id="0305704126-4">]</span></code></pre><p>Next we generate the routes for the strategy. Routes <em>should</em> contain the
subject name of the resource being authenticated in case the implementer is
authenticating multiple different resources - eg <code class="inline">User</code> and <code class="inline">Admin</code>.</p><pre><code class="makeup elixir" translate="no"><span class="w">  </span><span class="kd">def</span><span class="w"> </span><span class="nf">routes</span><span class="p" data-group-id="3611491168-1">(</span><span class="n">strategy</span><span class="p" data-group-id="3611491168-1">)</span><span class="w"> </span><span class="k" data-group-id="3611491168-2">do</span><span class="w">
    </span><span class="n">subject_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">AshAuthentication.Info</span><span class="o">.</span><span class="n">authentication_subject_name!</span><span class="p" data-group-id="3611491168-3">(</span><span class="n">strategy</span><span class="o">.</span><span class="n">resource</span><span class="p" data-group-id="3611491168-3">)</span><span class="w">

    </span><span class="p" data-group-id="3611491168-4">[</span><span class="w">
      </span><span class="p" data-group-id="3611491168-5">{</span><span class="s">&quot;/</span><span class="si" data-group-id="3611491168-6">#{</span><span class="n">subject_name</span><span class="si" data-group-id="3611491168-6">}</span><span class="s">/</span><span class="si" data-group-id="3611491168-7">#{</span><span class="n">strategy</span><span class="o">.</span><span class="n">name</span><span class="si" data-group-id="3611491168-7">}</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">:sign_in</span><span class="p" data-group-id="3611491168-5">}</span><span class="w">
    </span><span class="p" data-group-id="3611491168-4">]</span><span class="w">
  </span><span class="k" data-group-id="3611491168-2">end</span></code></pre><p>When generating routes or forms for this phase, what HTTP method should we use?</p><pre><code class="makeup elixir" translate="no"><span class="w">  </span><span class="kd">def</span><span class="w"> </span><span class="nf">method_for_phase</span><span class="p" data-group-id="2555140085-1">(</span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="ss">:sign_in</span><span class="p" data-group-id="2555140085-1">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="ss">:post</span></code></pre><p>Next up, we write our plug. We take the &quot;name field&quot; from the input params in
the conn and pass them to our sign in action. As long as the action returns
<code class="inline">{:ok, Ash.Resource.record}</code> or <code class="inline">{:error, any}</code> then we can just pass it
straight into <code class="inline">store_authentication_result/2</code> from
<a href="AshAuthentication.Plug.Helpers.html"><code class="inline">AshAuthentication.Plug.Helpers</code></a>.</p><pre><code class="makeup elixir" translate="no"><span class="w">  </span><span class="kn">import</span><span class="w"> </span><span class="nc">AshAuthentication.Plug.Helpers</span><span class="p">,</span><span class="w"> </span><span class="ss">only</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="9301917884-1">[</span><span class="ss">store_authentication_result</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="9301917884-1">]</span><span class="w">

  </span><span class="kd">def</span><span class="w"> </span><span class="nf">plug</span><span class="p" data-group-id="9301917884-2">(</span><span class="n">strategy</span><span class="p">,</span><span class="w"> </span><span class="ss">:sign_in</span><span class="p">,</span><span class="w"> </span><span class="n">conn</span><span class="p" data-group-id="9301917884-2">)</span><span class="w"> </span><span class="k" data-group-id="9301917884-3">do</span><span class="w">
    </span><span class="n">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Map</span><span class="o">.</span><span class="n">take</span><span class="p" data-group-id="9301917884-4">(</span><span class="n">conn</span><span class="o">.</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9301917884-5">[</span><span class="n">to_string</span><span class="p" data-group-id="9301917884-6">(</span><span class="n">strategy</span><span class="o">.</span><span class="n">name_field</span><span class="p" data-group-id="9301917884-6">)</span><span class="p" data-group-id="9301917884-5">]</span><span class="p" data-group-id="9301917884-4">)</span><span class="w">
    </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">action</span><span class="p" data-group-id="9301917884-7">(</span><span class="n">strategy</span><span class="p">,</span><span class="w"> </span><span class="ss">:sign_in</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="9301917884-8">[</span><span class="p" data-group-id="9301917884-8">]</span><span class="p" data-group-id="9301917884-7">)</span><span class="w">
    </span><span class="n">store_authentication_result</span><span class="p" data-group-id="9301917884-9">(</span><span class="n">conn</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p" data-group-id="9301917884-9">)</span><span class="w">
  </span><span class="k" data-group-id="9301917884-3">end</span></code></pre><p>Next, we implement our sign in action. We use <a href="https://hexdocs.pm/ash/3.4.1/Ash.Query.html"><code class="inline">Ash.Query</code></a> to find all
records whose name field matches the input, then constrain it to only records
whose name field starts with &quot;Marty&quot;. Depending on whether the name field has a
unique identity on it we have to deal with it returning zero or more users, or
an error. When it returns a single user we return that user in an ok tuple,
otherwise we return an authentication failure.</p><p>In this example we're assuming that there is a default <code class="inline">read</code> action present on
the resource.</p><blockquote><h4 class="warning">Warning</h4><p>When it comes to authentication, you never want to reveal to the user what the
failure was - this helps prevent <a href="https://www.hacksplaining.com/prevention/user-enumeration">enumeration
attacks</a>.</p><p>You can use <a href="AshAuthentication.Errors.AuthenticationFailed.html"><code class="inline">AshAuthentication.Errors.AuthenticationFailed</code></a> for this purpose
as it will cause <code class="inline">ash_authentication</code>, <code class="inline">ash_authentication_phoenix</code>,
<code class="inline">ash_graphql</code> and <code class="inline">ash_json_api</code> to return the correct HTTP 401 error.</p></blockquote><pre><code class="makeup elixir" translate="no"><span class="w">  </span><span class="kn">alias</span><span class="w"> </span><span class="nc">AshAuthentication.Errors.AuthenticationFailed</span><span class="w">
  </span><span class="kn">require</span><span class="w"> </span><span class="nc">Ash.Query</span><span class="w">
  </span><span class="kn">import</span><span class="w"> </span><span class="nc">Ash.Expr</span><span class="w">

  </span><span class="kd">def</span><span class="w"> </span><span class="nf">action</span><span class="p" data-group-id="5212667774-1">(</span><span class="n">strategy</span><span class="p">,</span><span class="w"> </span><span class="ss">:sign_in</span><span class="p">,</span><span class="w"> </span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p" data-group-id="5212667774-1">)</span><span class="w"> </span><span class="k" data-group-id="5212667774-2">do</span><span class="w">
    </span><span class="n">name_field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strategy</span><span class="o">.</span><span class="n">name_field</span><span class="w">
    </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Map</span><span class="o">.</span><span class="n">get</span><span class="p" data-group-id="5212667774-3">(</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="n">to_string</span><span class="p" data-group-id="5212667774-4">(</span><span class="n">name_field</span><span class="p" data-group-id="5212667774-4">)</span><span class="p" data-group-id="5212667774-3">)</span><span class="w">
    </span><span class="n">domain</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">AshAuthentication.Info</span><span class="o">.</span><span class="n">domain!</span><span class="p" data-group-id="5212667774-5">(</span><span class="n">strategy</span><span class="o">.</span><span class="n">resource</span><span class="p" data-group-id="5212667774-5">)</span><span class="w">

    </span><span class="n">strategy</span><span class="o">.</span><span class="n">resource</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="5212667774-6">(</span><span class="n">expr</span><span class="p" data-group-id="5212667774-7">(</span><span class="o">^</span><span class="n">ref</span><span class="p" data-group-id="5212667774-8">(</span><span class="n">name_field</span><span class="p" data-group-id="5212667774-8">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">^</span><span class="n">name</span><span class="p" data-group-id="5212667774-7">)</span><span class="p" data-group-id="5212667774-6">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">then</span><span class="p" data-group-id="5212667774-9">(</span><span class="k" data-group-id="5212667774-10">fn</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="k">if</span><span class="w"> </span><span class="n">strategy</span><span class="o">.</span><span class="n">case_sensitive?</span><span class="w"> </span><span class="k" data-group-id="5212667774-11">do</span><span class="w">
        </span><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="5212667774-12">(</span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="n">like</span><span class="p" data-group-id="5212667774-13">(</span><span class="o">^</span><span class="n">ref</span><span class="p" data-group-id="5212667774-14">(</span><span class="n">name_field</span><span class="p" data-group-id="5212667774-14">)</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Marty%&quot;</span><span class="p" data-group-id="5212667774-13">)</span><span class="p" data-group-id="5212667774-12">)</span><span class="w">
      </span><span class="k" data-group-id="5212667774-11">else</span><span class="w">
        </span><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="5212667774-15">(</span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="n">ilike</span><span class="p" data-group-id="5212667774-16">(</span><span class="o">^</span><span class="n">ref</span><span class="p" data-group-id="5212667774-17">(</span><span class="n">name_field</span><span class="p" data-group-id="5212667774-17">)</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Marty%&quot;</span><span class="p" data-group-id="5212667774-16">)</span><span class="p" data-group-id="5212667774-15">)</span><span class="w">
      </span><span class="k" data-group-id="5212667774-11">end</span><span class="w">
    </span><span class="k" data-group-id="5212667774-10">end</span><span class="p" data-group-id="5212667774-9">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">domain</span><span class="o">.</span><span class="n">read</span><span class="p" data-group-id="5212667774-18">(</span><span class="n">options</span><span class="p" data-group-id="5212667774-18">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="k">case</span><span class="w"> </span><span class="k" data-group-id="5212667774-19">do</span><span class="w">
      </span><span class="p" data-group-id="5212667774-20">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5212667774-21">[</span><span class="n">user</span><span class="p" data-group-id="5212667774-21">]</span><span class="p" data-group-id="5212667774-20">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="p" data-group-id="5212667774-22">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p" data-group-id="5212667774-22">}</span><span class="w">

      </span><span class="p" data-group-id="5212667774-23">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5212667774-24">[</span><span class="p" data-group-id="5212667774-24">]</span><span class="p" data-group-id="5212667774-23">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="p" data-group-id="5212667774-25">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="nc">AuthenticationFailed</span><span class="o">.</span><span class="n">exception</span><span class="p" data-group-id="5212667774-26">(</span><span class="ss">caused_by</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5212667774-27">%{</span><span class="ss">reason</span><span class="p">:</span><span class="w"> </span><span class="ss">:no_user</span><span class="p" data-group-id="5212667774-27">}</span><span class="p" data-group-id="5212667774-26">)</span><span class="p" data-group-id="5212667774-25">}</span><span class="w">

      </span><span class="p" data-group-id="5212667774-28">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="c">_users</span><span class="p" data-group-id="5212667774-28">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="p" data-group-id="5212667774-29">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="nc">AuthenticationFailed</span><span class="o">.</span><span class="n">exception</span><span class="p" data-group-id="5212667774-30">(</span><span class="ss">caused_by</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5212667774-31">%{</span><span class="ss">reason</span><span class="p">:</span><span class="w"> </span><span class="ss">:too_many_users</span><span class="p" data-group-id="5212667774-31">}</span><span class="p" data-group-id="5212667774-30">)</span><span class="p" data-group-id="5212667774-29">}</span><span class="w">

      </span><span class="p" data-group-id="5212667774-32">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="n">reason</span><span class="p" data-group-id="5212667774-32">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="p" data-group-id="5212667774-33">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="nc">AuthenticationFailed</span><span class="o">.</span><span class="n">exception</span><span class="p" data-group-id="5212667774-34">(</span><span class="ss">caused_by</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5212667774-35">%{</span><span class="ss">reason</span><span class="p">:</span><span class="w"> </span><span class="n">reason</span><span class="p" data-group-id="5212667774-35">}</span><span class="p" data-group-id="5212667774-34">)</span><span class="p" data-group-id="5212667774-33">}</span><span class="w">
    </span><span class="k" data-group-id="5212667774-19">end</span><span class="w">
  </span><span class="k" data-group-id="5212667774-2">end</span><span class="w">
</span><span class="k">end</span></code></pre><p>Lastly, we have to implement the <code class="inline">tokens_required?/1</code> function. This function
indicates Ash Authentication whether your strategy creates or consumes any
tokens. Since our strategy does not, we can simply return false:</p><pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">tokens_required?</span><span class="p" data-group-id="3740266343-1">(</span><span class="bp">_</span><span class="p" data-group-id="3740266343-1">)</span><span class="p">,</span><span class="w"> </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="no">false</span></code></pre><h2 id="bonus-round-transformers-and-verifiers" class="section-heading">
  <a href="#bonus-round-transformers-and-verifiers" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Bonus round - transformers and verifiers</span>
</h2>
<p>In some cases it may be required for your strategy to modify it's own
configuration or that of the whole resource at compile time. For that you can
define the <code class="inline">transform/2</code> callback on your strategy module.</p><p>At the very least it is good practice to call
<a href="AshAuthentication.Strategy.Custom.Helpers.html#register_strategy_actions/3"><code class="inline">AshAuthentication.Strategy.Custom.Helpers.register_strategy_actions/3</code></a> so that
Ash Authentication can keep track of which actions are related to which
strategies and <a href="AshAuthentication.Strategy.Custom.Helpers.html"><code class="inline">AshAuthentication.Strategy.Custom.Helpers</code></a> is automatically
imported by <code class="inline">use AshAuthentication.Strategy.Custom</code> for this purpose.</p><h3 id="transformers" class="section-heading">
  <a href="#transformers" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Transformers</span>
</h3>
<p>For simple cases where you're just transforming the strategy you can just return
the modified strategy and the DSL will be updated accordingly. For example if
you wanted to generate the name of an action if the user hasn't specified it:</p><pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">transform</span><span class="p" data-group-id="9060371790-1">(</span><span class="n">strategy</span><span class="p">,</span><span class="w"> </span><span class="c">_dsl_state</span><span class="p" data-group-id="9060371790-1">)</span><span class="w"> </span><span class="k" data-group-id="9060371790-2">do</span><span class="w">
  </span><span class="p" data-group-id="9060371790-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="nc">Map</span><span class="o">.</span><span class="n">put_new</span><span class="p" data-group-id="9060371790-4">(</span><span class="n">strategy</span><span class="p">,</span><span class="w"> </span><span class="ss">:sign_in_action_name</span><span class="p">,</span><span class="w"> </span><span class="ss">:&quot;sign_in_with_</span><span class="si" data-group-id="9060371790-5">#{</span><span class="n">strategy</span><span class="o">.</span><span class="n">name</span><span class="si" data-group-id="9060371790-5">}</span><span class="ss">&quot;</span><span class="p" data-group-id="9060371790-4">)</span><span class="p" data-group-id="9060371790-3">}</span><span class="w">
</span><span class="k" data-group-id="9060371790-2">end</span></code></pre><p>In some cases you may want to modify the strategy and the resources DSL. In
this case you can return the newly mutated DSL state in an ok tuple or an error
tuple, preferably containing a <a href="https://hexdocs.pm/spark/2.2.23/Spark.Error.DslError.html"><code class="inline">Spark.Error.DslError</code></a>. For example if we wanted
to build a sign in action for <code class="inline">OnlyMartiesAtTheParty</code> to use:</p><pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">transform</span><span class="p" data-group-id="4164155311-1">(</span><span class="n">strategy</span><span class="p">,</span><span class="w"> </span><span class="n">dsl_state</span><span class="p" data-group-id="4164155311-1">)</span><span class="w"> </span><span class="k" data-group-id="4164155311-2">do</span><span class="w">
  </span><span class="n">strategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Map</span><span class="o">.</span><span class="n">put_new</span><span class="p" data-group-id="4164155311-3">(</span><span class="n">strategy</span><span class="p">,</span><span class="w"> </span><span class="ss">:sign_in_action_name</span><span class="p">,</span><span class="w"> </span><span class="ss">:&quot;sign_in_with_</span><span class="si" data-group-id="4164155311-4">#{</span><span class="n">strategy</span><span class="o">.</span><span class="n">name</span><span class="si" data-group-id="4164155311-4">}</span><span class="ss">&quot;</span><span class="p" data-group-id="4164155311-3">)</span><span class="w">

  </span><span class="n">sign_in_action</span><span class="w"> </span><span class="o">=</span><span class="w">
    </span><span class="nc">Spark.Dsl.Transformer</span><span class="o">.</span><span class="n">build_entity</span><span class="p" data-group-id="4164155311-5">(</span><span class="nc">Ash.Resource.Dsl</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4164155311-6">[</span><span class="ss">:actions</span><span class="p" data-group-id="4164155311-6">]</span><span class="p">,</span><span class="w"> </span><span class="ss">:read</span><span class="p">,</span><span class="w">
      </span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="n">strategy</span><span class="o">.</span><span class="n">sign_in_action_name</span><span class="p">,</span><span class="w">
      </span><span class="ss">accept</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="4164155311-7">[</span><span class="n">strategy</span><span class="o">.</span><span class="n">name_field</span><span class="p" data-group-id="4164155311-7">]</span><span class="p">,</span><span class="w">
      </span><span class="ss">get?</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="p" data-group-id="4164155311-5">)</span><span class="w">

  </span><span class="n">dsl_state</span><span class="w"> </span><span class="o">=</span><span class="w">
    </span><span class="n">dsl_state</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Spark.Dsl.Transformer</span><span class="o">.</span><span class="n">add_entity</span><span class="p" data-group-id="4164155311-8">(</span><span class="p" data-group-id="4164155311-9">[</span><span class="ss">:actions</span><span class="p" data-group-id="4164155311-9">]</span><span class="p">,</span><span class="w"> </span><span class="n">sign_in_action</span><span class="p" data-group-id="4164155311-8">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">put_strategy</span><span class="p" data-group-id="4164155311-10">(</span><span class="n">strategy</span><span class="p" data-group-id="4164155311-10">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">then</span><span class="p" data-group-id="4164155311-11">(</span><span class="k" data-group-id="4164155311-12">fn</span><span class="w"> </span><span class="n">dsl_state</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
      </span><span class="n">register_strategy_actions</span><span class="p" data-group-id="4164155311-13">(</span><span class="p" data-group-id="4164155311-14">[</span><span class="n">strategy</span><span class="o">.</span><span class="n">sign_in_action_name</span><span class="p" data-group-id="4164155311-14">]</span><span class="p">,</span><span class="w"> </span><span class="n">dsl_state</span><span class="p">,</span><span class="w"> </span><span class="n">strategy</span><span class="p" data-group-id="4164155311-13">)</span><span class="w">
    </span><span class="k" data-group-id="4164155311-12">end</span><span class="p" data-group-id="4164155311-11">)</span><span class="w">

  </span><span class="p" data-group-id="4164155311-15">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">dsl_state</span><span class="p" data-group-id="4164155311-15">}</span><span class="w">
</span><span class="k" data-group-id="4164155311-2">end</span></code></pre><p>Transformers can also be used to validate user input or even directly add code
to the resource. See the docs for <a href="https://hexdocs.pm/spark/2.2.23/Spark.Dsl.Transformer.html"><code class="inline">Spark.Dsl.Transformer</code></a> for more information.</p><h3 id="verifiers" class="section-heading">
  <a href="#verifiers" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Verifiers</span>
</h3>
<p>We also support a variant of transformers which run in the new <code class="inline">@after_verify</code>
compile hook provided by Elixir 1.14. This is a great place to put checks
to make sure that the user's configuration makes sense without adding any
compile-time dependencies between modules which may cause compiler deadlocks.</p><p>For example, verifying that the &quot;name&quot; attribute contains &quot;marty&quot; (why you would
do this I don't know but I'm running out of sensible examples):</p><pre><code class="makeup elixir" translate="no"><span class="kd">def</span><span class="w"> </span><span class="nf">verify</span><span class="p" data-group-id="6293339769-1">(</span><span class="n">strategy</span><span class="p">,</span><span class="w"> </span><span class="c">_dsl_state</span><span class="p" data-group-id="6293339769-1">)</span><span class="w"> </span><span class="k" data-group-id="6293339769-2">do</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">contains?</span><span class="p" data-group-id="6293339769-3">(</span><span class="n">to_string</span><span class="p" data-group-id="6293339769-4">(</span><span class="n">strategy</span><span class="o">.</span><span class="n">name_field</span><span class="p" data-group-id="6293339769-4">)</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;marty&quot;</span><span class="p" data-group-id="6293339769-3">)</span><span class="w"> </span><span class="k" data-group-id="6293339769-5">do</span><span class="w">
    </span><span class="ss">:ok</span><span class="w">
  </span><span class="k" data-group-id="6293339769-5">else</span><span class="w">
    </span><span class="p" data-group-id="6293339769-6">{</span><span class="ss">:error</span><span class="p">,</span><span class="w">
      </span><span class="nc">Spark.Error.DslError</span><span class="o">.</span><span class="n">exception</span><span class="p" data-group-id="6293339769-7">(</span><span class="w">
        </span><span class="ss">path</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6293339769-8">[</span><span class="ss">:authentication</span><span class="p">,</span><span class="w"> </span><span class="ss">:strategies</span><span class="p">,</span><span class="w"> </span><span class="ss">:only_marties</span><span class="p" data-group-id="6293339769-8">]</span><span class="p">,</span><span class="w">
        </span><span class="ss">message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Option `name_field` must contain </span><span class="se">\&quot;</span><span class="s">marty</span><span class="se">\&quot;</span><span class="s">&quot;</span><span class="w">
      </span><span class="p" data-group-id="6293339769-7">)</span><span class="p" data-group-id="6293339769-6">}</span><span class="w">
  </span><span class="k" data-group-id="6293339769-5">end</span><span class="w">
</span><span class="k" data-group-id="6293339769-2">end</span></code></pre><h2 id="summary" class="section-heading">
  <a href="#summary" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Summary</span>
</h2>
<p>You should now have all the tools you need to build custom strategies - and in
fact the strategies provided by Ash Authentication are built using this system.</p><p>If there is functionality or documentation missing please <a href="https://github.com/team-alembic/ash_authentication/issues/new">raise an
issue</a> and we'll
take a look at it.</p><p>Go forth and strategise!</p>
</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="confirmation.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          â† Previous Page
        </span>
        <span class="title">
Confirmation Tutorial
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="policies-on-authentication-resources.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page â†’
        </span>
        <span class="title">
Policies on Authenticated Resources
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

          <span class="line">
            <a href="https://hex.pm/packages/ash_authentication/4.0.4" class="footer-hex-package">Hex Package</a>

            <a href="https://preview.hex.pm/preview/ash_authentication/4.0.4">Hex Preview</a>

              (<a href="https://preview.hex.pm/preview/ash_authentication/4.0.4/show/documentation/topics/custom-strategy.md">current file</a>)

          </span>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="ash_authentication.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.34.2) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
