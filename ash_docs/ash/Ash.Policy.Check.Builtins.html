<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.34.2">
    <meta name="project" content="ash v3.4.8">


    <title>Ash.Policy.Check.Builtins â€” ash v3.4.8</title>
    <link rel="stylesheet" href="dist/html-elixir-F2VRIOKR.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-K7URE6B4.js"></script>
    <script src="dist/sidebar_items-370365CE.js"></script>
    <script src="docs_config.js"></script>
    <script async src="dist/html-YIPIRHGU.js"></script>
<style>
  .livebook-badge-container + pre {
    display: none;
  }
</style>
<script>
  if (location.hostname === "hexdocs.pm") {
    var script = document.createElement("script");
    script.src = "https://plausible.io/js/script.js";
    script.setAttribute("defer", "defer")
    script.setAttribute("data-domain", "ashhexdocs")
    document.head.appendChild(script);
  }
</script>
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>mermaid.initialize({startOnLoad: true})</script>

  </head>
  <body data-type="modules" class="page-module">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="https://github.com/ash-project/ash" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="ash" />
        </a>

      <div>
        <a href="https://github.com/ash-project/ash" class="sidebar-projectName" translate="no">
ash
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v3.4.8
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
GUIDES
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


        <li>
          <button id="tasks-list-tab-button" role="tab" data-type="tasks" aria-controls="tasks-tab-panel" aria-selected="false" tabindex="-1">
            <span translate="no">Mix</span> Tasks
          </button>
        </li>

    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


    <div id="tasks-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="tasks-list-tab-button" hidden>
      <ul id="tasks-full-list" class="full-list"></ul>
    </div>

</nav>

<main class="content">
  <output role="status" id="toast"></output>

  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of ash</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search">
            <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/policy/check/built_in_checks.ex#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

    <span translate="no">Ash.Policy.Check.Builtins</span> 
    <small class="app-vsn" translate="no">(ash v3.4.8)</small>

  </h1>


    <section id="moduledoc">
<p>The global authorization checks built into ash</p>
    </section>

</div>

  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Summary</span>
    </h1>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#accessing_from/2" data-no-tooltip translate="no">accessing_from(resource, relationship)</a>

      </div>

        <div class="summary-synopsis"><p>This check is true when the current action is being run &quot;through&quot; a relationship.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#action/1" data-no-tooltip translate="no">action(action)</a>

      </div>

        <div class="summary-synopsis"><p>This check is true when the action name matches the provided action name or names.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#action_type/1" data-no-tooltip translate="no">action_type(action_type)</a>

      </div>

        <div class="summary-synopsis"><p>This check is true when the action type matches the provided type</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#actor_attribute_equals/2" data-no-tooltip translate="no">actor_attribute_equals(attribute, value)</a>

      </div>

        <div class="summary-synopsis"><p>This check is true when the value of the specified attribute of the actor equals the specified value.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#actor_present/0" data-no-tooltip translate="no">actor_present()</a>

      </div>

        <div class="summary-synopsis"><p>This check is true when there is an actor specified, and false when the actor is <code class="inline">nil</code>.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#always/0" data-no-tooltip translate="no">always()</a>

      </div>

        <div class="summary-synopsis"><p>This check always passes.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#changing_attributes/1" data-no-tooltip translate="no">changing_attributes(opts)</a>

      </div>

        <div class="summary-synopsis"><p>This check is true when attribute changes correspond to the provided options.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#changing_relationship/1" data-no-tooltip translate="no">changing_relationship(relationship)</a>

      </div>

        <div class="summary-synopsis"><p>This check is true when the specified relationship is changing</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#changing_relationships/1" data-no-tooltip translate="no">changing_relationships(relationships)</a>

      </div>

        <div class="summary-synopsis"><p>This check is true when the specified relationships are changing</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#context_equals/2" data-no-tooltip translate="no">context_equals(key, value)</a>

      </div>

        <div class="summary-synopsis"><p>This check is true when the value of the specified key or path in the changeset or query context equals the specified value.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#filtering_on/2" data-no-tooltip translate="no">filtering_on(path \\ [], field)</a>

          <span class="deprecated" title="`filtering_on/2` check is deprecated. Instead, add arguments and add policies that said arguments are set.

For complex queries, policies on what is being filtered on require multiple authorization passes of
the same resource, leading to a large amount of typically unnecessary complexity.

Additionally, they could yield false negatives in some scenarios, and more work would be needed
to ensure that they don't.
">deprecated</span>

      </div>

        <div class="summary-synopsis"><p>This check is true when the field provided is being referenced anywhere in a filter statement.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#loading/1" data-no-tooltip translate="no">loading(field)</a>

      </div>

        <div class="summary-synopsis"><p>This check is true when the field or relationship, or path to field, is being loaded and false when it is not.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#matches/2" data-no-tooltip translate="no">matches(description, func)</a>

      </div>

        <div class="summary-synopsis"><p>This check is true when the specified function returns true</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#never/0" data-no-tooltip translate="no">never()</a>

      </div>

        <div class="summary-synopsis"><p>This check never passes.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#relates_to_actor_via/2" data-no-tooltip translate="no">relates_to_actor_via(relationship_path, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>This check passes if the data relates to the actor via the specified relationship or path of relationships.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#relating_to_actor/1" data-no-tooltip translate="no">relating_to_actor(relationship)</a>

      </div>

        <div class="summary-synopsis"><p>This check is true when the specified relationship is being changed to the current actor.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#resource/1" data-no-tooltip translate="no">resource(resource)</a>

      </div>

        <div class="summary-synopsis"><p>This check is true when the resource name matches the provided resource name or names.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#selecting/1" data-no-tooltip translate="no">selecting(attribute)</a>

      </div>

        <div class="summary-synopsis"><p>This check is true when the field is being selected and false when it is not.</p></div>

    </div>

</div>

  </section>


  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Functions</span>
    </h1>
    <div class="functions-list">
<section class="detail" id="accessing_from/2">

  <div class="detail-header">
    <a href="#accessing_from/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">accessing_from(resource, relationship)</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/policy/check/built_in_checks.ex#L170" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> accessing_from(<a href="Ash.Resource.html#t:t/0">Ash.Resource.t</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()) :: <a href="Ash.Policy.Check.html#t:ref/0">Ash.Policy.Check.ref</a>()</pre>

      </div>

<p>This check is true when the current action is being run &quot;through&quot; a relationship.</p><p>Cases where this happens:</p><ol><li>Loading related data</li><li>Managing relationships</li><li>Aggregating data</li><li>Filtering on relationships</li></ol>
  </section>
</section>
<section class="detail" id="action/1">

  <div class="detail-header">
    <a href="#action/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">action(action)</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/policy/check/built_in_checks.ex#L59" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> action(<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>() | [<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()]) :: <a href="Ash.Policy.Check.html#t:ref/0">Ash.Policy.Check.ref</a>()</pre>

      </div>

<p>This check is true when the action name matches the provided action name or names.</p><p>This is a very common pattern, allowing action-specific policies.</p>
  </section>
</section>
<section class="detail" id="action_type/1">

  <div class="detail-header">
    <a href="#action_type/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">action_type(action_type)</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/policy/check/built_in_checks.ex#L49" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> action_type(<a href="Ash.Resource.Actions.html#t:action_type/0">Ash.Resource.Actions.action_type</a>()) :: <a href="Ash.Policy.Check.html#t:ref/0">Ash.Policy.Check.ref</a>()</pre>

      </div>

<p>This check is true when the action type matches the provided type</p><p>This is useful for writing policies that apply to all actions of a given type.</p><p>For example:</p><pre><code class="makeup elixir" translate="no"><span class="n">policy</span><span class="w"> </span><span class="n">action_type</span><span class="p" data-group-id="0089387634-1">(</span><span class="ss">:read</span><span class="p" data-group-id="0089387634-1">)</span><span class="w"> </span><span class="k" data-group-id="0089387634-2">do</span><span class="w">
  </span><span class="n">authorize_if</span><span class="w"> </span><span class="n">relates_to_actor_via</span><span class="p" data-group-id="0089387634-3">(</span><span class="ss">:owner</span><span class="p" data-group-id="0089387634-3">)</span><span class="w">
</span><span class="k" data-group-id="0089387634-2">end</span></code></pre>
  </section>
</section>
<section class="detail" id="actor_attribute_equals/2">

  <div class="detail-header">
    <a href="#actor_attribute_equals/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">actor_attribute_equals(attribute, value)</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/policy/check/built_in_checks.ex#L213" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> actor_attribute_equals(<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>(), <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">any</a>()) :: <a href="Ash.Policy.Check.html#t:ref/0">Ash.Policy.Check.ref</a>()</pre>

      </div>

<p>This check is true when the value of the specified attribute of the actor equals the specified value.</p><p>This check will <em>never</em> pass if the actor does not have the specified key. For example,
<code class="inline">actor_attribute_equals(:missing_key, nil)</code></p>
  </section>
</section>
<section class="detail" id="actor_present/0">

  <div class="detail-header">
    <a href="#actor_present/0" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">actor_present()</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/policy/check/built_in_checks.ex#L75" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> actor_present() :: <a href="Ash.Policy.Check.html#t:ref/0">Ash.Policy.Check.ref</a>()</pre>

      </div>

<p>This check is true when there is an actor specified, and false when the actor is <code class="inline">nil</code>.</p>
  </section>
</section>
<section class="detail" id="always/0">

  <div class="detail-header">
    <a href="#always/0" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">always()</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/policy/check/built_in_checks.ex#L20" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> always() :: <a href="Ash.Policy.Check.html#t:ref/0">Ash.Policy.Check.ref</a>()</pre>

      </div>

<p>This check always passes.</p><p>Can be useful for &quot;deny-list&quot; style authorization. For example:</p><pre><code class="makeup elixir" translate="no"><span class="n">policy</span><span class="w"> </span><span class="n">action_type</span><span class="p" data-group-id="0421941696-1">(</span><span class="ss">:read</span><span class="p" data-group-id="0421941696-1">)</span><span class="w"> </span><span class="k" data-group-id="0421941696-2">do</span><span class="w">
  </span><span class="n">forbid_if</span><span class="w"> </span><span class="n">actor_attribute_equals</span><span class="p" data-group-id="0421941696-3">(</span><span class="ss">:disabled</span><span class="p">,</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="0421941696-3">)</span><span class="w">
  </span><span class="n">forbid_if</span><span class="w"> </span><span class="n">actor_attribute_equals</span><span class="p" data-group-id="0421941696-4">(</span><span class="ss">:active</span><span class="p">,</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="0421941696-4">)</span><span class="w">
  </span><span class="n">authorize_if</span><span class="w"> </span><span class="n">always</span><span class="p" data-group-id="0421941696-5">(</span><span class="p" data-group-id="0421941696-5">)</span><span class="w">
</span><span class="k" data-group-id="0421941696-2">end</span></code></pre><p>Without that last clause, the policy would never pass.</p>
  </section>
</section>
<section class="detail" id="changing_attributes/1">

  <div class="detail-header">
    <a href="#changing_attributes/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">changing_attributes(opts)</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/policy/check/built_in_checks.ex#L245" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>This check is true when attribute changes correspond to the provided options.</p><p>Provide a keyword list of options or just an atom representing the attribute.</p><p>For example:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># if you are changing both first name and last name</span><span class="w">
</span><span class="n">changing_attributes</span><span class="p" data-group-id="0709763973-1">(</span><span class="p" data-group-id="0709763973-2">[</span><span class="ss">:first_name</span><span class="p">,</span><span class="w"> </span><span class="ss">:last_name</span><span class="p" data-group-id="0709763973-2">]</span><span class="p" data-group-id="0709763973-1">)</span><span class="w">

</span><span class="c1"># if you are changing first name to fred</span><span class="w">
</span><span class="n">changing_attributes</span><span class="p" data-group-id="0709763973-3">(</span><span class="ss">first_name</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0709763973-4">[</span><span class="ss">to</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;fred&quot;</span><span class="p" data-group-id="0709763973-4">]</span><span class="p" data-group-id="0709763973-3">)</span><span class="w">

</span><span class="c1"># if you are changing last name from bob</span><span class="w">
</span><span class="n">changing_attributes</span><span class="p" data-group-id="0709763973-5">(</span><span class="ss">last_name</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0709763973-6">[</span><span class="ss">from</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bob&quot;</span><span class="p" data-group-id="0709763973-6">]</span><span class="p" data-group-id="0709763973-5">)</span><span class="w">

</span><span class="c1"># if you are changing :first_name at all, last_name from &quot;bob&quot; and middle name from &quot;tom&quot; to &quot;george&quot;</span><span class="w">
</span><span class="n">changing_attributes</span><span class="p" data-group-id="0709763973-7">(</span><span class="p" data-group-id="0709763973-8">[</span><span class="ss">:first_name</span><span class="p">,</span><span class="w"> </span><span class="ss">last_name</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0709763973-9">[</span><span class="ss">from</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;bob&quot;</span><span class="p" data-group-id="0709763973-9">]</span><span class="p">,</span><span class="w"> </span><span class="ss">middle_name</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="0709763973-10">[</span><span class="ss">from</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;tom&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">to</span><span class="p">:</span><span class="w"> </span><span class="err">&quot;</span><span class="n">george</span><span class="p" data-group-id="0709763973-10">]</span><span class="p" data-group-id="0709763973-8">]</span><span class="p" data-group-id="0709763973-7">)</span></code></pre>
  </section>
</section>
<section class="detail" id="changing_relationship/1">

  <div class="detail-header">
    <a href="#changing_relationship/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">changing_relationship(relationship)</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/policy/check/built_in_checks.ex#L271" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>This check is true when the specified relationship is changing</p>
  </section>
</section>
<section class="detail" id="changing_relationships/1">

  <div class="detail-header">
    <a href="#changing_relationships/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">changing_relationships(relationships)</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/policy/check/built_in_checks.ex#L276" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>This check is true when the specified relationships are changing</p>
  </section>
</section>
<section class="detail" id="context_equals/2">

  <div class="detail-header">
    <a href="#context_equals/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">context_equals(key, value)</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/policy/check/built_in_checks.ex#L220" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>This check is true when the value of the specified key or path in the changeset or query context equals the specified value.</p>
  </section>
</section>
<section class="detail" id="filtering_on/2">

    <span id="filtering_on/1"></span>

  <div class="detail-header">
    <a href="#filtering_on/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">filtering_on(path \\ [], field)</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/policy/check/built_in_checks.ex#L116" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

    <div class="deprecated">
      This function is deprecated. `filtering_on/2` check is deprecated. Instead, add arguments and add policies that said arguments are set.

For complex queries, policies on what is being filtered on require multiple authorization passes of
the same resource, leading to a large amount of typically unnecessary complexity.

Additionally, they could yield false negatives in some scenarios, and more work would be needed
to ensure that they don't.
.
    </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> filtering_on(<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>() | [<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()], <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()) :: <a href="Ash.Policy.Check.html#t:ref/0">Ash.Policy.Check.ref</a>()</pre>

      </div>

<p>This check is true when the field provided is being referenced anywhere in a filter statement.</p><p>This applies to related filters as well. For example:</p><pre><code class="makeup elixir" translate="no"><span class="n">policy</span><span class="w"> </span><span class="n">actor_attribute_equals</span><span class="p" data-group-id="0266608636-1">(</span><span class="ss">:is_admin</span><span class="p">,</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="0266608636-1">)</span><span class="w"> </span><span class="k" data-group-id="0266608636-2">do</span><span class="w">
  </span><span class="n">forbid_if</span><span class="w"> </span><span class="n">filtering_on</span><span class="p" data-group-id="0266608636-3">(</span><span class="ss">:email</span><span class="p" data-group-id="0266608636-3">)</span><span class="w">
  </span><span class="c1"># a path can be provided as well</span><span class="w">
  </span><span class="n">forbid_if</span><span class="w"> </span><span class="n">filtering_on</span><span class="p" data-group-id="0266608636-4">(</span><span class="p" data-group-id="0266608636-5">[</span><span class="ss">:owner</span><span class="p" data-group-id="0266608636-5">]</span><span class="p">,</span><span class="w"> </span><span class="ss">:email</span><span class="p" data-group-id="0266608636-4">)</span><span class="w">
</span><span class="k" data-group-id="0266608636-2">end</span></code></pre><p>The first will return true in situations like:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="0089988509-1">(</span><span class="nc">User</span><span class="p">,</span><span class="w"> </span><span class="n">email</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;blah&quot;</span><span class="p" data-group-id="0089988509-1">)</span><span class="w">
</span><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="0089988509-2">(</span><span class="nc">Tweet</span><span class="p">,</span><span class="w"> </span><span class="n">author</span><span class="o">.</span><span class="n">email</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;blah&quot;</span><span class="p" data-group-id="0089988509-2">)</span></code></pre><p>The second will return true on queries like:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="3928468755-1">(</span><span class="nc">Post</span><span class="p">,</span><span class="w"> </span><span class="n">owner</span><span class="o">.</span><span class="n">email</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;blah&quot;</span><span class="p" data-group-id="3928468755-1">)</span><span class="w">
</span><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="3928468755-2">(</span><span class="nc">Comment</span><span class="p">,</span><span class="w"> </span><span class="n">post</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">email</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;blah&quot;</span><span class="p" data-group-id="3928468755-2">)</span></code></pre>
  </section>
</section>
<section class="detail" id="loading/1">

  <div class="detail-header">
    <a href="#loading/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">loading(field)</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/policy/check/built_in_checks.ex#L155" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> loading(<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()) :: <a href="Ash.Policy.Check.html#t:ref/0">Ash.Policy.Check.ref</a>()</pre>

      </div>

<p>This check is true when the field or relationship, or path to field, is being loaded and false when it is not.</p><p>This is always false for <code class="inline">create</code>/<code class="inline">update</code>/<code class="inline">destroy</code> actions, because you cannot load fields on those action types.</p>
  </section>
</section>
<section class="detail" id="matches/2">

  <div class="detail-header">
    <a href="#matches/2" class="detail-link" data-no-tooltip title="Link to this macro">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this macro</span>
    </a>
    <h1 class="signature" translate="no">matches(description, func)</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/policy/check/built_in_checks.ex#L281" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(macro)</span>

  </div>

  <section class="docstring">

<p>This check is true when the specified function returns true</p>
  </section>
</section>
<section class="detail" id="never/0">

  <div class="detail-header">
    <a href="#never/0" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">never()</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/policy/check/built_in_checks.ex#L31" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> never() :: <a href="Ash.Policy.Check.html#t:ref/0">Ash.Policy.Check.ref</a>()</pre>

      </div>

<p>This check never passes.</p><p>There is, generally speaking, no reason to use this, but it exists for
completeness sake.</p>
  </section>
</section>
<section class="detail" id="relates_to_actor_via/2">

    <span id="relates_to_actor_via/1"></span>

  <div class="detail-header">
    <a href="#relates_to_actor_via/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">relates_to_actor_via(relationship_path, opts \\ [])</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/policy/check/built_in_checks.ex#L197" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> relates_to_actor_via(
  <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>(),
  <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">keyword</a>()
) :: <a href="Ash.Policy.Check.html#t:ref/0">Ash.Policy.Check.ref</a>()</pre>

      </div>

<p>This check passes if the data relates to the actor via the specified relationship or path of relationships.</p><p>For <code class="inline">update</code> &amp; <code class="inline">destroy</code> actions, this check will apply to <em>the original data</em> before the changes are applied.</p><p>For <code class="inline">create</code> actions this check is very unlikely to pass. This is because relationships are modified <em>after</em> authorization
happens, not before.</p><p>For example:</p><pre><code class="makeup elixir" translate="no"><span class="n">policy</span><span class="w"> </span><span class="n">action_type</span><span class="p" data-group-id="9888329984-1">(</span><span class="ss">:read</span><span class="p" data-group-id="9888329984-1">)</span><span class="w"> </span><span class="k" data-group-id="9888329984-2">do</span><span class="w">
  </span><span class="n">authorize_if</span><span class="w"> </span><span class="n">relates_to_actor_via</span><span class="p" data-group-id="9888329984-3">(</span><span class="ss">:owner</span><span class="p" data-group-id="9888329984-3">)</span><span class="w">

  </span><span class="c1"># Path of relationships:</span><span class="w">
  </span><span class="n">authorize_if</span><span class="w"> </span><span class="n">relates_to_actor_via</span><span class="p" data-group-id="9888329984-4">(</span><span class="p" data-group-id="9888329984-5">[</span><span class="ss">:account</span><span class="p">,</span><span class="w"> </span><span class="ss">:user</span><span class="p" data-group-id="9888329984-5">]</span><span class="p" data-group-id="9888329984-4">)</span><span class="w">

  </span><span class="c1"># When the resource relates to a field of the actor:</span><span class="w">
  </span><span class="n">authorize_if</span><span class="w"> </span><span class="n">relates_to_actor_via</span><span class="p" data-group-id="9888329984-6">(</span><span class="ss">:roles</span><span class="p">,</span><span class="w"> </span><span class="ss">field</span><span class="p">:</span><span class="w"> </span><span class="ss">:role</span><span class="p" data-group-id="9888329984-6">)</span><span class="w">
</span><span class="k" data-group-id="9888329984-2">end</span></code></pre>
  </section>
</section>
<section class="detail" id="relating_to_actor/1">

  <div class="detail-header">
    <a href="#relating_to_actor/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">relating_to_actor(relationship)</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/policy/check/built_in_checks.ex#L266" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>This check is true when the specified relationship is being changed to the current actor.</p><p>This only supports <code class="inline">belongs_to</code> relationships at the moment, and will detect two cases:</p><ol><li>the <code class="inline">source_attribute</code> is being changed directly</li><li>the relationship is being changed with <code class="inline">on_lookup?: :relate</code>, and a single input is being provided.</li></ol>
  </section>
</section>
<section class="detail" id="resource/1">

  <div class="detail-header">
    <a href="#resource/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">resource(resource)</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/policy/check/built_in_checks.ex#L67" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> resource(<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>() | [<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()]) :: <a href="Ash.Policy.Check.html#t:ref/0">Ash.Policy.Check.ref</a>()</pre>

      </div>

<p>This check is true when the resource name matches the provided resource name or names.</p>
  </section>
</section>
<section class="detail" id="selecting/1">

  <div class="detail-header">
    <a href="#selecting/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">selecting(attribute)</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/policy/check/built_in_checks.ex#L145" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> selecting(<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()) :: <a href="Ash.Policy.Check.html#t:ref/0">Ash.Policy.Check.ref</a>()</pre>

      </div>

<p>This check is true when the field is being selected and false when it is not.</p><p>This won't affect filters placed on this resource, so you may also want to either:</p><ul><li>Mark the given field as <code class="inline">filterable? false</code></li><li>Add another check for <code class="inline">filtering_on(:field)</code></li></ul><p>For example:</p><pre><code class="makeup elixir" translate="no"><span class="n">policy</span><span class="w"> </span><span class="n">action_type</span><span class="p" data-group-id="0270762968-1">(</span><span class="ss">:read</span><span class="p" data-group-id="0270762968-1">)</span><span class="w"> </span><span class="k" data-group-id="0270762968-2">do</span><span class="w">
  </span><span class="c1"># The actor can read and filter on their own email</span><span class="w">
  </span><span class="n">authorize_if</span><span class="w"> </span><span class="n">expr</span><span class="p" data-group-id="0270762968-3">(</span><span class="n">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">^</span><span class="n">actor</span><span class="p" data-group-id="0270762968-4">(</span><span class="ss">:id</span><span class="p" data-group-id="0270762968-4">)</span><span class="p" data-group-id="0270762968-3">)</span><span class="w">

  </span><span class="c1"># No one else can select or filter on their email</span><span class="w">
  </span><span class="n">forbid_if</span><span class="w"> </span><span class="n">selecting</span><span class="p" data-group-id="0270762968-5">(</span><span class="ss">:email</span><span class="p" data-group-id="0270762968-5">)</span><span class="w">
  </span><span class="n">forbid_if</span><span class="w"> </span><span class="n">filtering_on</span><span class="p" data-group-id="0270762968-6">(</span><span class="ss">:email</span><span class="p" data-group-id="0270762968-6">)</span><span class="w">

  </span><span class="c1"># Otherwise, the policy passes</span><span class="w">
  </span><span class="n">authorize_if</span><span class="w"> </span><span class="n">always</span><span class="p" data-group-id="0270762968-7">(</span><span class="p" data-group-id="0270762968-7">)</span><span class="w">
</span><span class="k" data-group-id="0270762968-2">end</span></code></pre>
  </section>
</section>

    </div>
  </section>

    <footer class="footer">
      <p>

          <span class="line">
            <a href="https://hex.pm/packages/ash/3.4.8" class="footer-hex-package">Hex Package</a>

            <a href="https://preview.hex.pm/preview/ash/3.4.8">Hex Preview</a>

          </span>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="ash.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.34.2) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
