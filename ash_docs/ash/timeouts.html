<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.34.2">
    <meta name="project" content="ash v3.4.8">


    <title>Timeouts — ash v3.4.8</title>
    <link rel="stylesheet" href="dist/html-elixir-F2VRIOKR.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-K7URE6B4.js"></script>
    <script src="dist/sidebar_items-370365CE.js"></script>
    <script src="docs_config.js"></script>
    <script async src="dist/html-YIPIRHGU.js"></script>
<style>
  .livebook-badge-container + pre {
    display: none;
  }
</style>
<script>
  if (location.hostname === "hexdocs.pm") {
    var script = document.createElement("script");
    script.src = "https://plausible.io/js/script.js";
    script.setAttribute("defer", "defer")
    script.setAttribute("data-domain", "ashhexdocs")
    document.head.appendChild(script);
  }
</script>
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>mermaid.initialize({startOnLoad: true})</script>

  </head>
  <body data-type="extras" class="page-extra">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="https://github.com/ash-project/ash" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="ash" />
        </a>

      <div>
        <a href="https://github.com/ash-project/ash" class="sidebar-projectName" translate="no">
ash
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v3.4.8
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
GUIDES
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


        <li>
          <button id="tasks-list-tab-button" role="tab" data-type="tasks" aria-controls="tasks-tab-panel" aria-selected="false" tabindex="-1">
            <span translate="no">Mix</span> Tasks
          </button>
        </li>

    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


    <div id="tasks-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="tasks-list-tab-button" hidden>
      <ul id="tasks-full-list" class="full-list"></ul>
    </div>

</nav>

<main class="content">
  <output role="status" id="toast"></output>

  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of ash</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search">
            <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/documentation/topics/advanced/timeouts.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>


    <span>Timeouts</span>
  </h1>

<h2 id="ways-to-specify-timeouts" class="section-heading">
  <a href="#ways-to-specify-timeouts" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Ways to Specify Timeouts</span>
</h2>
<p>You have a few options.</p><p>You can specify a timeout when you call an action. This takes the highest precedence.</p><pre><code class="makeup elixir" translate="no"><span class="nc">Ash</span><span class="o">.</span><span class="n">read!</span><span class="p" data-group-id="7095599437-1">(</span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="ss">timeout</span><span class="p">:</span><span class="w"> </span><span class="nc">:timer</span><span class="o">.</span><span class="n">seconds</span><span class="p" data-group-id="7095599437-2">(</span><span class="mi">30</span><span class="p" data-group-id="7095599437-2">)</span><span class="p" data-group-id="7095599437-1">)</span></code></pre><p>You can specify one using <a href="Ash.Changeset.html#timeout/2"><code class="inline">Ash.Changeset.timeout/2</code></a> or <a href="Ash.Query.html#timeout/2"><code class="inline">Ash.Query.timeout/2</code></a>. This can be useful if you want to conditionally set a timeout based on the details of the request. For example, you might do something like this:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># in your resource</span><span class="w">
</span><span class="kd">defmodule</span><span class="w"> </span><span class="nc">MyApp.SetReportTimeout</span><span class="w"> </span><span class="k" data-group-id="5106837753-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Ash.Resource.Preparation</span><span class="w">

  </span><span class="kd">def</span><span class="w"> </span><span class="nf">prepare</span><span class="p" data-group-id="5106837753-2">(</span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="bp">_</span><span class="p">,</span><span class="w"> </span><span class="bp">_</span><span class="p" data-group-id="5106837753-2">)</span><span class="w"> </span><span class="k" data-group-id="5106837753-3">do</span><span class="w">
    </span><span class="k">if</span><span class="w"> </span><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">get_argument</span><span class="p" data-group-id="5106837753-4">(</span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="ss">:full_report</span><span class="p" data-group-id="5106837753-4">)</span><span class="w"> </span><span class="k" data-group-id="5106837753-5">do</span><span class="w">
      </span><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">timeout</span><span class="p" data-group-id="5106837753-6">(</span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="nc">:timer</span><span class="o">.</span><span class="n">minutes</span><span class="p" data-group-id="5106837753-7">(</span><span class="mi">3</span><span class="p" data-group-id="5106837753-7">)</span><span class="p" data-group-id="5106837753-6">)</span><span class="w">
    </span><span class="k" data-group-id="5106837753-5">else</span><span class="w">
      </span><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">timeout</span><span class="p" data-group-id="5106837753-8">(</span><span class="n">query</span><span class="p">,</span><span class="w"> </span><span class="nc">:timer</span><span class="o">.</span><span class="n">minutes</span><span class="p" data-group-id="5106837753-9">(</span><span class="mi">1</span><span class="p" data-group-id="5106837753-9">)</span><span class="p" data-group-id="5106837753-8">)</span><span class="w">
    </span><span class="k" data-group-id="5106837753-5">end</span><span class="w">
  </span><span class="k" data-group-id="5106837753-3">end</span><span class="w">
</span><span class="k" data-group-id="5106837753-1">end</span><span class="w">

</span><span class="n">actions</span><span class="w"> </span><span class="k" data-group-id="5106837753-10">do</span><span class="w">
  </span><span class="n">read</span><span class="w"> </span><span class="ss">:report_items</span><span class="w"> </span><span class="k" data-group-id="5106837753-11">do</span><span class="w">
    </span><span class="n">argument</span><span class="w"> </span><span class="ss">:full_report</span><span class="p">,</span><span class="w"> </span><span class="ss">:boolean</span><span class="p">,</span><span class="w"> </span><span class="ss">default</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="w">

    </span><span class="n">prepare</span><span class="w"> </span><span class="nc">MyApp.SetReportTimeout</span><span class="w">
  </span><span class="k" data-group-id="5106837753-11">end</span><span class="w">
</span><span class="k" data-group-id="5106837753-10">end</span></code></pre><p>You can also specify a default timeout on your domain modules.</p><pre><code class="makeup elixir" translate="no"><span class="n">execution</span><span class="w"> </span><span class="k" data-group-id="7444620734-1">do</span><span class="w">
  </span><span class="n">timeout</span><span class="w"> </span><span class="nc">:timer</span><span class="o">.</span><span class="n">seconds</span><span class="p" data-group-id="7444620734-2">(</span><span class="mi">30</span><span class="p" data-group-id="7444620734-2">)</span><span class="w"> </span><span class="c1"># the default is `:infinity`</span><span class="w">
</span><span class="k" data-group-id="7444620734-1">end</span></code></pre><p>Keep in mind, you can't specify timeouts in a before_action or after_action hook, because at that point you are already &quot;within&quot; the code that should have a timeout applied.</p><blockquote><h3 id="timeouts-use-processes" class="warning section-heading">
  <a href="#timeouts-use-processes" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">timeouts use processes</span>
</h3>
<p>Timeouts are implemented using processes. This means that potentially large query results will be copied across processes. Because of this, specifying timeouts globally or for things that you don't suspect would ever exceed that timeout is not recommended.</p></blockquote><h2 id="how-are-timeouts-handled" class="section-heading">
  <a href="#how-are-timeouts-handled" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">How are timeouts handled?</span>
</h2>
<p>Timeouts in Ash work a bit differently than other tools. The following considerations must be taken into account:</p><ol><li>If you run a resource action in a transaction, then the timeout applies to the entire transaction.</li><li>If the resource action you are running, and any of its <code class="inline">touches_resources</code> is <em>already in a transaction</em> then the timeout is ignored, as the outer transaction is handling the timeout.</li><li>If the resource is not in a transaction, and supports async execution (ash_postgres does), then everything is run in a task and awaited with the provided timeout.</li><li>If the data layer of the resource does not support timeouts, or async execution then timeouts are <strong>ignored</strong>.</li></ol>
</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="pagination.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Pagination
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="multitenancy.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Multitenancy
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

          <span class="line">
            <a href="https://hex.pm/packages/ash/3.4.8" class="footer-hex-package">Hex Package</a>

            <a href="https://preview.hex.pm/preview/ash/3.4.8">Hex Preview</a>

              (<a href="https://preview.hex.pm/preview/ash/3.4.8/show/documentation/topics/advanced/timeouts.md">current file</a>)

          </span>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="ash.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.34.2) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
