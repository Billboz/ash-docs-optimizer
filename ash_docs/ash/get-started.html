<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.34.2">
    <meta name="project" content="ash v3.4.8">


    <title>Get Started â€” ash v3.4.8</title>
    <link rel="stylesheet" href="dist/html-elixir-F2VRIOKR.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-K7URE6B4.js"></script>
    <script src="dist/sidebar_items-370365CE.js"></script>
    <script src="docs_config.js"></script>
    <script async src="dist/html-YIPIRHGU.js"></script>
<style>
  .livebook-badge-container + pre {
    display: none;
  }
</style>
<script>
  if (location.hostname === "hexdocs.pm") {
    var script = document.createElement("script");
    script.src = "https://plausible.io/js/script.js";
    script.setAttribute("defer", "defer")
    script.setAttribute("data-domain", "ashhexdocs")
    document.head.appendChild(script);
  }
</script>
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>mermaid.initialize({startOnLoad: true})</script>

  </head>
  <body data-type="extras" class="page-extra">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="https://github.com/ash-project/ash" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="ash" />
        </a>

      <div>
        <a href="https://github.com/ash-project/ash" class="sidebar-projectName" translate="no">
ash
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v3.4.8
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
GUIDES
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


        <li>
          <button id="tasks-list-tab-button" role="tab" data-type="tasks" aria-controls="tasks-tab-panel" aria-selected="false" tabindex="-1">
            <span translate="no">Mix</span> Tasks
          </button>
        </li>

    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


    <div id="tasks-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="tasks-list-tab-button" hidden>
      <ul id="tasks-full-list" class="full-list"></ul>
    </div>

</nav>

<main class="content">
  <output role="status" id="toast"></output>

  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of ash</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search">
            <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/documentation/tutorials/get-started.md#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>


    <span>Get Started</span>
  </h1>

<blockquote><h3 id="learn-with-livebook" class="tip section-heading">
  <a href="#learn-with-livebook" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Learn with Livebook</span>
</h3>
<p>We have a basic step by step tutorial in Livebook that introduces you to Ash. No prior Ash knowledge is required.
The Livebook tutorial is self contained and separate from the documentation below.
<a href="https://livebook.dev/run?url=https%3A%2F%2Fgithub.com%2Fash-project%2Fash_tutorial%2Fblob%2Fmaster%2Foverview.livemd"><img src="https://livebook.dev/badge/v1/pink.svg" alt="Run in Livebook"/></a></p></blockquote><h2 id="goals" class="section-heading">
  <a href="#goals" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Goals</span>
</h2>
<p>In this guide we will:</p><ol><li>Create a new Elixir application and add Ash as a dependency</li><li>Create a simple set of resources and see how they can be used</li><li>Go over some core concepts of Ash</li><li>Find out what material might be good to visit next</li></ol><h2 id="requirements" class="section-heading">
  <a href="#requirements" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Requirements</span>
</h2>
<p>If you want to follow along yourself, you will need the following things:</p><ol><li><a href="https://elixir-lang.org/install.html">Elixir and Erlang installed</a></li><li>A text editor to make the changes that we make</li><li>A terminal to run the examples using <code class="inline">iex</code></li></ol><h2 id="steps" class="section-heading">
  <a href="#steps" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Steps</span>
</h2>
<p>For this tutorial, we'll use examples based around creating a help desk.</p><p>We will make the following resources:</p><ul><li><code class="inline">Helpdesk.Support.Ticket</code></li><li><code class="inline">Helpdesk.Support.Representative</code></li></ul><p>The actions we will be able to take on these resources include:</p><ul><li>Opening a new Ticket</li><li>Closing a Ticket</li><li>Assigning a Ticket to a representative</li></ul><h3 id="create-a-new-project" class="section-heading">
  <a href="#create-a-new-project" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Create a new project</span>
</h3>
<!-- tabs-open --><h3 id="using-igniter-recommended" class="section-heading">
  <a href="#using-igniter-recommended" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Using Igniter (recommended)</span>
</h3>
<p>First, to use <code class="inline">mix igniter.new</code>, the archive must be installed.</p><p>To install it, run</p><pre><code class="makeup bash" translate="no"><span class="">mix archive.install hex igniter_new
</span></code></pre><p>Then, create a new project:</p><pre><code class="makeup elixir" translate="no"><span class="n">mix</span><span class="w"> </span><span class="n">igniter</span><span class="o">.</span><span class="n">new</span><span class="w"> </span><span class="n">helpdesk</span><span class="w"> </span><span class="o">--</span><span class="n">install</span><span class="w"> </span><span class="n">ash</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">cd</span><span class="w"> </span><span class="n">helpdesk</span></code></pre><p>If you already know that you want to use Phoenix and Ash together, you can use</p><pre><code class="makeup elixir" translate="no"><span class="c1"># install the archive</span><span class="w">
</span><span class="n">mix</span><span class="w"> </span><span class="n">archive</span><span class="o">.</span><span class="n">install</span><span class="w"> </span><span class="n">hex</span><span class="w"> </span><span class="n">phx_new</span><span class="w">

</span><span class="c1"># use the `--with` flag to generate the project with phx.new and add Ash</span><span class="w">
</span><span class="n">mix</span><span class="w"> </span><span class="n">igniter</span><span class="o">.</span><span class="n">new</span><span class="w"> </span><span class="n">helpdesk</span><span class="w"> </span><span class="o">--</span><span class="n">install</span><span class="w"> </span><span class="n">ash</span><span class="w"> </span><span class="o">--</span><span class="k">with</span><span class="w"> </span><span class="n">phx</span><span class="o">.</span><span class="n">new</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">cd</span><span class="w"> </span><span class="n">helpdesk</span></code></pre><p>It is a good idea to make it a git repository and commit the initial project. You'll be able to see what changes we made, and can save your changes once we're done.</p><pre><code class="makeup bash" translate="no"><span class=""># Run in your terminal
</span><span class="">git init
</span><span class="">git add -A
</span><span class="">git commit -m &quot;first commit&quot;
</span><span class="">git branch -M main
</span></code></pre><p>Open the project in your text editor, and we'll get started.</p><blockquote><h3 id="want-to-skip-to-the-end" class="info section-heading">
  <a href="#want-to-skip-to-the-end" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Want to skip to the end?</span>
</h3>
<p>Add the <code class="inline">--example</code> flag to get the example code add directly to your app!</p><pre><code class="makeup bash" translate="no"><span class="">mix igniter.new helpdesk --install ash --extend ets --example
</span></code></pre><p>Already know you want to use <code class="inline">AshPostgres</code>? Use the <code class="inline">--extend</code> argument.</p><pre><code class="makeup bash" translate="no"><span class="">mix igniter.new helpdesk --install ash,ash_postgres --example --extend postgres`
</span></code></pre><p>Want to start with a Phoenix app setup too? Use the <code class="inline">--with</code> argument.</p><pre><code class="makeup bash" translate="no"><span class="">mix archive.install hex phx_new
</span><span class="">
</span><span class="">mix igniter.new helpdesk \
</span><span class="">  --install ash,ash_postgres \
</span><span class="">  --with phx.new \
</span><span class="">  --extend postgres \
</span><span class="">  --example
</span></code></pre><p>If you generate this code, you can browse the rest of the guide, but the code shown will already be present in your application ðŸ¥³</p></blockquote><h3 id="using-mix" class="section-heading">
  <a href="#using-mix" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Using Mix</span>
</h3>
<p>We first create a new project with the <code class="inline">--sup</code> flag to add a supervision tree. This will be necessary for other follow-up tutorials.</p><pre><code class="makeup bash" translate="no"><span class=""># In your terminal
</span><span class="">mix new --sup helpdesk &amp;&amp; cd helpdesk
</span></code></pre><p>It is a good idea to make it a git repository and commit the initial project. You'll be able to see what changes we made, and can save your changes once we're done.</p><pre><code class="makeup bash" translate="no"><span class=""># Run in your terminal
</span><span class="">git init
</span><span class="">git add -A
</span><span class="">git commit -m &quot;first commit&quot;
</span><span class="">git branch -M main
</span></code></pre><p>Open the project in your text editor, and we'll get started.</p><h3 id="add-ash-to-your-application" class="section-heading">
  <a href="#add-ash-to-your-application" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Add Ash to your application</span>
</h3>
<p>Add the <code class="inline">ash</code> and <code class="inline">picosat_elixir</code> dependencies to your <code class="inline">mix.exs</code></p><pre><code class="makeup elixir" translate="no"><span class="kd">defp</span><span class="w"> </span><span class="nf">deps</span><span class="w"> </span><span class="k" data-group-id="7717566599-1">do</span><span class="w">
  </span><span class="p" data-group-id="7717566599-2">[</span><span class="w">
    </span><span class="p" data-group-id="7717566599-3">{</span><span class="ss">:ash</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;~&gt; 3.0&quot;</span><span class="p" data-group-id="7717566599-3">}</span><span class="p">,</span><span class="w">
    </span><span class="p" data-group-id="7717566599-4">{</span><span class="ss">:picosat_elixir</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;~&gt; 0.2&quot;</span><span class="p" data-group-id="7717566599-4">}</span><span class="w">
  </span><span class="p" data-group-id="7717566599-2">]</span><span class="w">
</span><span class="k" data-group-id="7717566599-1">end</span></code></pre><p>And then run <code class="inline">mix deps.get &amp;&amp; mix deps.compile</code> to install the dependencies</p><h4>Formatting</h4><p>To ensure that your code stays formatted like the examples here, you can add <code class="inline">:ash</code> as an import dependency in your <code class="inline">.formatter.exs</code>:</p><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="5980731585-1">[</span><span class="w">
  </span><span class="c1"># ...</span><span class="w">
  </span><span class="ss">import_deps</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5980731585-2">[</span><span class="n">...</span><span class="p">,</span><span class="w"> </span><span class="ss">:ash</span><span class="p" data-group-id="5980731585-2">]</span><span class="p">,</span><span class="w">
  </span><span class="c1"># ...</span><span class="w">
</span><span class="p" data-group-id="5980731585-1">]</span></code></pre><!-- tabs-close --><blockquote><h3 id="picosat-installation-issues" class="info section-heading">
  <a href="#picosat-installation-issues" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Picosat installation issues?</span>
</h3>
<p>If you have trouble compiling <code class="inline">picosat_elixir</code>, then replace <code class="inline">{:picosat_elixir, &quot;~&gt; 0.2&quot;}</code> with <code class="inline">{:simple_sat, &quot;~&gt; 0.1&quot;}</code> to use a simpler (but mildly slower) solver. You can always switch back to <code class="inline">picosat_elixir</code> later once you're done with the tutorial.</p></blockquote><blockquote><h4 class="neutral">Note</h4><p>For more auto-formatting options, see the <a href="development-utilities.html">Development Utilities guide</a>.</p></blockquote><p>And run <a href="https://hexdocs.pm/mix/Mix.Tasks.Deps.Get.html"><code class="inline">mix deps.get</code></a>, to install the dependency.</p><h3 id="building-your-first-ash-domain" class="section-heading">
  <a href="#building-your-first-ash-domain" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Building your first Ash Domain</span>
</h3>
<p>The basic building blocks of an Ash application are Ash resources. They are tied together by a domain module, which will allow you to interact with those resources.</p><h3 id="creating-our-first-resource" class="section-heading">
  <a href="#creating-our-first-resource" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Creating our first resource</span>
</h3>
<p>Let's start by creating our first resource along with our first domain. We will create the following files:</p><ul><li>The domain <code class="inline">Helpdesk.Support</code>, in <code class="inline">lib/helpdesk/support.ex</code></li><li>Our Ticket resource <code class="inline">Helpdesk.Support.Ticket</code>, in <code class="inline">lib/helpdesk/support/ticket.ex</code>.</li></ul><p>To create the required folders and files, you can use the following command in your terminal:</p><pre><code class="makeup bash" translate="no"><span class="">mkdir -p lib/helpdesk/support &amp;&amp; touch $_/ticket.ex
</span><span class="">touch lib/helpdesk/support.ex
</span></code></pre><p>Your project structure should now include the following files:</p><pre><code class="makeup elixir" translate="no"><span class="n">lib</span><span class="o">/</span><span class="w">
</span><span class="err">â”œ</span><span class="err">â”€</span><span class="w"> </span><span class="n">helpdesk</span><span class="o">/</span><span class="w">
</span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”œ</span><span class="err">â”€</span><span class="w"> </span><span class="n">support</span><span class="o">/</span><span class="w">
</span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”œ</span><span class="err">â”€</span><span class="w"> </span><span class="n">ticket</span><span class="o">.</span><span class="n">ex</span><span class="w">
</span><span class="err">â”‚</span><span class="w">  </span><span class="err">â”œ</span><span class="err">â”€</span><span class="w"> </span><span class="n">support</span><span class="o">.</span><span class="n">ex</span></code></pre><p>Add the following to the files we created</p><pre><code class="makeup elixir" translate="no"><span class="c1"># lib/helpdesk/support.ex</span><span class="w">

</span><span class="kd">defmodule</span><span class="w"> </span><span class="nc">Helpdesk.Support</span><span class="w"> </span><span class="k" data-group-id="8833756411-1">do</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Ash.Domain</span><span class="w">

  </span><span class="n">resources</span><span class="w"> </span><span class="k" data-group-id="8833756411-2">do</span><span class="w">
    </span><span class="n">resource</span><span class="w"> </span><span class="nc">Helpdesk.Support.Ticket</span><span class="w">
  </span><span class="k" data-group-id="8833756411-2">end</span><span class="w">
</span><span class="k" data-group-id="8833756411-1">end</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="c1"># lib/helpdesk/support/ticket.ex</span><span class="w">

</span><span class="kd">defmodule</span><span class="w"> </span><span class="nc">Helpdesk.Support.Ticket</span><span class="w"> </span><span class="k" data-group-id="9618877748-1">do</span><span class="w">
  </span><span class="c1"># This turns this module into a resource</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Ash.Resource</span><span class="p">,</span><span class="w"> </span><span class="ss">domain</span><span class="p">:</span><span class="w"> </span><span class="nc">Helpdesk.Support</span><span class="w">

  </span><span class="n">actions</span><span class="w"> </span><span class="k" data-group-id="9618877748-2">do</span><span class="w">
    </span><span class="c1"># Use the default implementation of the :read action</span><span class="w">
    </span><span class="n">defaults</span><span class="w"> </span><span class="p" data-group-id="9618877748-3">[</span><span class="ss">:read</span><span class="p" data-group-id="9618877748-3">]</span><span class="w">

    </span><span class="c1"># and a create action, which we&#39;ll customize later</span><span class="w">
    </span><span class="n">create</span><span class="w"> </span><span class="ss">:create</span><span class="w">
  </span><span class="k" data-group-id="9618877748-2">end</span><span class="w">

  </span><span class="c1"># Attributes are the simple pieces of data that exist on your resource</span><span class="w">
  </span><span class="n">attributes</span><span class="w"> </span><span class="k" data-group-id="9618877748-4">do</span><span class="w">
    </span><span class="c1"># Add an autogenerated UUID primary key called `:id`.</span><span class="w">
    </span><span class="n">uuid_primary_key</span><span class="w"> </span><span class="ss">:id</span><span class="w">

    </span><span class="c1"># Add a string type attribute called `:subject`</span><span class="w">
    </span><span class="n">attribute</span><span class="w"> </span><span class="ss">:subject</span><span class="p">,</span><span class="w"> </span><span class="ss">:string</span><span class="w">
  </span><span class="k" data-group-id="9618877748-4">end</span><span class="w">
</span><span class="k" data-group-id="9618877748-1">end</span></code></pre><p>Next, add your domain to your <code class="inline">config.exs</code>, and configure some backwards compatibility configuration.</p><p>Run the following to create your <code class="inline">config.exs</code> if it doesn't already exist</p><pre><code class="makeup elixir" translate="no"><span class="n">mkdir</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="n">config</span><span class="w">
</span><span class="n">touch</span><span class="w"> </span><span class="n">config</span><span class="o">/</span><span class="n">config</span><span class="o">.</span><span class="n">exs</span></code></pre><p>and add the following contents to it.</p><pre><code class="makeup elixir" translate="no"><span class="c1"># in config/config.exs</span><span class="w">
</span><span class="kn">import</span><span class="w"> </span><span class="nc">Config</span><span class="w">

</span><span class="n">config</span><span class="w"> </span><span class="ss">:helpdesk</span><span class="p">,</span><span class="w"> </span><span class="ss">:ash_domains</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1768406128-1">[</span><span class="nc">Helpdesk.Support</span><span class="p" data-group-id="1768406128-1">]</span><span class="w">

</span><span class="n">config</span><span class="w"> </span><span class="ss">:ash</span><span class="p">,</span><span class="w">
  </span><span class="ss">include_embedded_source_by_default?</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p">,</span><span class="w">
  </span><span class="ss">default_page_type</span><span class="p">:</span><span class="w"> </span><span class="ss">:keyset</span><span class="w">

</span><span class="n">config</span><span class="w"> </span><span class="ss">:ash</span><span class="p">,</span><span class="w"> </span><span class="ss">:policies</span><span class="p">,</span><span class="w">
  </span><span class="ss">no_filter_static_forbidden_reads?</span><span class="p">:</span><span class="w"> </span><span class="no">false</span></code></pre><h3 id="try-our-first-resource-out" class="section-heading">
  <a href="#try-our-first-resource-out" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Try our first resource out</span>
</h3>
<p>Run <code class="inline">iex -S mix</code> in your project's root directory and try out the following.</p><p>To create a ticket, we first make an <a href="Ash.Changeset.html"><code class="inline">Ash.Changeset</code></a> for the <code class="inline">:create</code> action of the <code class="inline">Helpdesk.Support.Ticket</code> resource. Then we pass it to the <a href="Ash.html#create!/1"><code class="inline">Ash.create!/1</code></a> function.</p><pre><code class="makeup elixir" translate="no"><span class="nc">Helpdesk.Support.Ticket</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Changeset</span><span class="o">.</span><span class="n">for_create</span><span class="p" data-group-id="3399386957-1">(</span><span class="ss">:create</span><span class="p" data-group-id="3399386957-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">create!</span><span class="p" data-group-id="3399386957-2">(</span><span class="p" data-group-id="3399386957-2">)</span></code></pre><p>This returns what we call a <code class="inline">record</code> which is an instance of a resource.</p><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="3977611033-1">#</span><span class="nc" data-group-id="3977611033-1">Helpdesk.Support.Ticket</span><span class="p" data-group-id="3977611033-1">&lt;</span><span class="w">
  </span><span class="n">...</span><span class="p">,</span><span class="w">
  </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;c0f8dc32-a018-4eb4-8656-d5810118f4ea&quot;</span><span class="p">,</span><span class="w">
  </span><span class="ss">subject</span><span class="p">:</span><span class="w"> </span><span class="no">nil</span><span class="p">,</span><span class="w">
  </span><span class="n">...</span><span class="w">
</span><span class="p" data-group-id="3977611033-1">&gt;</span></code></pre><h3 id="customizing-our-actions" class="section-heading">
  <a href="#customizing-our-actions" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Customizing our Actions</span>
</h3>
<p>One thing you may have noticed earlier is that we created a ticket without providing any input, and as a result our ticket had a <code class="inline">subject</code> of <code class="inline">nil</code>. Additionally, we don't have any other data on the ticket. Lets add a <code class="inline">status</code> attribute, ensure that <code class="inline">subject</code> can't be <code class="inline">nil</code>, and provide a better interface by giving the <code class="inline">:create</code> action a better name, and accepting <code class="inline">:subject</code> as part of the action.</p><p>We'll start with the attribute changes:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># lib/helpdesk/support/ticket.ex</span><span class="w">

</span><span class="n">attributes</span><span class="w"> </span><span class="k" data-group-id="5767730880-1">do</span><span class="w">
  </span><span class="n">...</span><span class="w">
  </span><span class="n">attribute</span><span class="w"> </span><span class="ss">:subject</span><span class="p">,</span><span class="w"> </span><span class="ss">:string</span><span class="w"> </span><span class="k" data-group-id="5767730880-2">do</span><span class="w">
    </span><span class="c1"># Don&#39;t allow `nil` values</span><span class="w">
    </span><span class="n">allow_nil?</span><span class="w"> </span><span class="no">false</span><span class="w">

    </span><span class="c1"># Allow this attribute to be public. By default, all attributes are private.</span><span class="w">
    </span><span class="n">public?</span><span class="w"> </span><span class="no">true</span><span class="w">
  </span><span class="k" data-group-id="5767730880-2">end</span><span class="w">

  </span><span class="c1"># status is either `open` or `closed`. We can add more statuses later</span><span class="w">
  </span><span class="n">attribute</span><span class="w"> </span><span class="ss">:status</span><span class="p">,</span><span class="w"> </span><span class="ss">:atom</span><span class="w"> </span><span class="k" data-group-id="5767730880-3">do</span><span class="w">
    </span><span class="c1"># Constraints allow you to provide extra rules for the value.</span><span class="w">
    </span><span class="c1"># The available constraints depend on the type</span><span class="w">
    </span><span class="c1"># See the documentation for each type to know what constraints are available</span><span class="w">
    </span><span class="c1"># Since atoms are generally only used when we know all of the values</span><span class="w">
    </span><span class="c1"># it provides a `one_of` constraint, that only allows those values</span><span class="w">
    </span><span class="n">constraints</span><span class="w"> </span><span class="p" data-group-id="5767730880-4">[</span><span class="ss">one_of</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5767730880-5">[</span><span class="ss">:open</span><span class="p">,</span><span class="w"> </span><span class="ss">:closed</span><span class="p" data-group-id="5767730880-5">]</span><span class="p" data-group-id="5767730880-4">]</span><span class="w">

    </span><span class="c1"># The status defaulting to open makes sense</span><span class="w">
    </span><span class="n">default</span><span class="w"> </span><span class="ss">:open</span><span class="w">

    </span><span class="c1"># We also don&#39;t want status to ever be `nil`</span><span class="w">
    </span><span class="n">allow_nil?</span><span class="w"> </span><span class="no">false</span><span class="w">
  </span><span class="k" data-group-id="5767730880-3">end</span><span class="w">
</span><span class="k" data-group-id="5767730880-1">end</span></code></pre><p>And then replace the <code class="inline">:create</code> action with <code class="inline">:open</code>, and accept <code class="inline">:subject</code> as input.</p><pre><code class="makeup elixir" translate="no"><span class="c1"># lib/helpdesk/support/ticket.ex</span><span class="w">

</span><span class="n">actions</span><span class="w"> </span><span class="k" data-group-id="8088325880-1">do</span><span class="w">
  </span><span class="n">...</span><span class="w">
  </span><span class="n">create</span><span class="w"> </span><span class="ss">:open</span><span class="w"> </span><span class="k" data-group-id="8088325880-2">do</span><span class="w">
    </span><span class="n">accept</span><span class="w"> </span><span class="p" data-group-id="8088325880-3">[</span><span class="ss">:subject</span><span class="p" data-group-id="8088325880-3">]</span><span class="w">
  </span><span class="k" data-group-id="8088325880-2">end</span><span class="w">
</span><span class="k" data-group-id="8088325880-1">end</span></code></pre><p>Let's try these changes in <code class="inline">iex</code>:</p><p>We use <code class="inline">create!</code> with an exclamation point here because that will raise the error which gives a nicer view of the error in <code class="inline">iex</code></p><pre><code class="makeup elixir" translate="no"><span class="c1"># Use this to pick up changes you&#39;ve made to your code, or restart your session</span><span class="w">
</span><span class="n">recompile</span><span class="p" data-group-id="7152077657-1">(</span><span class="p" data-group-id="7152077657-1">)</span><span class="w">

</span><span class="nc">Helpdesk.Support.Ticket</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Changeset</span><span class="o">.</span><span class="n">for_create</span><span class="p" data-group-id="7152077657-2">(</span><span class="ss">:open</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7152077657-3">%{</span><span class="ss">subject</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;My mouse won&#39;t click!&quot;</span><span class="p" data-group-id="7152077657-3">}</span><span class="p" data-group-id="7152077657-2">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">create!</span><span class="p" data-group-id="7152077657-4">(</span><span class="p" data-group-id="7152077657-4">)</span></code></pre><p>And we can see our newly created ticket with a subject and a status.</p><pre><code class="makeup elixir" translate="no"><span class="p" data-group-id="4287671635-1">#</span><span class="nc" data-group-id="4287671635-1">Helpdesk.Support.Ticket</span><span class="p" data-group-id="4287671635-1">&lt;</span><span class="w">
  </span><span class="n">...</span><span class="w">
  </span><span class="ss">id</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3c94d310-7b5e-41f0-9104-5b193b831a5d&quot;</span><span class="p">,</span><span class="w">
  </span><span class="ss">status</span><span class="p">:</span><span class="w"> </span><span class="ss">:open</span><span class="p">,</span><span class="w">
  </span><span class="ss">subject</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;My mouse won&#39;t click!&quot;</span><span class="p">,</span><span class="w">
  </span><span class="n">...</span><span class="w">
</span><span class="p" data-group-id="4287671635-1">&gt;</span></code></pre><p>If we didn't include a subject, or left off the arguments completely, we would see an error instead</p><pre><code class="text">** (Ash.Error.Invalid) Invalid Error

* attribute subject is required</code></pre><h3 id="updates-and-validations" class="section-heading">
  <a href="#updates-and-validations" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Updates and validations</span>
</h3>
<p>Now let's add some logic to close a ticket. This time we'll add an <code class="inline">update</code> action.</p><p>Here we will use a <code class="inline">change</code>. Changes allow you to customize how an action executes with very fine-grained control. There are built-in changes that are automatically available as functions, but you can define your own and pass it in as shown below. You can add multiple, and they will be run in order. See the <a href="Ash.Changeset.html"><code class="inline">Ash.Changeset</code></a> module documentation for more.</p><pre><code class="makeup elixir" translate="no"><span class="c1"># lib/helpdesk/support/ticket.ex</span><span class="w">

</span><span class="n">actions</span><span class="w"> </span><span class="k" data-group-id="2151158299-1">do</span><span class="w">
  </span><span class="n">...</span><span class="w">
  </span><span class="n">update</span><span class="w"> </span><span class="ss">:close</span><span class="w"> </span><span class="k" data-group-id="2151158299-2">do</span><span class="w">
    </span><span class="c1"># We don&#39;t want to accept any input here</span><span class="w">
    </span><span class="n">accept</span><span class="w"> </span><span class="p" data-group-id="2151158299-3">[</span><span class="p" data-group-id="2151158299-3">]</span><span class="w">

    </span><span class="n">validate</span><span class="w"> </span><span class="n">attribute_does_not_equal</span><span class="p" data-group-id="2151158299-4">(</span><span class="ss">:status</span><span class="p">,</span><span class="w"> </span><span class="ss">:closed</span><span class="p" data-group-id="2151158299-4">)</span><span class="w"> </span><span class="k" data-group-id="2151158299-5">do</span><span class="w">
      </span><span class="n">message</span><span class="w"> </span><span class="s">&quot;Ticket is already closed&quot;</span><span class="w">
    </span><span class="k" data-group-id="2151158299-5">end</span><span class="w">

    </span><span class="n">change</span><span class="w"> </span><span class="n">set_attribute</span><span class="p" data-group-id="2151158299-6">(</span><span class="ss">:status</span><span class="p">,</span><span class="w"> </span><span class="ss">:closed</span><span class="p" data-group-id="2151158299-6">)</span><span class="w">
    </span><span class="c1"># A custom change could be added like so:</span><span class="w">
    </span><span class="c1">#</span><span class="w">
    </span><span class="c1"># change MyCustomChange</span><span class="w">
    </span><span class="c1"># change {MyCustomChange, opt: :val}</span><span class="w">
  </span><span class="k" data-group-id="2151158299-2">end</span><span class="w">
</span><span class="k" data-group-id="2151158299-1">end</span></code></pre><p>Try out opening and closing a ticket in <code class="inline">iex</code>:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># Use this to pick up changes you&#39;ve made to your code, or restart your session</span><span class="w">
</span><span class="n">recompile</span><span class="p" data-group-id="5233082519-1">(</span><span class="p" data-group-id="5233082519-1">)</span><span class="w">

</span><span class="c1"># parenthesis so you can paste into iex</span><span class="w">
</span><span class="n">ticket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5233082519-2">(</span><span class="w">
  </span><span class="nc">Helpdesk.Support.Ticket</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Changeset</span><span class="o">.</span><span class="n">for_create</span><span class="p" data-group-id="5233082519-3">(</span><span class="ss">:open</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5233082519-4">%{</span><span class="ss">subject</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;My mouse won&#39;t click!&quot;</span><span class="p" data-group-id="5233082519-4">}</span><span class="p" data-group-id="5233082519-3">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">create!</span><span class="p" data-group-id="5233082519-5">(</span><span class="p" data-group-id="5233082519-5">)</span><span class="w">
</span><span class="p" data-group-id="5233082519-2">)</span><span class="w">

</span><span class="n">ticket</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Changeset</span><span class="o">.</span><span class="n">for_update</span><span class="p" data-group-id="5233082519-6">(</span><span class="ss">:close</span><span class="p" data-group-id="5233082519-6">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">update!</span><span class="p" data-group-id="5233082519-7">(</span><span class="p" data-group-id="5233082519-7">)</span><span class="w">

</span><span class="p" data-group-id="5233082519-8">#</span><span class="nc" data-group-id="5233082519-8">Helpdesk.Support.Ticket</span><span class="p" data-group-id="5233082519-8">&lt;</span><span class="w">
  </span><span class="n">...</span><span class="w">
  </span><span class="ss">status</span><span class="p">:</span><span class="w"> </span><span class="ss">:closed</span><span class="p">,</span><span class="w">
  </span><span class="ss">subject</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;My mouse won&#39;t click!&quot;</span><span class="p">,</span><span class="w">
  </span><span class="n">...</span><span class="w">
</span><span class="p" data-group-id="5233082519-8">&gt;</span></code></pre><h3 id="querying-without-persistence" class="section-heading">
  <a href="#querying-without-persistence" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Querying without persistence</span>
</h3>
<p>So far we haven't used a data layer that does any persistence, like storing records in a database. All that this simple resource does is return the record back to us. You can see this lack of persistence by attempting to use a <code class="inline">read</code> action:</p><pre><code class="makeup elixir" translate="no"><span class="nc">Ash</span><span class="o">.</span><span class="n">read!</span><span class="p" data-group-id="7903672479-1">(</span><span class="nc">Helpdesk.Support.Ticket</span><span class="p" data-group-id="7903672479-1">)</span></code></pre><p>Which will raise an error explaining that there is no data to be read for that resource.</p><p>In order to save our data somewhere, we need to add a data layer to our resources. Before we do that, however, let's go over how Ash allows us to work against many different data layers (or even no data layer at all).</p><p>Resources without a data layer will implicitly be using <a href="Ash.DataLayer.Simple.html"><code class="inline">Ash.DataLayer.Simple</code></a>. This data is not persisted anywhere, and must be provided when running queries. It provides a utility for just this purpose, <a href="Ash.DataLayer.Simple.html#set_data/2"><code class="inline">Ash.DataLayer.Simple.set_data/2</code></a>.</p><p>Try the following in <code class="inline">iex</code>. We will open some tickets, and close some of them, and then use <a href="Ash.DataLayer.Simple.html#set_data/2"><code class="inline">Ash.DataLayer.Simple.set_data/2</code></a> to use those tickets.</p><pre><code class="makeup elixir" translate="no"><span class="c1"># Ash.Query is a macro, so it must be required</span><span class="w">
</span><span class="kn">require</span><span class="w"> </span><span class="nc">Ash.Query</span><span class="w">

</span><span class="n">tickets</span><span class="w"> </span><span class="o">=</span><span class="w">
  </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">5</span><span class="w"> </span><span class="k" data-group-id="7718658719-1">do</span><span class="w">
    </span><span class="n">ticket</span><span class="w"> </span><span class="o">=</span><span class="w">
      </span><span class="nc">Helpdesk.Support.Ticket</span><span class="w">
      </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Changeset</span><span class="o">.</span><span class="n">for_create</span><span class="p" data-group-id="7718658719-2">(</span><span class="ss">:open</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7718658719-3">%{</span><span class="ss">subject</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Issue </span><span class="si" data-group-id="7718658719-4">#{</span><span class="n">i</span><span class="si" data-group-id="7718658719-4">}</span><span class="s">&quot;</span><span class="p" data-group-id="7718658719-3">}</span><span class="p" data-group-id="7718658719-2">)</span><span class="w">
      </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">create!</span><span class="p" data-group-id="7718658719-5">(</span><span class="p" data-group-id="7718658719-5">)</span><span class="w">

    </span><span class="k">if</span><span class="w"> </span><span class="n">rem</span><span class="p" data-group-id="7718658719-6">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="7718658719-6">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="7718658719-7">do</span><span class="w">
      </span><span class="n">ticket</span><span class="w">
      </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Changeset</span><span class="o">.</span><span class="n">for_update</span><span class="p" data-group-id="7718658719-8">(</span><span class="ss">:close</span><span class="p" data-group-id="7718658719-8">)</span><span class="w">
      </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">update!</span><span class="p" data-group-id="7718658719-9">(</span><span class="p" data-group-id="7718658719-9">)</span><span class="w">
    </span><span class="k" data-group-id="7718658719-7">else</span><span class="w">
      </span><span class="n">ticket</span><span class="w">
    </span><span class="k" data-group-id="7718658719-7">end</span><span class="w">
  </span><span class="k" data-group-id="7718658719-1">end</span></code></pre><p>Find the tickets where the subject contains <code class="inline">&quot;2&quot;</code>. Note that the we're setting the ticket data that we're querying using <code class="inline">set_data</code>.</p><pre><code class="makeup elixir" translate="no"><span class="nc">Helpdesk.Support.Ticket</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="9441964951-1">(</span><span class="n">contains</span><span class="p" data-group-id="9441964951-2">(</span><span class="n">subject</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;2&quot;</span><span class="p" data-group-id="9441964951-2">)</span><span class="p" data-group-id="9441964951-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.DataLayer.Simple</span><span class="o">.</span><span class="n">set_data</span><span class="p" data-group-id="9441964951-3">(</span><span class="n">tickets</span><span class="p" data-group-id="9441964951-3">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">read!</span><span class="p" data-group-id="9441964951-4">(</span><span class="p" data-group-id="9441964951-4">)</span></code></pre><p>Find the tickets that are <em>closed</em> and their subject does <em>not</em> contain <code class="inline">&quot;4&quot;</code></p><pre><code class="makeup elixir" translate="no"><span class="nc">Helpdesk.Support.Ticket</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="6085191814-1">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:closed</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="p" data-group-id="6085191814-2">(</span><span class="n">contains</span><span class="p" data-group-id="6085191814-3">(</span><span class="n">subject</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;4&quot;</span><span class="p" data-group-id="6085191814-3">)</span><span class="p" data-group-id="6085191814-2">)</span><span class="p" data-group-id="6085191814-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.DataLayer.Simple</span><span class="o">.</span><span class="n">set_data</span><span class="p" data-group-id="6085191814-4">(</span><span class="n">tickets</span><span class="p" data-group-id="6085191814-4">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">read!</span><span class="p" data-group-id="6085191814-5">(</span><span class="p" data-group-id="6085191814-5">)</span></code></pre><p>The examples above could be easily implemented with <code class="inline">Enum.filter</code>, but the real power here is to allow you to use the same tools when working with any data layer.</p><p>Even though it doesn't persist data in any way, <a href="Ash.DataLayer.Simple.html"><code class="inline">Ash.DataLayer.Simple</code></a> can be useful to model static data, or be used for resources where all the actions are manual and inject data from other sources.</p><h3 id="adding-basic-persistence" class="section-heading">
  <a href="#adding-basic-persistence" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Adding basic persistence</span>
</h3>
<p>Before we get into working with relationships, let's add some real persistence to our resource. This will let us add relationships and try out querying data.</p><p>There is a built in data layer that is useful for testing and prototyping, that uses <a href="https://elixir-lang.org/getting-started/mix-otp/ets.html">ETS</a>. ETS (Erlang Term Storage) is OTP's in-memory database, so the data won't actually stick around beyond the lifespan of your program, but it's a simple way to try things out.</p><p>To add it to your resource, modify it like so:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># lib/helpdesk/support/ticket.ex</span><span class="w">

</span><span class="kn">use</span><span class="w"> </span><span class="nc">Ash.Resource</span><span class="p">,</span><span class="w">
  </span><span class="ss">domain</span><span class="p">:</span><span class="w"> </span><span class="nc">Helpdesk.Support</span><span class="p">,</span><span class="w">
  </span><span class="ss">data_layer</span><span class="p">:</span><span class="w"> </span><span class="nc">Ash.DataLayer.Ets</span></code></pre><p>Now we can slightly modify our code above, by removing the <a href="Ash.DataLayer.Simple.html#set_data/2"><code class="inline">Ash.DataLayer.Simple.set_data/2</code></a> calls, and we can see our persistence in action. Remember, ETS is in-memory, meaning restarting your application/iex session will remove all of the data.</p><pre><code class="makeup elixir" translate="no"><span class="c1"># Use this to pick up changes you&#39;ve made to your code, or restart your session</span><span class="w">
</span><span class="n">recompile</span><span class="p" data-group-id="3918647797-1">(</span><span class="p" data-group-id="3918647797-1">)</span><span class="w">

</span><span class="kn">require</span><span class="w"> </span><span class="nc">Ash.Query</span><span class="w">

</span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="mi">5</span><span class="w"> </span><span class="k" data-group-id="3918647797-2">do</span><span class="w">
  </span><span class="n">ticket</span><span class="w"> </span><span class="o">=</span><span class="w">
    </span><span class="nc">Helpdesk.Support.Ticket</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Changeset</span><span class="o">.</span><span class="n">for_create</span><span class="p" data-group-id="3918647797-3">(</span><span class="ss">:open</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3918647797-4">%{</span><span class="ss">subject</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Issue </span><span class="si" data-group-id="3918647797-5">#{</span><span class="n">i</span><span class="si" data-group-id="3918647797-5">}</span><span class="s">&quot;</span><span class="p" data-group-id="3918647797-4">}</span><span class="p" data-group-id="3918647797-3">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">create!</span><span class="p" data-group-id="3918647797-6">(</span><span class="p" data-group-id="3918647797-6">)</span><span class="w">

  </span><span class="k">if</span><span class="w"> </span><span class="n">rem</span><span class="p" data-group-id="3918647797-7">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="3918647797-7">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k" data-group-id="3918647797-8">do</span><span class="w">
    </span><span class="n">ticket</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Changeset</span><span class="o">.</span><span class="n">for_update</span><span class="p" data-group-id="3918647797-9">(</span><span class="ss">:close</span><span class="p" data-group-id="3918647797-9">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">update!</span><span class="p" data-group-id="3918647797-10">(</span><span class="p" data-group-id="3918647797-10">)</span><span class="w">
  </span><span class="k" data-group-id="3918647797-8">end</span><span class="w">
</span><span class="k" data-group-id="3918647797-2">end</span><span class="w">

</span><span class="c1"># Show the tickets where the subject contains &quot;2&quot;</span><span class="w">
</span><span class="nc">Helpdesk.Support.Ticket</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="3918647797-11">(</span><span class="n">contains</span><span class="p" data-group-id="3918647797-12">(</span><span class="n">subject</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;2&quot;</span><span class="p" data-group-id="3918647797-12">)</span><span class="p" data-group-id="3918647797-11">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">read!</span><span class="p" data-group-id="3918647797-13">(</span><span class="p" data-group-id="3918647797-13">)</span><span class="w">

</span><span class="c1"># Show the tickets that are closed and their subject does not contain &quot;4&quot;</span><span class="w">
</span><span class="nc">Helpdesk.Support.Ticket</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Query</span><span class="o">.</span><span class="n">filter</span><span class="p" data-group-id="3918647797-14">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">:closed</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="p" data-group-id="3918647797-15">(</span><span class="n">contains</span><span class="p" data-group-id="3918647797-16">(</span><span class="n">subject</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;4&quot;</span><span class="p" data-group-id="3918647797-16">)</span><span class="p" data-group-id="3918647797-15">)</span><span class="p" data-group-id="3918647797-14">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">read!</span><span class="p" data-group-id="3918647797-17">(</span><span class="p" data-group-id="3918647797-17">)</span></code></pre><h3 id="adding-relationships" class="section-heading">
  <a href="#adding-relationships" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Adding relationships</span>
</h3>
<p>Now we want to be able to assign a Ticket to a Representative. First, let's create the Representative resource:</p><pre><code class="makeup elixir" translate="no"><span class="c1"># lib/helpdesk/support/representative.ex</span><span class="w">

</span><span class="kd">defmodule</span><span class="w"> </span><span class="nc">Helpdesk.Support.Representative</span><span class="w"> </span><span class="k" data-group-id="6814032761-1">do</span><span class="w">
  </span><span class="c1"># This turns this module into a resource using the in memory ETS data layer</span><span class="w">
  </span><span class="kn">use</span><span class="w"> </span><span class="nc">Ash.Resource</span><span class="p">,</span><span class="w">
    </span><span class="ss">domain</span><span class="p">:</span><span class="w"> </span><span class="nc">Helpdesk.Support</span><span class="p">,</span><span class="w">
    </span><span class="ss">data_layer</span><span class="p">:</span><span class="w"> </span><span class="nc">Ash.DataLayer.Ets</span><span class="w">

  </span><span class="n">actions</span><span class="w"> </span><span class="k" data-group-id="6814032761-2">do</span><span class="w">
    </span><span class="c1"># Add the default simple actions</span><span class="w">
    </span><span class="n">defaults</span><span class="w"> </span><span class="p" data-group-id="6814032761-3">[</span><span class="ss">:read</span><span class="p" data-group-id="6814032761-3">]</span><span class="w">

    </span><span class="n">create</span><span class="w"> </span><span class="ss">:create</span><span class="w"> </span><span class="k" data-group-id="6814032761-4">do</span><span class="w">
      </span><span class="n">accept</span><span class="w"> </span><span class="p" data-group-id="6814032761-5">[</span><span class="ss">:name</span><span class="p" data-group-id="6814032761-5">]</span><span class="w">
    </span><span class="k" data-group-id="6814032761-4">end</span><span class="w">
  </span><span class="k" data-group-id="6814032761-2">end</span><span class="w">

  </span><span class="c1"># Attributes are the simple pieces of data that exist on your resource</span><span class="w">
  </span><span class="n">attributes</span><span class="w"> </span><span class="k" data-group-id="6814032761-6">do</span><span class="w">
    </span><span class="c1"># Add an autogenerated UUID primary key called `:id`.</span><span class="w">
    </span><span class="n">uuid_primary_key</span><span class="w"> </span><span class="ss">:id</span><span class="w">

    </span><span class="c1"># Add a string type attribute called `:name`</span><span class="w">
    </span><span class="n">attribute</span><span class="w"> </span><span class="ss">:name</span><span class="p">,</span><span class="w"> </span><span class="ss">:string</span><span class="w"> </span><span class="k" data-group-id="6814032761-7">do</span><span class="w">
      </span><span class="c1"># Make the attribute public in order to give a name when calling functions from `Ash.Changeset`.</span><span class="w">
      </span><span class="n">public?</span><span class="w"> </span><span class="no">true</span><span class="w">
    </span><span class="k" data-group-id="6814032761-7">end</span><span class="w">
  </span><span class="k" data-group-id="6814032761-6">end</span><span class="w">

  </span><span class="n">relationships</span><span class="w"> </span><span class="k" data-group-id="6814032761-8">do</span><span class="w">
    </span><span class="c1"># `has_many` means that the destination attribute is not unique, therefore many related records could exist.</span><span class="w">
    </span><span class="c1"># We assume that the destination attribute is `representative_id` based</span><span class="w">
    </span><span class="c1"># on the module name of this resource and that the source attribute is `id`.</span><span class="w">
    </span><span class="n">has_many</span><span class="w"> </span><span class="ss">:tickets</span><span class="p">,</span><span class="w"> </span><span class="nc">Helpdesk.Support.Ticket</span><span class="w">
  </span><span class="k" data-group-id="6814032761-8">end</span><span class="w">
</span><span class="k" data-group-id="6814032761-1">end</span></code></pre><p>Now let's modify our Ticket resource to have the inverse relationship to the Representative.</p><pre><code class="makeup elixir" translate="no"><span class="c1"># lib/helpdesk/support/ticket.ex</span><span class="w">

</span><span class="n">relationships</span><span class="w"> </span><span class="k" data-group-id="8939744616-1">do</span><span class="w">
  </span><span class="c1"># belongs_to means that the destination attribute is unique, meaning only one related record could exist.</span><span class="w">
  </span><span class="c1"># We assume that the destination attribute is `representative_id` based</span><span class="w">
  </span><span class="c1"># on the name of this relationship and that the source attribute is `representative_id`.</span><span class="w">
  </span><span class="c1"># We create `representative_id` automatically.</span><span class="w">
  </span><span class="n">belongs_to</span><span class="w"> </span><span class="ss">:representative</span><span class="p">,</span><span class="w"> </span><span class="nc">Helpdesk.Support.Representative</span><span class="w">
</span><span class="k" data-group-id="8939744616-1">end</span></code></pre><p>Finally, let's add our new Representative resource to our domain module</p><pre><code class="makeup elixir" translate="no"><span class="c1"># lib/helpdesk/support.ex</span><span class="w">

</span><span class="n">resources</span><span class="w"> </span><span class="k" data-group-id="0034169786-1">do</span><span class="w">
 </span><span class="n">...</span><span class="w">
 </span><span class="n">resource</span><span class="w"> </span><span class="nc">Helpdesk.Support.Representative</span><span class="w">
</span><span class="k" data-group-id="0034169786-1">end</span></code></pre><p>You may notice that if you don't add the resource to your domain, or if you don't add the <code class="inline">belongs_to</code> relationship, that you'll get helpful errors at compile time. Helpful compile time validations are a core concept of Ash as we really want to ensure that your application is valid.</p><h2 id="working-with-relationships" class="section-heading">
  <a href="#working-with-relationships" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Working with relationships</span>
</h2>
<p>The simplest way to work with belongs to relationships is to allow directly editing the underlying id field.</p><blockquote><h3 id="managing-relationships" class="tip section-heading">
  <a href="#managing-relationships" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">managing relationships</span>
</h3>
<p>There are a wide array of options when managing relationships, and we won't cover all of them here. See the <a href="relationships.html#managing-relationships">Managing Relationships guide</a> for more.</p></blockquote><p>Add the <code class="inline">assign</code> action to allow us to assign a Ticket to a Representative.</p><pre><code class="makeup elixir" translate="no"><span class="c1"># lib/helpdesk/support/ticket.ex</span><span class="w">

</span><span class="n">update</span><span class="w"> </span><span class="ss">:assign</span><span class="w"> </span><span class="k" data-group-id="7226420457-1">do</span><span class="w">
  </span><span class="n">accept</span><span class="w"> </span><span class="p" data-group-id="7226420457-2">[</span><span class="ss">:representative_id</span><span class="p" data-group-id="7226420457-2">]</span><span class="w">
</span><span class="k" data-group-id="7226420457-1">end</span></code></pre><p>Let's try it out in our <code class="inline">iex</code> console!</p><p>Use <code class="inline">recompile</code> to pick up changes you've made to your code, or just restart your session.</p><pre><code class="makeup elixir" translate="no"><span class="n">recompile</span><span class="p" data-group-id="2125766553-1">(</span><span class="p" data-group-id="2125766553-1">)</span></code></pre><h3 id="open-a-ticket" class="section-heading">
  <a href="#open-a-ticket" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Open a Ticket</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="n">ticket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="5102657636-1">(</span><span class="w">
  </span><span class="nc">Helpdesk.Support.Ticket</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Changeset</span><span class="o">.</span><span class="n">for_create</span><span class="p" data-group-id="5102657636-2">(</span><span class="ss">:open</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="5102657636-3">%{</span><span class="ss">subject</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;I can&#39;t find my hand!&quot;</span><span class="p" data-group-id="5102657636-3">}</span><span class="p" data-group-id="5102657636-2">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">create!</span><span class="p" data-group-id="5102657636-4">(</span><span class="p" data-group-id="5102657636-4">)</span><span class="w">
</span><span class="p" data-group-id="5102657636-1">)</span></code></pre><h3 id="create-a-representative" class="section-heading">
  <a href="#create-a-representative" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Create a Representative</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="n">representative</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p" data-group-id="6764430238-1">(</span><span class="w">
  </span><span class="nc">Helpdesk.Support.Representative</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Changeset</span><span class="o">.</span><span class="n">for_create</span><span class="p" data-group-id="6764430238-2">(</span><span class="ss">:create</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="6764430238-3">%{</span><span class="ss">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Joe Armstrong&quot;</span><span class="p" data-group-id="6764430238-3">}</span><span class="p" data-group-id="6764430238-2">)</span><span class="w">
  </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">create!</span><span class="p" data-group-id="6764430238-4">(</span><span class="p" data-group-id="6764430238-4">)</span><span class="w">
</span><span class="p" data-group-id="6764430238-1">)</span></code></pre><h3 id="assign-that-representative-to-the-ticket" class="section-heading">
  <a href="#assign-that-representative-to-the-ticket" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Assign that Representative to the Ticket</span>
</h3>
<pre><code class="makeup elixir" translate="no"><span class="n">ticket</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash.Changeset</span><span class="o">.</span><span class="n">for_update</span><span class="p" data-group-id="1572118269-1">(</span><span class="ss">:assign</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="1572118269-2">%{</span><span class="ss">representative_id</span><span class="p">:</span><span class="w"> </span><span class="n">representative</span><span class="o">.</span><span class="n">id</span><span class="p" data-group-id="1572118269-2">}</span><span class="p" data-group-id="1572118269-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Ash</span><span class="o">.</span><span class="n">update!</span><span class="p" data-group-id="1572118269-3">(</span><span class="p" data-group-id="1572118269-3">)</span></code></pre><h3 id="what-next" class="section-heading">
  <a href="#what-next" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">What next?</span>
</h3>
<p>What you've seen above barely scratches the surface of what Ash can do. In a lot of ways, it will look very similar to other tools that you've seen. If all that you ever used was the above, then realistically you won't see much benefit to using Ash.</p><p>Where Ash shines however, is all of the tools that can work <em>with</em> your resources. You have the ability to extend the framework yourself, and apply consistent design patterns that enable unparalleled efficiency, power and flexibility as your application grows.</p><h4>Get Help</h4><ul><li>Check out <a href="https://elixirforum.com/c/ash-framework-forum">ElixirForum</a></li><li>Join our <a href="https://discord.gg/D7FNG2q">Discord server</a></li><li>Open a <a href="https://github.com/ash-project/ash/issues/new/choose">GitHub issue</a></li></ul><h4>Persist your data</h4><p>See <a href="https://hexdocs.pm/ash_postgres">The AshPostgres getting started guide</a> to see how to back your resources with Postgres. This is highly recommended, as the Postgres data layer provides tons of advanced capabilities.</p><h4>Add a web API</h4><p>Check out <a href="https://hexdocs.pm/ash_json_api">AshJsonApi</a> and <a href="https://hexdocs.pm/ash_graphql">AshGraphql</a> extensions to build APIs around your resource</p><h4>Authorize access and work with users</h4><p>See the <a href="policies.html">Policies guide</a> for information on how to authorize access to your resources using actors and policies.</p><h4>Clean up your code that uses Ash?</h4><p>Creating and using changesets manually can be verbose, and they all look very similar. Luckily, Ash has your back and can help you build high quality interfaces for you!</p><p>Check out the <a href="code-interfaces.html">Code Interface Guide</a> to derive things like <code class="inline">Helpdesk.Support.Ticket.assign!(representative.id)</code></p>
</div>

<div class="bottom-actions" id="bottom-actions">
  <div class="bottom-actions-item">

      <a href="readme.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          â† Previous Page
        </span>
        <span class="title">
Home
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="what-is-ash.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page â†’
        </span>
        <span class="title">
What is Ash?
        </span>
      </a>

  </div>
</div>
    <footer class="footer">
      <p>

          <span class="line">
            <a href="https://hex.pm/packages/ash/3.4.8" class="footer-hex-package">Hex Package</a>

            <a href="https://preview.hex.pm/preview/ash/3.4.8">Hex Preview</a>

              (<a href="https://preview.hex.pm/preview/ash/3.4.8/show/documentation/tutorials/get-started.md">current file</a>)

          </span>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="ash.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.34.2) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
