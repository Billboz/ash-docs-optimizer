<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.34.2">
    <meta name="project" content="ash v3.4.8">


    <title>Ash.Resource.Change.Builtins â€” ash v3.4.8</title>
    <link rel="stylesheet" href="dist/html-elixir-F2VRIOKR.css" />


    <script src="dist/handlebars.runtime-NWIB6V2M.js"></script>
    <script src="dist/handlebars.templates-K7URE6B4.js"></script>
    <script src="dist/sidebar_items-370365CE.js"></script>
    <script src="docs_config.js"></script>
    <script async src="dist/html-YIPIRHGU.js"></script>
<style>
  .livebook-badge-container + pre {
    display: none;
  }
</style>
<script>
  if (location.hostname === "hexdocs.pm") {
    var script = document.createElement("script");
    script.src = "https://plausible.io/js/script.js";
    script.setAttribute("defer", "defer")
    script.setAttribute("data-domain", "ashhexdocs")
    document.head.appendChild(script);
  }
</script>
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<script>mermaid.initialize({startOnLoad: true})</script>

  </head>
  <body data-type="modules" class="page-module">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="body-wrapper">

<button id="sidebar-menu" class="sidebar-button sidebar-toggle" aria-label="toggle sidebar" aria-controls="sidebar">
  <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
</button>

<nav id="sidebar" class="sidebar">

  <div class="sidebar-header">
    <div class="sidebar-projectInfo">

        <a href="https://github.com/ash-project/ash" class="sidebar-projectImage">
          <img src="assets/logo.png" alt="ash" />
        </a>

      <div>
        <a href="https://github.com/ash-project/ash" class="sidebar-projectName" translate="no">
ash
        </a>
        <div class="sidebar-projectVersion" translate="no">
          v3.4.8
        </div>
      </div>
    </div>
    <ul id="sidebar-listNav" class="sidebar-listNav" role="tablist">
      <li>
        <button id="extras-list-tab-button" role="tab" data-type="extras" aria-controls="extras-tab-panel" aria-selected="true" tabindex="0">
GUIDES
        </button>
      </li>

        <li>
          <button id="modules-list-tab-button" role="tab" data-type="modules" aria-controls="modules-tab-panel" aria-selected="false" tabindex="-1">
            Modules
          </button>
        </li>


        <li>
          <button id="tasks-list-tab-button" role="tab" data-type="tasks" aria-controls="tasks-tab-panel" aria-selected="false" tabindex="-1">
            <span translate="no">Mix</span> Tasks
          </button>
        </li>

    </ul>
  </div>

  <div id="extras-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="extras-list-tab-button">
    <ul id="extras-full-list" class="full-list"></ul>
  </div>

    <div id="modules-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="modules-list-tab-button" hidden>
      <ul id="modules-full-list" class="full-list"></ul>
    </div>


    <div id="tasks-tab-panel" class="sidebar-tabpanel" role="tabpanel" aria-labelledby="tasks-list-tab-button" hidden>
      <ul id="tasks-full-list" class="full-list"></ul>
    </div>

</nav>

<main class="content">
  <output role="status" id="toast"></output>

  <div id="content" class="content-inner">
    <div class="top-search">
      <div class="search-settings">
        <form class="search-bar" action="search.html">
          <label class="search-label">
            <span class="sr-only">Search documentation of ash</span>
            <input name="q" type="text" class="search-input" placeholder="Press / to search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
          </label>
          <button type="submit" class="search-button" aria-label="Submit Search">
            <i class="ri-search-2-line ri-lg" aria-hidden="true" title="Submit search"></i>
          </button>
          <button type="button" tabindex="-1" class="search-close-button" aria-hidden="true">
            <i class="ri-close-line ri-lg" title="Cancel search"></i>
          </button>
        </form>
        <div class="autocomplete">
        </div>
        <button class="icon-settings display-settings">
          <i class="ri-settings-3-line"></i>
          <span class="sr-only">Settings</span>
        </button>
      </div>
    </div>

<div id="top-content">
  <h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/resource/change/builtins.ex#L1" title="View Source" class="icon-action" rel="help">
        <i class="ri-code-s-slash-line" aria-hidden="true"></i>
        <span class="sr-only">View Source</span>
      </a>

    <span translate="no">Ash.Resource.Change.Builtins</span> 
    <small class="app-vsn" translate="no">(ash v3.4.8)</small>

  </h1>


    <section id="moduledoc">
<p>Built in changes that are available to all resources</p><p>The functions in this module are imported by default in the actions section.</p>
    </section>

</div>

  <section id="summary" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#summary">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Summary</span>
    </h1>
<div class="summary-functions summary">
  <h2>
    <a href="#functions">Functions</a>
  </h2>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#after_action/2" data-no-tooltip translate="no">after_action(callback, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Directly attach an <code class="inline">after_action</code> function to the current change.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#after_transaction/2" data-no-tooltip translate="no">after_transaction(callback, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Directly attach an <code class="inline">after_transaction</code> function to the current change.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#atomic_update/3" data-no-tooltip translate="no">atomic_update(attribute, expr, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Updates an attribute using an expression. See <a href="Ash.Changeset.html#atomic_update/3"><code class="inline">Ash.Changeset.atomic_update/3</code></a> for more.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#before_action/2" data-no-tooltip translate="no">before_action(callback, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Directly attach a <code class="inline">before_action</code> function to the current change.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#before_transaction/2" data-no-tooltip translate="no">before_transaction(callback, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Directly attach a <code class="inline">before_transaction</code> function to the current change.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#cascade_destroy/2" data-no-tooltip translate="no">cascade_destroy(relationship, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Cascade this resource's destroy action to a related resource's destroy action.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#cascade_update/2" data-no-tooltip translate="no">cascade_update(relationship, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>  Cascade a resource's update action to a related resource's update action.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#debug_log/1" data-no-tooltip translate="no">debug_log(label \\ nil)</a>

      </div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#ensure_selected/1" data-no-tooltip translate="no">ensure_selected(value)</a>

      </div>

        <div class="summary-synopsis"><p>Passes the provided value into <a href="Ash.Changeset.html#ensure_selected/2"><code class="inline">Ash.Changeset.ensure_selected/2</code></a></p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#filter/1" data-no-tooltip translate="no">filter(filter)</a>

      </div>

        <div class="summary-synopsis"><p>Applies a filter to the changeset. Has no effect for create actions.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_and_lock/1" data-no-tooltip translate="no">get_and_lock(lock)</a>

      </div>

        <div class="summary-synopsis"><p>Re-fetches the record being updated and locks it with the given type.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#get_and_lock_for_update/0" data-no-tooltip translate="no">get_and_lock_for_update()</a>

      </div>

        <div class="summary-synopsis"><p>Re-fetches the record being updated and locks it for update.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#increment/2" data-no-tooltip translate="no">increment(attribute, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Increments an attribute's value by the amount specified, which defaults to 1.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#load/1" data-no-tooltip translate="no">load(value)</a>

      </div>

        <div class="summary-synopsis"><p>Passes the provided value into <code class="inline">Ash.load</code> after the action has completed.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#manage_relationship/3" data-no-tooltip translate="no">manage_relationship(argument, relationship_name \\ nil, opts)</a>

      </div>

        <div class="summary-synopsis"><p>Calls <a href="Ash.Changeset.html#manage_relationship/4"><code class="inline">Ash.Changeset.manage_relationship/4</code></a> with the changeset and relationship provided, using the value provided for the named argument.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#optimistic_lock/1" data-no-tooltip translate="no">optimistic_lock(attribute)</a>

      </div>

        <div class="summary-synopsis"><p>Apply an &quot;optimistic lock&quot; on a record being updated or destroyed.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#prevent_change/1" data-no-tooltip translate="no">prevent_change(attribute)</a>

      </div>

        <div class="summary-synopsis"><p>Clears a change off of the changeset before the action runs.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#relate_actor/2" data-no-tooltip translate="no">relate_actor(relationship, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Relates the actor to the data being changed, as the provided relationship.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#select/1" data-no-tooltip translate="no">select(value)</a>

      </div>

        <div class="summary-synopsis"><p>Passes the provided value into <a href="Ash.Changeset.html#select/3"><code class="inline">Ash.Changeset.select/3</code></a></p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#set_attribute/3" data-no-tooltip translate="no">set_attribute(attribute, value, opts \\ [])</a>

      </div>

        <div class="summary-synopsis"><p>Sets the attribute to the value provided.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#set_context/1" data-no-tooltip translate="no">set_context(context)</a>

      </div>

        <div class="summary-synopsis"><p>Merges the given query context.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#set_new_attribute/2" data-no-tooltip translate="no">set_new_attribute(attribute, value)</a>

      </div>

        <div class="summary-synopsis"><p>Sets the attribute to the value provided if the attribute is not already being changed.</p></div>

    </div>

    <div class="summary-row">
      <div class="summary-signature">
        <a href="#update_change/2" data-no-tooltip translate="no">update_change(attribute, function)</a>

      </div>

        <div class="summary-synopsis"><p>Updates an existing attribute change by applying a function to it.</p></div>

    </div>

</div>

  </section>


  <section id="functions" class="details-list">
    <h1 class="section-heading">
      <a class="hover-link" href="#functions">
        <i class="ri-link-m" aria-hidden="true"></i>
      </a>
      <span class="text">Functions</span>
    </h1>
    <div class="functions-list">
<section class="detail" id="after_action/2">

    <span id="after_action/1"></span>

  <div class="detail-header">
    <a href="#after_action/2" class="detail-link" data-no-tooltip title="Link to this macro">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this macro</span>
    </a>
    <h1 class="signature" translate="no">after_action(callback, opts \\ [])</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/resource/change/builtins.ex#L380" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(macro)</span>

  </div>

  <section class="docstring">

<p>Directly attach an <code class="inline">after_action</code> function to the current change.</p><p>See <a href="Ash.Changeset.html#after_action/3"><code class="inline">Ash.Changeset.after_action/3</code></a> for more information.</p><p>Provide the option <code class="inline">prepend?: true</code> to place the hook before all other hooks instead of after.</p><h2 id="after_action/2-example" class="section-heading">
  <a href="#after_action/2-example" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Example</span>
</h2>
<pre><code class="makeup elixir" translate="no"><span class="n">change</span><span class="w"> </span><span class="n">after_action</span><span class="p" data-group-id="2959411381-1">(</span><span class="k" data-group-id="2959411381-2">fn</span><span class="w"> </span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="n">record</span><span class="p">,</span><span class="w"> </span><span class="c">_context</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="nc">Logger</span><span class="o">.</span><span class="n">debug</span><span class="p" data-group-id="2959411381-3">(</span><span class="s">&quot;Successfully executed action </span><span class="si" data-group-id="2959411381-4">#{</span><span class="n">changeset</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="si" data-group-id="2959411381-4">}</span><span class="s"> on </span><span class="si" data-group-id="2959411381-5">#{</span><span class="n">inspect</span><span class="p" data-group-id="2959411381-6">(</span><span class="n">changeset</span><span class="o">.</span><span class="n">resource</span><span class="p" data-group-id="2959411381-6">)</span><span class="si" data-group-id="2959411381-5">}</span><span class="s">&quot;</span><span class="p" data-group-id="2959411381-3">)</span><span class="w">
  </span><span class="p" data-group-id="2959411381-7">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">record</span><span class="p" data-group-id="2959411381-7">}</span><span class="w">
</span><span class="k" data-group-id="2959411381-2">end</span><span class="p" data-group-id="2959411381-1">)</span></code></pre>
  </section>
</section>
<section class="detail" id="after_transaction/2">

    <span id="after_transaction/1"></span>

  <div class="detail-header">
    <a href="#after_transaction/2" class="detail-link" data-no-tooltip title="Link to this macro">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this macro</span>
    </a>
    <h1 class="signature" translate="no">after_transaction(callback, opts \\ [])</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/resource/change/builtins.ex#L410" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(macro)</span>

  </div>

  <section class="docstring">

<p>Directly attach an <code class="inline">after_transaction</code> function to the current change.</p><p>See <a href="Ash.Changeset.html#after_transaction/3"><code class="inline">Ash.Changeset.after_transaction/3</code></a> for more information.</p><p>Provide the option <code class="inline">prepend?: true</code> to place the hook before all other hooks instead of after.</p><h2 id="after_transaction/2-example" class="section-heading">
  <a href="#after_transaction/2-example" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Example</span>
</h2>
<pre><code class="makeup elixir" translate="no"><span class="n">change</span><span class="w"> </span><span class="n">after_transaction</span><span class="p" data-group-id="0346635609-1">(</span><span class="k" data-group-id="0346635609-2">fn</span><span class="w">
  </span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0346635609-3">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">record</span><span class="p" data-group-id="0346635609-3">}</span><span class="p">,</span><span class="w"> </span><span class="c">_context</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
    </span><span class="nc">Logger</span><span class="o">.</span><span class="n">debug</span><span class="p" data-group-id="0346635609-4">(</span><span class="s">&quot;Successfully executed transaction for action </span><span class="si" data-group-id="0346635609-5">#{</span><span class="n">changeset</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="si" data-group-id="0346635609-5">}</span><span class="s"> on </span><span class="si" data-group-id="0346635609-6">#{</span><span class="n">inspect</span><span class="p" data-group-id="0346635609-7">(</span><span class="n">changeset</span><span class="o">.</span><span class="n">resource</span><span class="p" data-group-id="0346635609-7">)</span><span class="si" data-group-id="0346635609-6">}</span><span class="s">&quot;</span><span class="p" data-group-id="0346635609-4">)</span><span class="w">
    </span><span class="p" data-group-id="0346635609-8">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">record</span><span class="p" data-group-id="0346635609-8">}</span><span class="w">
  </span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="0346635609-9">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="n">reason</span><span class="p" data-group-id="0346635609-9">}</span><span class="p">,</span><span class="w"> </span><span class="c">_context</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
    </span><span class="nc">Logger</span><span class="o">.</span><span class="n">debug</span><span class="p" data-group-id="0346635609-10">(</span><span class="s">&quot;Failed to execute transaction for action </span><span class="si" data-group-id="0346635609-11">#{</span><span class="n">changeset</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="si" data-group-id="0346635609-11">}</span><span class="s"> on </span><span class="si" data-group-id="0346635609-12">#{</span><span class="n">inspect</span><span class="p" data-group-id="0346635609-13">(</span><span class="n">changeset</span><span class="o">.</span><span class="n">resource</span><span class="p" data-group-id="0346635609-13">)</span><span class="si" data-group-id="0346635609-12">}</span><span class="s">, reason: </span><span class="si" data-group-id="0346635609-14">#{</span><span class="n">inspect</span><span class="p" data-group-id="0346635609-15">(</span><span class="n">reason</span><span class="p" data-group-id="0346635609-15">)</span><span class="si" data-group-id="0346635609-14">}</span><span class="s">&quot;</span><span class="p" data-group-id="0346635609-10">)</span><span class="w">
    </span><span class="p" data-group-id="0346635609-16">{</span><span class="ss">:error</span><span class="p">,</span><span class="w"> </span><span class="n">reason</span><span class="p" data-group-id="0346635609-16">}</span><span class="w">
</span><span class="k" data-group-id="0346635609-2">end</span><span class="p" data-group-id="0346635609-1">)</span></code></pre>
  </section>
</section>
<section class="detail" id="atomic_update/3">

    <span id="atomic_update/2"></span>

  <div class="detail-header">
    <a href="#atomic_update/3" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">atomic_update(attribute, expr, opts \\ [])</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/resource/change/builtins.ex#L161" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> atomic_update(attribute :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>(), expr :: <a href="Ash.Expr.html#t:t/0">Ash.Expr.t</a>(), opts :: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()) ::
  <a href="Ash.Resource.Change.html#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>

<p>Updates an attribute using an expression. See <a href="Ash.Changeset.html#atomic_update/3"><code class="inline">Ash.Changeset.atomic_update/3</code></a> for more.</p><p>Options:</p><ul><li><code class="inline">:cast_atomic?</code> - set to <code class="inline">false</code> to ignore atomic type casting logic. Defaults to <code class="inline">true</code>.</li></ul>
  </section>
</section>
<section class="detail" id="before_action/2">

    <span id="before_action/1"></span>

  <div class="detail-header">
    <a href="#before_action/2" class="detail-link" data-no-tooltip title="Link to this macro">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this macro</span>
    </a>
    <h1 class="signature" translate="no">before_action(callback, opts \\ [])</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/resource/change/builtins.ex#L437" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(macro)</span>

  </div>

  <section class="docstring">

<p>Directly attach a <code class="inline">before_action</code> function to the current change.</p><p>See <a href="Ash.Changeset.html#before_action/3"><code class="inline">Ash.Changeset.before_action/3</code></a> for more information.</p><p>Provide the option <code class="inline">append?: true</code> to place the hook after all other hooks instead of before.</p><h2 id="before_action/2-example" class="section-heading">
  <a href="#before_action/2-example" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Example</span>
</h2>
<pre><code class="makeup elixir" translate="no"><span class="n">change</span><span class="w"> </span><span class="n">before_action</span><span class="p" data-group-id="9510032037-1">(</span><span class="k" data-group-id="9510032037-2">fn</span><span class="w"> </span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="c">_context</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="nc">Logger</span><span class="o">.</span><span class="n">debug</span><span class="p" data-group-id="9510032037-3">(</span><span class="s">&quot;About to execute </span><span class="si" data-group-id="9510032037-4">#{</span><span class="n">changeset</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="si" data-group-id="9510032037-4">}</span><span class="s"> on </span><span class="si" data-group-id="9510032037-5">#{</span><span class="n">inspect</span><span class="p" data-group-id="9510032037-6">(</span><span class="n">changeset</span><span class="o">.</span><span class="n">resource</span><span class="p" data-group-id="9510032037-6">)</span><span class="si" data-group-id="9510032037-5">}</span><span class="s">&quot;</span><span class="p" data-group-id="9510032037-3">)</span><span class="w">

  </span><span class="n">changeset</span><span class="w">
</span><span class="k" data-group-id="9510032037-2">end</span><span class="p" data-group-id="9510032037-1">)</span></code></pre>
  </section>
</section>
<section class="detail" id="before_transaction/2">

    <span id="before_transaction/1"></span>

  <div class="detail-header">
    <a href="#before_transaction/2" class="detail-link" data-no-tooltip title="Link to this macro">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this macro</span>
    </a>
    <h1 class="signature" translate="no">before_transaction(callback, opts \\ [])</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/resource/change/builtins.ex#L464" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(macro)</span>

  </div>

  <section class="docstring">

<p>Directly attach a <code class="inline">before_transaction</code> function to the current change.</p><p>See <a href="Ash.Changeset.html#before_transaction/3"><code class="inline">Ash.Changeset.before_transaction/3</code></a> for more information.</p><p>Provide the option <code class="inline">append?: true</code> to place the hook after all other hooks instead of before.</p><h2 id="before_transaction/2-example" class="section-heading">
  <a href="#before_transaction/2-example" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Example</span>
</h2>
<pre><code class="makeup elixir" translate="no"><span class="n">change</span><span class="w"> </span><span class="n">before_transaction</span><span class="p" data-group-id="2310922147-1">(</span><span class="k" data-group-id="2310922147-2">fn</span><span class="w"> </span><span class="n">changeset</span><span class="p">,</span><span class="w"> </span><span class="c">_context</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
  </span><span class="nc">Logger</span><span class="o">.</span><span class="n">debug</span><span class="p" data-group-id="2310922147-3">(</span><span class="s">&quot;About to execute transaction for </span><span class="si" data-group-id="2310922147-4">#{</span><span class="n">changeset</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">name</span><span class="si" data-group-id="2310922147-4">}</span><span class="s"> on </span><span class="si" data-group-id="2310922147-5">#{</span><span class="n">inspect</span><span class="p" data-group-id="2310922147-6">(</span><span class="n">changeset</span><span class="o">.</span><span class="n">resource</span><span class="p" data-group-id="2310922147-6">)</span><span class="si" data-group-id="2310922147-5">}</span><span class="s">&quot;</span><span class="p" data-group-id="2310922147-3">)</span><span class="w">

  </span><span class="n">changeset</span><span class="w">
</span><span class="k" data-group-id="2310922147-2">end</span><span class="p" data-group-id="2310922147-1">)</span></code></pre>
  </section>
</section>
<section class="detail" id="cascade_destroy/2">

    <span id="cascade_destroy/1"></span>

  <div class="detail-header">
    <a href="#cascade_destroy/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">cascade_destroy(relationship, opts \\ [])</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/resource/change/builtins.ex#L321" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Cascade this resource's destroy action to a related resource's destroy action.</p><p>Adds an after-action hook that explicitly calls destroy on any records related
via the named relationship.  It will optimise for bulk destroys where
possible.</p><blockquote><h4 class="warning">Beware database constraints</h4><p>Think carefully before using this change with data layers which enforce
referential integrity (ie PostgreSQL and SQLite) and you may need to defer
constraints for the relationship in question.</p><p>See also:</p><ol><li><a href="https://hexdocs.pm/ash_postgres/dsl-ashpostgres-datalayer.html#postgres-references-reference-deferrable"><code class="inline">postgres.references.reference.deferrable</code> DSL</a></li><li><a href="https://hexdocs.pm/ash_sqlite/dsl-ashsqlite-datalayer.html#sqlite-references-reference-deferrable"><code class="inline">sqlite.references.reference.deferrable</code> DSL</a></li><li><a href="https://www.postgresql.org/docs/current/sql-set-constraints.html">PostgreSQL's <code class="inline">SET CONSTRAINTS</code> documentation</a></li><li><a href="https://www.sqlite.org/pragma.html#pragma_defer_foreign_keys">SQLite's <code class="inline">PRAGMA defer_foreign_keys</code> documentation</a></li></ol></blockquote><blockquote><h4 class="tip">Cascading notifications</h4><p>By default notifications are disabled for the related destroy. This is to avoid potentially sending a <strong>lot</strong> of notifications for high-cardinality relationships.</p></blockquote><h2 id="cascade_destroy/2-options" class="section-heading">
  <a href="#cascade_destroy/2-options" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Options</span>
</h2>
<ul><li><p><code class="inline">:relationship</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types"><code class="inline">atom/0</code></a>) - Required. The name of the relationship to work on</p></li><li><p><code class="inline">:action</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types"><code class="inline">atom/0</code></a>) - The name of the destroy action to call on the related resource. Uses the primary destroy by default.</p></li><li><p><code class="inline">:read_action</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types"><code class="inline">atom/0</code></a>) - The name of the read action to call on the related resource to find results to be destroyed</p></li><li><p><code class="inline">:return_notifications?</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types"><code class="inline">boolean/0</code></a>) - Return notifications for all destroyed records? The default value is <code class="inline">false</code>.</p></li><li><p><code class="inline">:domain</code> (<a href="Ash.Domain.html"><code class="inline">Ash.Domain</code></a>) - </p></li></ul><h2 id="cascade_destroy/2-example" class="section-heading">
  <a href="#cascade_destroy/2-example" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Example</span>
</h2>
<pre><code class="makeup elixir" translate="no"><span class="n">change</span><span class="w"> </span><span class="n">cascade_destroy</span><span class="p" data-group-id="2042399253-1">(</span><span class="ss">:relationship</span><span class="p" data-group-id="2042399253-1">)</span></code></pre>
  </section>
</section>
<section class="detail" id="cascade_update/2">

    <span id="cascade_update/1"></span>

  <div class="detail-header">
    <a href="#cascade_update/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">cascade_update(relationship, opts \\ [])</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/resource/change/builtins.ex#L361" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>  Cascade a resource's update action to a related resource's update action.</p><p>  Adds an after-action hook that explicitly calls update on any records related
  via the named relationship.  It will optimise for bulk updates where
  possible.</p><p>  Allows you to copy fields from the arguments or changes to the destination,
  this way you can cascade a bunch of changes downstream.</p><blockquote><h4 class="warning">Beware database constraints</h4><p>Think carefully before using this change with data layers which enforce
referential integrity (ie PostgreSQL and SQLite) and you may need to defer
constraints for the relationship in question.</p><p>See also:</p><ol><li><a href="https://hexdocs.pm/ash_postgres/dsl-ashpostgres-datalayer.html#postgres-references-reference-deferrable"><code class="inline">postgres.references.reference.deferrable</code> DSL</a></li><li><a href="https://hexdocs.pm/ash_sqlite/dsl-ashsqlite-datalayer.html#sqlite-references-reference-deferrable"><code class="inline">sqlite.references.reference.deferrable</code> DSL</a></li><li><a href="https://www.postgresql.org/docs/current/sql-set-constraints.html">PostgreSQL's <code class="inline">SET CONSTRAINTS</code> documentation</a></li><li><a href="https://www.sqlite.org/pragma.html#pragma_defer_foreign_keys">SQLite's <code class="inline">PRAGMA defer_foreign_keys</code> documentation</a></li></ol></blockquote><blockquote><h4 class="tip">Cascading notifications</h4><p>By default notifications are disabled for the related updates. This is to avoid potentially sending a <strong>lot</strong> of notifications for high-cardinality relationships.</p></blockquote><h2 id="cascade_update/2-options" class="section-heading">
  <a href="#cascade_update/2-options" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Options</span>
</h2>
<ul><li><p><code class="inline">:relationship</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types"><code class="inline">atom/0</code></a>) - Required. The name of the relationship to work on</p></li><li><p><code class="inline">:action</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types"><code class="inline">atom/0</code></a>) - The name of the update action to call on the related resource. Uses the primary update by default.</p></li><li><p><code class="inline">:copy_inputs</code> (list of <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types"><code class="inline">atom/0</code></a>) - A list of fields to copy &amp; pass on to the downstream update. The source action cannot be atomic. The default value is <code class="inline">[]</code>.</p></li><li><p><code class="inline">:read_action</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types"><code class="inline">atom/0</code></a>) - The name of the read action to call on the related resource to find results to be updated</p></li><li><p><code class="inline">:return_notifications?</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types"><code class="inline">boolean/0</code></a>) - Return notifications for all updated records? The default value is <code class="inline">false</code>.</p></li><li><p><code class="inline">:domain</code> (<a href="Ash.Domain.html"><code class="inline">Ash.Domain</code></a>) - </p></li></ul><h2 id="cascade_update/2-example" class="section-heading">
  <a href="#cascade_update/2-example" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Example</span>
</h2>
<pre><code class="makeup elixir" translate="no"><span class="n">change</span><span class="w"> </span><span class="n">cascade_update</span><span class="p" data-group-id="6079430534-1">(</span><span class="ss">:relationship1</span><span class="p" data-group-id="6079430534-1">)</span><span class="w">
</span><span class="n">change</span><span class="w"> </span><span class="n">cascade_update</span><span class="p" data-group-id="6079430534-2">(</span><span class="ss">:relationship2</span><span class="p">,</span><span class="w"> </span><span class="ss">copy_inputs</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="6079430534-3">[</span><span class="ss">:field1</span><span class="p">,</span><span class="w"> </span><span class="ss">:field2</span><span class="p" data-group-id="6079430534-3">]</span><span class="p" data-group-id="6079430534-2">)</span></code></pre>
  </section>
</section>
<section class="detail" id="debug_log/1">

    <span id="debug_log/0"></span>

  <div class="detail-header">
    <a href="#debug_log/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">debug_log(label \\ nil)</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/resource/change/builtins.ex#L40" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> debug_log(label :: <a href="https://hexdocs.pm/elixir/String.html#t:t/0">String.t</a>() | nil) :: <a href="Ash.Resource.Change.html#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>


  </section>
</section>
<section class="detail" id="ensure_selected/1">

  <div class="detail-header">
    <a href="#ensure_selected/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">ensure_selected(value)</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/resource/change/builtins.ex#L285" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> ensure_selected(select :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>() | [<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()]) :: <a href="Ash.Resource.Change.html#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>

<p>Passes the provided value into <a href="Ash.Changeset.html#ensure_selected/2"><code class="inline">Ash.Changeset.ensure_selected/2</code></a></p><p>If the value is not already selected, this makes sure it is. Does not deselect anything else.</p><h2 id="ensure_selected/1-example" class="section-heading">
  <a href="#ensure_selected/1-example" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Example</span>
</h2>
<pre><code class="makeup elixir" translate="no"><span class="n">change</span><span class="w"> </span><span class="n">ensure_selected</span><span class="p" data-group-id="5397136653-1">(</span><span class="p" data-group-id="5397136653-2">[</span><span class="ss">:necessary_field</span><span class="p" data-group-id="5397136653-2">]</span><span class="p" data-group-id="5397136653-1">)</span></code></pre>
  </section>
</section>
<section class="detail" id="filter/1">

  <div class="detail-header">
    <a href="#filter/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">filter(filter)</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/resource/change/builtins.ex#L14" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> filter(expr :: <a href="Ash.Expr.html#t:t/0">Ash.Expr.t</a>()) :: <a href="Ash.Resource.Change.html#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>

<p>Applies a filter to the changeset. Has no effect for create actions.</p><p>This ensures that only things matching the provided filter are updated or destroyed.</p>
  </section>
</section>
<section class="detail" id="get_and_lock/1">

  <div class="detail-header">
    <a href="#get_and_lock/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_and_lock(lock)</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/resource/change/builtins.ex#L79" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> get_and_lock(lock :: <a href="Ash.DataLayer.html#t:lock_type/0">Ash.DataLayer.lock_type</a>()) :: <a href="Ash.Resource.Change.html#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>

<p>Re-fetches the record being updated and locks it with the given type.</p><p>This happens in a <code class="inline">before_action</code> hook (so that it is done as part of the transaction).</p><p>If your resource has global validations (in the top level <code class="inline">validations</code> block), you may
want to add <code class="inline">delay_global_validations? true</code> to your action to ensure they happen on the
locked record.</p>
  </section>
</section>
<section class="detail" id="get_and_lock_for_update/0">

  <div class="detail-header">
    <a href="#get_and_lock_for_update/0" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">get_and_lock_for_update()</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/resource/change/builtins.ex#L65" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> get_and_lock_for_update() :: <a href="Ash.Resource.Change.html#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>

<p>Re-fetches the record being updated and locks it for update.</p><p>Only usable with data layers that support locking <code class="inline">:for_update</code>.</p><p>This happens in a <code class="inline">before_action</code> hook (so that it is done as part of the transaction).</p><p>If your resource has global validations (in the top level <code class="inline">validations</code> block), you may
want to add <code class="inline">delay_global_validations? true</code> to your action to ensure they happen on the
locked record.</p>
  </section>
</section>
<section class="detail" id="increment/2">

    <span id="increment/1"></span>

  <div class="detail-header">
    <a href="#increment/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">increment(attribute, opts \\ [])</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/resource/change/builtins.ex#L109" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> increment(attribute :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>(), opts :: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()) :: <a href="Ash.Resource.Change.html#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>

<p>Increments an attribute's value by the amount specified, which defaults to 1.</p><p>Options:</p><ul><li><code class="inline">:amount</code> - Defaults to 1</li><li><code class="inline">:overflow_limit</code> - Defaults to <code class="inline">nil</code>. If the value is over the overflow limit it will roll-over to the amount being incremented by (for common database limit support)</li></ul>
  </section>
</section>
<section class="detail" id="load/1">

  <div class="detail-header">
    <a href="#load/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">load(value)</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/resource/change/builtins.ex#L252" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> load(load :: <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()) :: <a href="Ash.Resource.Change.html#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>

<p>Passes the provided value into <code class="inline">Ash.load</code> after the action has completed.</p><h2 id="load/1-example" class="section-heading">
  <a href="#load/1-example" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Example</span>
</h2>
<pre><code class="makeup elixir" translate="no"><span class="n">change</span><span class="w"> </span><span class="n">load</span><span class="p" data-group-id="4238135304-1">(</span><span class="ss">:comments</span><span class="p" data-group-id="4238135304-1">)</span><span class="w">
</span><span class="n">change</span><span class="w"> </span><span class="n">load</span><span class="p" data-group-id="4238135304-2">(</span><span class="p" data-group-id="4238135304-3">[</span><span class="ss">:friend_count</span><span class="p">,</span><span class="w"> </span><span class="ss">:friends</span><span class="p" data-group-id="4238135304-3">]</span><span class="p" data-group-id="4238135304-2">)</span></code></pre>
  </section>
</section>
<section class="detail" id="manage_relationship/3">

    <span id="manage_relationship/2"></span>

  <div class="detail-header">
    <a href="#manage_relationship/3" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">manage_relationship(argument, relationship_name \\ nil, opts)</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/resource/change/builtins.ex#L219" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> manage_relationship(
  argument :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>(),
  relationship_name :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>() | nil,
  opts :: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()
) :: <a href="Ash.Resource.Change.html#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>

<p>Calls <a href="Ash.Changeset.html#manage_relationship/4"><code class="inline">Ash.Changeset.manage_relationship/4</code></a> with the changeset and relationship provided, using the value provided for the named argument.</p><p>If relationship_name is not specified, it is assumed to be the same as the argument.</p><p>For information on the available options, see <a href="Ash.Changeset.html#manage_relationship/4"><code class="inline">Ash.Changeset.manage_relationship/4</code></a>.</p><h2 id="manage_relationship/3-examples" class="section-heading">
  <a href="#manage_relationship/3-examples" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Examples</span>
</h2>
<pre><code class="makeup elixir" translate="no"><span class="n">change</span><span class="w"> </span><span class="n">manage_relationship</span><span class="p" data-group-id="6857211445-1">(</span><span class="ss">:comments</span><span class="p">,</span><span class="w"> </span><span class="ss">type</span><span class="p">:</span><span class="w"> </span><span class="ss">:append</span><span class="p" data-group-id="6857211445-1">)</span><span class="w">
</span><span class="n">change</span><span class="w"> </span><span class="n">manage_relationship</span><span class="p" data-group-id="6857211445-2">(</span><span class="ss">:remove_comments</span><span class="p">,</span><span class="w"> </span><span class="ss">:comments</span><span class="p">,</span><span class="w"> </span><span class="ss">type</span><span class="p">:</span><span class="w"> </span><span class="ss">:remove</span><span class="p" data-group-id="6857211445-2">)</span></code></pre>
  </section>
</section>
<section class="detail" id="optimistic_lock/1">

  <div class="detail-header">
    <a href="#optimistic_lock/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">optimistic_lock(attribute)</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/resource/change/builtins.ex#L49" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

<p>Apply an &quot;optimistic lock&quot; on a record being updated or destroyed.</p><p>See <a href="Ash.Resource.Change.OptimisticLock.html"><code class="inline">Ash.Resource.Change.OptimisticLock</code></a> for more.</p>
  </section>
</section>
<section class="detail" id="prevent_change/1">

  <div class="detail-header">
    <a href="#prevent_change/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">prevent_change(attribute)</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/resource/change/builtins.ex#L197" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> prevent_change(attribute :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()) :: <a href="Ash.Resource.Change.html#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>

<p>Clears a change off of the changeset before the action runs.</p><p>Does not fail if it is being changed, but ensures it is cleared just before the action.</p><p>Can be useful if a change is only used in validations but shouldn't ultimately be written to the data layer.</p><h2 id="prevent_change/1-examples" class="section-heading">
  <a href="#prevent_change/1-examples" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Examples</span>
</h2>
<pre><code class="makeup elixir" translate="no"><span class="n">change</span><span class="w"> </span><span class="n">prevent_change</span><span class="p" data-group-id="7456993811-1">(</span><span class="ss">:email</span><span class="p" data-group-id="7456993811-1">)</span></code></pre>
  </section>
</section>
<section class="detail" id="relate_actor/2">

    <span id="relate_actor/1"></span>

  <div class="detail-header">
    <a href="#relate_actor/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">relate_actor(relationship, opts \\ [])</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/resource/change/builtins.ex#L30" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> relate_actor(relationship :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>(), opts :: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()) ::
  <a href="Ash.Resource.Change.html#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>

<p>Relates the actor to the data being changed, as the provided relationship.</p><h2 id="relate_actor/2-options" class="section-heading">
  <a href="#relate_actor/2-options" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Options</span>
</h2>
<ul><li><p><code class="inline">:allow_nil?</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types"><code class="inline">boolean/0</code></a>) - Whether or not to allow the actor to be nil, in which case nothing will happen. The default value is <code class="inline">false</code>.</p></li><li><p><code class="inline">:field</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types"><code class="inline">atom/0</code></a>) - The field of the actor to set the relationship to</p></li></ul><h2 id="relate_actor/2-examples" class="section-heading">
  <a href="#relate_actor/2-examples" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Examples</span>
</h2>
<pre><code class="makeup elixir" translate="no"><span class="n">change</span><span class="w"> </span><span class="n">relate_actor</span><span class="p" data-group-id="5780686358-1">(</span><span class="ss">:owner</span><span class="p">,</span><span class="w"> </span><span class="ss">allow_nil?</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="5780686358-1">)</span></code></pre>
  </section>
</section>
<section class="detail" id="select/1">

  <div class="detail-header">
    <a href="#select/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">select(value)</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/resource/change/builtins.ex#L271" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> select(select :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>() | [<a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>()]) :: <a href="Ash.Resource.Change.html#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>

<p>Passes the provided value into <a href="Ash.Changeset.html#select/3"><code class="inline">Ash.Changeset.select/3</code></a></p><p>Keep in mind, this will <em>limit</em> the fields that are selected. You may want <a href="#ensure_selected/1"><code class="inline">ensure_selected/1</code></a> if you
want to make sure that something is selected, without deselecting anything else.</p><p>Selecting in changesets does not actually do a select in the data layer. It nils out any
fields that were not selected after completing the action. This can be useful if you are writing
policies that have to do with specific fields being selected.</p><h2 id="select/1-example" class="section-heading">
  <a href="#select/1-example" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Example</span>
</h2>
<pre><code class="makeup elixir" translate="no"><span class="n">change</span><span class="w"> </span><span class="n">select</span><span class="p" data-group-id="4147895865-1">(</span><span class="p" data-group-id="4147895865-2">[</span><span class="ss">:name</span><span class="p" data-group-id="4147895865-2">]</span><span class="p" data-group-id="4147895865-1">)</span></code></pre>
  </section>
</section>
<section class="detail" id="set_attribute/3">

    <span id="set_attribute/2"></span>

  <div class="detail-header">
    <a href="#set_attribute/3" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">set_attribute(attribute, value, opts \\ [])</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/resource/change/builtins.ex#L143" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> set_attribute(
  attribute :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>(),
  (-&gt; <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()) | {:_arg, :status} | <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>(),
  opts :: <a href="https://hexdocs.pm/elixir/Keyword.html#t:t/0">Keyword.t</a>()
) :: <a href="Ash.Resource.Change.html#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>

<p>Sets the attribute to the value provided.</p><p>If a zero argument function is provided, it is called to determine the value.</p><p>Use <code class="inline">arg(:argument_name)</code> to use the value of the given argument. If the argument is not supplied then nothing happens.</p><h2 id="set_attribute/3-options" class="section-heading">
  <a href="#set_attribute/3-options" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Options</span>
</h2>
<ul><li><p><code class="inline">:set_when_nil?</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types"><code class="inline">boolean/0</code></a>) - When false, decline setting the attribute if it is nil. The default value is <code class="inline">true</code>.</p></li><li><p><code class="inline">:new?</code> (<a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types"><code class="inline">boolean/0</code></a>) - When true, sets the attribute to the value provided if the attribute is not already being changed. The default value is <code class="inline">false</code>.</p></li></ul><h2 id="set_attribute/3-examples" class="section-heading">
  <a href="#set_attribute/3-examples" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Examples</span>
</h2>
<pre><code class="makeup elixir" translate="no"><span class="n">change</span><span class="w"> </span><span class="n">set_attribute</span><span class="p" data-group-id="3103405348-1">(</span><span class="ss">:active</span><span class="p">,</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="3103405348-1">)</span><span class="w">
</span><span class="n">change</span><span class="w"> </span><span class="n">set_attribute</span><span class="p" data-group-id="3103405348-2">(</span><span class="ss">:opened_at</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nc">DateTime</span><span class="o">.</span><span class="n">utc_now</span><span class="o">/</span><span class="mi">0</span><span class="p" data-group-id="3103405348-2">)</span><span class="w">
</span><span class="n">change</span><span class="w"> </span><span class="n">set_attribute</span><span class="p" data-group-id="3103405348-3">(</span><span class="ss">:status</span><span class="p">,</span><span class="w"> </span><span class="n">arg</span><span class="p" data-group-id="3103405348-4">(</span><span class="ss">:status</span><span class="p" data-group-id="3103405348-4">)</span><span class="p" data-group-id="3103405348-3">)</span><span class="w">
</span><span class="n">change</span><span class="w"> </span><span class="n">set_attribute</span><span class="p" data-group-id="3103405348-5">(</span><span class="ss">:encrypted_data</span><span class="p">,</span><span class="w"> </span><span class="n">arg</span><span class="p" data-group-id="3103405348-6">(</span><span class="ss">:data</span><span class="p" data-group-id="3103405348-6">)</span><span class="p">,</span><span class="w"> </span><span class="ss">set_when_nil?</span><span class="p">:</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="3103405348-5">)</span></code></pre>
  </section>
</section>
<section class="detail" id="set_context/1">

  <div class="detail-header">
    <a href="#set_context/1" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">set_context(context)</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/resource/change/builtins.ex#L239" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> set_context(context :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">map</a>() | <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">mfa</a>()) :: <a href="Ash.Resource.Change.html#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>

<p>Merges the given query context.</p><p>If an MFA is provided, it will be called with the changeset.
The MFA should return <code class="inline">{:ok, context_to_be_merged}</code> or <code class="inline">{:error, term}</code></p><h2 id="set_context/1-examples" class="section-heading">
  <a href="#set_context/1-examples" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Examples</span>
</h2>
<pre><code class="makeup elixir" translate="no"><span class="n">change</span><span class="w"> </span><span class="n">set_context</span><span class="p" data-group-id="8848887561-1">(</span><span class="p" data-group-id="8848887561-2">%{</span><span class="ss">something_used_internally</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="8848887561-2">}</span><span class="p" data-group-id="8848887561-1">)</span><span class="w">
</span><span class="n">change</span><span class="w"> </span><span class="n">set_context</span><span class="p" data-group-id="8848887561-3">(</span><span class="p" data-group-id="8848887561-4">{</span><span class="nc">MyApp.Context</span><span class="p">,</span><span class="w"> </span><span class="ss">:set_context</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="8848887561-5">[</span><span class="p" data-group-id="8848887561-5">]</span><span class="p" data-group-id="8848887561-4">}</span><span class="p" data-group-id="8848887561-3">)</span></code></pre>
  </section>
</section>
<section class="detail" id="set_new_attribute/2">

  <div class="detail-header">
    <a href="#set_new_attribute/2" class="detail-link" data-no-tooltip title="Link to this function">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this function</span>
    </a>
    <h1 class="signature" translate="no">set_new_attribute(attribute, value)</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/resource/change/builtins.ex#L181" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


  </div>

  <section class="docstring">

      <div class="specs">

          <pre translate="no"><span class="attribute">@spec</span> set_new_attribute(
  relationship :: <a href="https://hexdocs.pm/elixir/typespecs.html#basic-types">atom</a>(),
  (-&gt; <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()) | {:_arg, :status} | <a href="https://hexdocs.pm/elixir/typespecs.html#built-in-types">term</a>()
) ::
  <a href="Ash.Resource.Change.html#t:ref/0">Ash.Resource.Change.ref</a>()</pre>

      </div>

<p>Sets the attribute to the value provided if the attribute is not already being changed.</p><p>If a zero argument function is provided, it is called to determine the value.</p><p>Use <code class="inline">arg(:argument_name)</code> to use the value of the given argument. If the argument is not supplied then nothing happens.</p><h2 id="set_new_attribute/2-examples" class="section-heading">
  <a href="#set_new_attribute/2-examples" class="hover-link">
    <i class="ri-link-m" aria-hidden="true"></i>
  </a>
  <span class="text">Examples</span>
</h2>
<pre><code class="makeup elixir" translate="no"><span class="n">change</span><span class="w"> </span><span class="n">set_new_attribute</span><span class="p" data-group-id="8690165006-1">(</span><span class="ss">:active</span><span class="p">,</span><span class="w"> </span><span class="no">false</span><span class="p" data-group-id="8690165006-1">)</span><span class="w">
</span><span class="n">change</span><span class="w"> </span><span class="n">set_new_attribute</span><span class="p" data-group-id="8690165006-2">(</span><span class="ss">:opened_at</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nc">DateTime</span><span class="o">.</span><span class="n">utc_now</span><span class="o">/</span><span class="mi">0</span><span class="p" data-group-id="8690165006-2">)</span><span class="w">
</span><span class="n">change</span><span class="w"> </span><span class="n">set_new_attribute</span><span class="p" data-group-id="8690165006-3">(</span><span class="ss">:status</span><span class="p">,</span><span class="w"> </span><span class="n">arg</span><span class="p" data-group-id="8690165006-4">(</span><span class="ss">:status</span><span class="p" data-group-id="8690165006-4">)</span><span class="p" data-group-id="8690165006-3">)</span></code></pre>
  </section>
</section>
<section class="detail" id="update_change/2">

  <div class="detail-header">
    <a href="#update_change/2" class="detail-link" data-no-tooltip title="Link to this macro">
      <i class="ri-link-m" aria-hidden="true"></i>
      <span class="sr-only">Link to this macro</span>
    </a>
    <h1 class="signature" translate="no">update_change(attribute, function)</h1>

      <a href="https://github.com/ash-project/ash/blob/v3.4.8/lib/ash/resource/change/builtins.ex#L89" class="icon-action" rel="help" title="View Source">
       <i class="ri-code-s-slash-line" aria-hidden="true"></i>
       <span class="sr-only">View Source</span>
     </a>


      <span class="note">(macro)</span>

  </div>

  <section class="docstring">

<p>Updates an existing attribute change by applying a function to it.</p><p>The update function gets called with the value already cast to the correct type, and only gets called
on valid changesets, so the value is guaranteed to have passed validations and constraints.</p>
  </section>
</section>

    </div>
  </section>

    <footer class="footer">
      <p>

          <span class="line">
            <a href="https://hex.pm/packages/ash/3.4.8" class="footer-hex-package">Hex Package</a>

            <a href="https://preview.hex.pm/preview/ash/3.4.8">Hex Preview</a>

          </span>

        <span class="line">
          <button class="a-main footer-button display-quick-switch" title="Search HexDocs packages">
            Search HexDocs
          </button>

            <a href="ash.epub" title="ePub version">
              Download ePub version
            </a>

        </span>
      </p>

      <p class="built-using">
        Built using
        <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.34.2) for the

          <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

      </p>

    </footer>
  </div>
</main>
</div>

  </body>
</html>
