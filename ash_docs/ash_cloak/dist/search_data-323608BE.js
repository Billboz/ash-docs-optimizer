searchData={"content_type":"text/markdown","items":[{"doc":"A function to call when decrypting any value. Takes the resource, field, records, and calculation context. Must return `:ok` or `{:error, error}`","ref":"dsl-ashcloak.html#cloak-on_decrypt","title":"AshCloak.cloak.on_decrypt","type":"DSL"},{"doc":"A list of attributes that should be decrypted (their calculation should be loaded) by default.","ref":"dsl-ashcloak.html#cloak-decrypt_by_default","title":"AshCloak.cloak.decrypt_by_default","type":"DSL"},{"doc":"The attribute or attributes to encrypt. The attribute will be renamed to `encrypted_{attribute}`, and a calculation with the same name will be added.","ref":"dsl-ashcloak.html#cloak-attributes","title":"AshCloak.cloak.attributes","type":"DSL"},{"doc":"The vault to use to encrypt & decrypt the value","ref":"dsl-ashcloak.html#cloak-vault","title":"AshCloak.cloak.vault","type":"DSL"},{"doc":"Encrypt attributes of a resource","ref":"dsl-ashcloak.html#cloak","title":"AshCloak.cloak","type":"DSL"},{"doc":"An extension for encrypting attributes of a resource.\n\nSee the getting started guide for more information.","ref":"AshCloak.html","title":"AshCloak","type":"module"},{"doc":"Hello!","ref":"AshCloak.html#cloak/1","title":"AshCloak.cloak/1","type":"macro"},{"doc":"Encrypts and writes to an encrypted attribute.\n\nIf the changeset is pending (i.e not currently running the action), then it is added as a before_action hook.\nOtherwise, it is run immediately","ref":"AshCloak.html#encrypt_and_set/3","title":"AshCloak.encrypt_and_set/3","type":"function"},{"doc":"Takes an argument, and encrypts it into an attribute called `encrypted_{attribute}`","ref":"AshCloak.Changes.Encrypt.html","title":"AshCloak.Changes.Encrypt","type":"module"},{"doc":"","ref":"AshCloak.Changes.Encrypt.html#atomic/3","title":"AshCloak.Changes.Encrypt.atomic/3","type":"function"},{"doc":"","ref":"AshCloak.Changes.Encrypt.html#change/3","title":"AshCloak.Changes.Encrypt.change/3","type":"function"},{"doc":"Mod Docs","ref":"AshCloak.Cloak.Options.html","title":"AshCloak.Cloak.Options","type":"module"},{"doc":"Hello 3","ref":"AshCloak.Cloak.Options.html#attributes/1","title":"AshCloak.Cloak.Options.attributes/1","type":"macro"},{"doc":"Hello 3","ref":"AshCloak.Cloak.Options.html#decrypt_by_default/1","title":"AshCloak.Cloak.Options.decrypt_by_default/1","type":"macro"},{"doc":"Hello 3","ref":"AshCloak.Cloak.Options.html#on_decrypt/1","title":"AshCloak.Cloak.Options.on_decrypt/1","type":"macro"},{"doc":"Hello 3","ref":"AshCloak.Cloak.Options.html#vault/1","title":"AshCloak.Cloak.Options.vault/1","type":"macro"},{"doc":"Introspection functions for the `AshCloak` extension.","ref":"AshCloak.Info.html","title":"AshCloak.Info","type":"module"},{"doc":"The attribute or attributes to encrypt. The attribute will be renamed to `encrypted_{attribute}`, and a calculation with the same name will be added.","ref":"AshCloak.Info.html#cloak_attributes/1","title":"AshCloak.Info.cloak_attributes/1","type":"function"},{"doc":"The attribute or attributes to encrypt. The attribute will be renamed to `encrypted_{attribute}`, and a calculation with the same name will be added.","ref":"AshCloak.Info.html#cloak_attributes!/1","title":"AshCloak.Info.cloak_attributes!/1","type":"function"},{"doc":"A list of attributes that should be decrypted (their calculation should be loaded) by default.","ref":"AshCloak.Info.html#cloak_decrypt_by_default/1","title":"AshCloak.Info.cloak_decrypt_by_default/1","type":"function"},{"doc":"A list of attributes that should be decrypted (their calculation should be loaded) by default.","ref":"AshCloak.Info.html#cloak_decrypt_by_default!/1","title":"AshCloak.Info.cloak_decrypt_by_default!/1","type":"function"},{"doc":"A function to call when decrypting any value. Takes the resource, field, records, and calculation context. Must return `:ok` or `{:error, error}`","ref":"AshCloak.Info.html#cloak_on_decrypt/1","title":"AshCloak.Info.cloak_on_decrypt/1","type":"function"},{"doc":"A function to call when decrypting any value. Takes the resource, field, records, and calculation context. Must return `:ok` or `{:error, error}`","ref":"AshCloak.Info.html#cloak_on_decrypt!/1","title":"AshCloak.Info.cloak_on_decrypt!/1","type":"function"},{"doc":"cloak DSL options\n\nReturns a map containing the and any configured or default values.","ref":"AshCloak.Info.html#cloak_options/1","title":"AshCloak.Info.cloak_options/1","type":"function"},{"doc":"The vault to use to encrypt & decrypt the value","ref":"AshCloak.Info.html#cloak_vault/1","title":"AshCloak.Info.cloak_vault/1","type":"function"},{"doc":"The vault to use to encrypt & decrypt the value","ref":"AshCloak.Info.html#cloak_vault!/1","title":"AshCloak.Info.cloak_vault!/1","type":"function"},{"doc":"![Logo](https://github.com/ash-project/ash/blob/main/logos/cropped-for-header-black-text.png?raw=true#gh-light-mode-only)\n![Logo](https://github.com/ash-project/ash/blob/main/logos/cropped-for-header-white-text.png?raw=true#gh-dark-mode-only)\n\n![Elixir CI](https://github.com/ash-project/ash_cloak/workflows/CI/badge.svg)\n[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)\n[![Hex version badge](https://img.shields.io/hexpm/v/ash_cloak.svg)](https://hex.pm/packages/ash_cloak)\n[![Hexdocs badge](https://img.shields.io/badge/docs-hexdocs-purple)](https://hexdocs.pm/ash_cloak)\n\n# AshCloak\n\nAshCloak is an [Ash](https://hexdocs.pm/ash) extension to seamlessly encrypt and decrypt attributes of your resources. \n\nEncrypting attributes ensures that sensitive fields are not stored in the clear in your data layer.\n\nAshCloak can be used with any Ash data layer.\n\nIt's recommended to use [Cloak](https://github.com/danielberkompas/cloak) as a vault implementation but you could also build your own.","ref":"readme.html","title":"Home","type":"extras"},{"doc":"- [Get Started with AshCloak](documentation/tutorials/getting-started-with-ash-cloak.md)","ref":"readme.html#tutorials","title":"Tutorials - Home","type":"extras"},{"doc":"- [How does AshCloak work?](documentation/topics/how-does-ash-cloak-work.md)","ref":"readme.html#topics","title":"Topics - Home","type":"extras"},{"doc":"- [AshCloak DSL](documentation/dsls/DSL:-AshCloak.md)","ref":"readme.html#reference","title":"Reference - Home","type":"extras"},{"doc":"# Get Started with AshCloak","ref":"getting-started-with-ash-cloak.html","title":"Get Started with AshCloak","type":"extras"},{"doc":"Add `ash_cloak` to your list of dependencies in `mix.exs`:\n\n```elixir\n{:ash_cloak, \"~> 0.1.2\"}\n```\n\nFollow [the cloak getting started guide](https://hexdocs.pm/cloak/readme.html) to add `cloak` as a dependency, as AshCloak does not add a vault implementation for you. Note that you do not need `cloak_ecto` because your Ash data layer will take care of this.\n\nAlternatively you could use your own vault module that implements `encrypt!` and `decrypt!`, but we recommend using `Cloak` to achieve that goal. See the [cloak vault guide](https://hexdocs.pm/cloak/install.html#create-a-vault)","ref":"getting-started-with-ash-cloak.html#installation","title":"Installation - Get Started with AshCloak","type":"extras"},{"doc":"```elixir\ndefmodule User do\n  use Ash.Resource, extensions: [AshCloak]\n\n  cloak do\n    # the vault to use to encrypt them\n    vault MyApp.Vault\n\n    # the attributes to encrypt\n    attributes [:address, :phone_number]\n    \n    # This is just equivalent to always providing `load: fields` on all calls\n    decrypt_by_default [:address]\n    \n    # An MFA or function to be invoked beforce any decryption\n    on_decrypt fn records, field, context ->\n      # Ash has policies that allow forbidding certain users to load data.\n      # You should generally use those for authorization rules, and\n      # only use this callback for auditing/logging.\n      Audit.user_accessed_encrypted_field(records, field, context)\n\n      if context.user.name == \"marty\" do\n        {:error, \"No martys at the party!\"}\n      else\n        :ok\n      end\n    end\n  end\nend\n```","ref":"getting-started-with-ash-cloak.html#add-the-ashcloak-extension-to-your-resource","title":"Add the `AshCloak` extension to your resource - Get Started with AshCloak","type":"extras"},{"doc":"# How does AshCloak work?","ref":"how-does-ash-cloak-work.html","title":"How does AshCloak work?","type":"extras"},{"doc":"First, AshCloak changes the name of each cloaked attribute to `encrypted_ `, and sets `public?: false` and `sensitive?: true`.\n\nThen it adds a _calculation_ matching the original attribute that, when loaded, will decrypt the given attribute and call any configured `on_decrypt` callbacks.","ref":"how-does-ash-cloak-work.html#rewrite-attributes-to-calculations","title":"Rewrite attributes to calculations - How does AshCloak work?","type":"extras"},{"doc":"AshCloak then goes through each action that accepts the attribute and removes the attribute from the accept list.\n\nThen it adds an argument by the same name, and a `change` that encrypts the attribute value.\n\nThis `change` also deletes the argument from the arguments list and from the params. This is a small extra layer of security to prevent accidental leakage of the value.","ref":"how-does-ash-cloak-work.html#modify-actions","title":"Modify Actions - How does AshCloak work?","type":"extras"},{"doc":"Finally, it add a `preparation` and a `change` that will automatically load the corresponding calculations for any attribute in the `decrypt_by_default` list.","ref":"how-does-ash-cloak-work.html#add-preparation-and-change","title":"Add `preparation` and `change` - How does AshCloak work?","type":"extras"},{"doc":"The cloaked attribute will now seamlessly encrypt when writing and decrypt on request.","ref":"how-does-ash-cloak-work.html#the-result","title":"The result - How does AshCloak work?","type":"extras"},{"doc":"<!--\nThis file was generated by Spark. Do not edit it by hand.\n-->\n# DSL: AshCloak\n\nAn extension for encrypting attributes of a resource.\n\nSee the getting started guide for more information.","ref":"dsl-ashcloak.html","title":"DSL: AshCloak","type":"extras"},{"doc":"Encrypt attributes of a resource","ref":"dsl-ashcloak.html#cloak","title":"cloak - DSL: AshCloak","type":"extras"},{"doc":"| Name | Type | Default | Docs |\n|------|------|---------|------|\n| [`vault`](#cloak-vault){: #cloak-vault .spark-required} | `module` |  | The vault to use to encrypt & decrypt the value |\n| [`attributes`](#cloak-attributes){: #cloak-attributes } | `atom \\| list(atom)` | `[]` | The attribute or attributes to encrypt. The attribute will be renamed to `encrypted_{attribute}`, and a calculation with the same name will be added. |\n| [`decrypt_by_default`](#cloak-decrypt_by_default){: #cloak-decrypt_by_default } | `atom \\| list(atom)` | `[]` | A list of attributes that should be decrypted (their calculation should be loaded) by default. |\n| [`on_decrypt`](#cloak-on_decrypt){: #cloak-on_decrypt } | `(any, any, any, any -> any) \\| mfa` |  | A function to call when decrypting any value. Takes the resource, field, records, and calculation context. Must return `:ok` or `{:error, error}` |\n\n\n\n\n\n\n\n .spark-required::after { content: \"*\"; color: red !important; }","ref":"dsl-ashcloak.html#options","title":"Options - DSL: AshCloak","type":"extras"},{"doc":"# Change Log\n\nAll notable changes to this project will be documented in this file.\nSee [Conventional Commits](Https://conventionalcommits.org) for commit guidelines.\n\n<!-- changelog -->\n\n## [v0.1.2](https://github.com/ash-project/ash_cloak/compare/v0.1.1...v0.1.2) (2024-08-19)","ref":"changelog.html","title":"Change Log","type":"extras"},{"doc":"* add atomic implementation for `AshCloack.Changes.Encrypt`\n\n## [v0.1.1](https://github.com/ash-project/ash_cloak/compare/v0.1.0...v0.1.1) (2024-08-02)","ref":"changelog.html#improvements","title":"Improvements: - Change Log","type":"extras"},{"doc":"- [`AshCloak.Changes.Encrypt`] run encrypt on before_action (#14)","ref":"changelog.html#bug-fixes","title":"Bug Fixes: - Change Log","type":"extras"},{"doc":"- [`AshCloak`] add `AshCloak.encrypt_and_set/3`\n\n## [v0.1.0](https://github.com/ash-project/ash_cloak/compare/v0.1.0-rc.0...v0.1.0) (2024-05-11)\n\n## [v0.1.0-rc.0](https://github.com/ash-project/ash_cloak/compare/v0.1.0...v0.1.0) (2024-04-25)\n\nInitial feature set","ref":"changelog.html#improvements","title":"Improvements: - Change Log","type":"extras"}],"producer":{"name":"ex_doc","version":[48,46,51,50,46,49]}}