searchData={"content_type":"text/markdown","items":[{"doc":"If set to `true`, detailed debug logging will be enabled for this trigger. You can also set `config :ash_oban, debug_all_triggers?: true` to enable debug logging for all triggers.","ref":"dsl-ashoban.html#oban-scheduled_actions-schedule-debug?","title":"AshOban.oban.scheduled_actions.schedule.debug?","type":"DSL"},{"doc":"A number from 0 to 3, where 0 is the highest priority and 3 is the lowest.","ref":"dsl-ashoban.html#oban-scheduled_actions-schedule-priority","title":"AshOban.oban.scheduled_actions.schedule.priority","type":"DSL"},{"doc":"How many times to attempt the job. The action will receive a `last_oban_attempt?` argument on the last attempt, and you should handle errors accordingly.\n","ref":"dsl-ashoban.html#oban-scheduled_actions-schedule-max_attempts","title":"AshOban.oban.scheduled_actions.schedule.max_attempts","type":"DSL"},{"doc":"Describes the state of the cron job. See the getting started guide for more information. The most important thing is that you *do not remove a scheduled action from a resource if you are using oban pro*.\n","ref":"dsl-ashoban.html#oban-scheduled_actions-schedule-state","title":"AshOban.oban.scheduled_actions.schedule.state","type":"DSL"},{"doc":"The queue to place the job in. Defaults to the resources short name plus the name of the scheduled action (not the action name).","ref":"dsl-ashoban.html#oban-scheduled_actions-schedule-queue","title":"AshOban.oban.scheduled_actions.schedule.queue","type":"DSL"},{"doc":"The generic or create action to call when the schedule is triggered.","ref":"dsl-ashoban.html#oban-scheduled_actions-schedule-action","title":"AshOban.oban.scheduled_actions.schedule.action","type":"DSL"},{"doc":"Inputs to supply to the action when it is called.","ref":"dsl-ashoban.html#oban-scheduled_actions-schedule-action_input","title":"AshOban.oban.scheduled_actions.schedule.action_input","type":"DSL"},{"doc":"The schedule in crontab notation","ref":"dsl-ashoban.html#oban-scheduled_actions-schedule-cron","title":"AshOban.oban.scheduled_actions.schedule.cron","type":"DSL"},{"doc":"A unique identifier for this scheduled action.","ref":"dsl-ashoban.html#oban-scheduled_actions-schedule-name","title":"AshOban.oban.scheduled_actions.schedule.name","type":"DSL"},{"doc":"","ref":"dsl-ashoban.html#oban-scheduled_actions-schedule","title":"AshOban.oban.scheduled_actions.schedule","type":"DSL"},{"doc":"A section for configured scheduled actions. Supports generic and create actions.\n","ref":"dsl-ashoban.html#oban-scheduled_actions","title":"AshOban.oban.scheduled_actions","type":"DSL"},{"doc":"An update action to call after the last attempt has failed. See the getting started guide for more.","ref":"dsl-ashoban.html#oban-triggers-trigger-on_error","title":"AshOban.oban.triggers.trigger.on_error","type":"DSL"},{"doc":"The filter expression to determine if something should be triggered","ref":"dsl-ashoban.html#oban-triggers-trigger-where","title":"AshOban.oban.triggers.trigger.where","type":"DSL"},{"doc":"The action to be triggered. Defaults to the identifier of the resource plus the name of the trigger","ref":"dsl-ashoban.html#oban-triggers-trigger-action","title":"AshOban.oban.triggers.trigger.action","type":"DSL"},{"doc":"The read action to use when fetching the individual records for the trigger. Defaults to `read_action`. If you customize this, ensure your action handles scenarios where the trigger is no longer relevant.\n","ref":"dsl-ashoban.html#oban-triggers-trigger-worker_read_action","title":"AshOban.oban.triggers.trigger.worker_read_action","type":"DSL"},{"doc":"The read action to use when querying records. Defaults to the primary read. This action *must* support keyset pagination.\n","ref":"dsl-ashoban.html#oban-triggers-trigger-read_action","title":"AshOban.oban.triggers.trigger.read_action","type":"DSL"},{"doc":"Describes the state of the cron job. See the getting started guide for more information. The most important thing is that you *do not remove a trigger from a resource if you are using oban pro*.\n","ref":"dsl-ashoban.html#oban-triggers-trigger-state","title":"AshOban.oban.triggers.trigger.state","type":"DSL"},{"doc":"Takes a record, and returns metadata to be given to the update action as an argument called `metadata`.\n","ref":"dsl-ashoban.html#oban-triggers-trigger-read_metadata","title":"AshOban.oban.triggers.trigger.read_metadata","type":"DSL"},{"doc":"How many times to attempt the job. After all attempts have been exhausted, the scheduler may just reschedule it. Use the `on_error` action to update the record to make the scheduler no longer apply.\n","ref":"dsl-ashoban.html#oban-triggers-trigger-max_attempts","title":"AshOban.oban.triggers.trigger.max_attempts","type":"DSL"},{"doc":"How many times to attempt scheduling of the triggered action.","ref":"dsl-ashoban.html#oban-triggers-trigger-max_scheduler_attempts","title":"AshOban.oban.triggers.trigger.max_scheduler_attempts","type":"DSL"},{"doc":"A number from 0 to 3, where 0 is the highest priority and 3 is the lowest.","ref":"dsl-ashoban.html#oban-triggers-trigger-scheduler_priority","title":"AshOban.oban.triggers.trigger.scheduler_priority","type":"DSL"},{"doc":"A number from 0 to 3, where 0 is the highest priority and 3 is the lowest.","ref":"dsl-ashoban.html#oban-triggers-trigger-worker_priority","title":"AshOban.oban.triggers.trigger.worker_priority","type":"DSL"},{"doc":"If true, logs that an error occurred on the final attempt to perform an action even if `log_errors?` is set to false.","ref":"dsl-ashoban.html#oban-triggers-trigger-log_final_error?","title":"AshOban.oban.triggers.trigger.log_final_error?","type":"DSL"},{"doc":"Whether or not to log errors that occur when performing an action.","ref":"dsl-ashoban.html#oban-triggers-trigger-log_errors?","title":"AshOban.oban.triggers.trigger.log_errors?","type":"DSL"},{"doc":"If set, any given run of the scheduler will only ever schedule this many items maximum","ref":"dsl-ashoban.html#oban-triggers-trigger-record_limit","title":"AshOban.oban.triggers.trigger.record_limit","type":"DSL"},{"doc":"The queue to place the worker job in. The trigger name is used by default.","ref":"dsl-ashoban.html#oban-triggers-trigger-queue","title":"AshOban.oban.triggers.trigger.queue","type":"DSL"},{"doc":"The batch size to pass when streaming records from using `Ash.stream!/2`. No batch size is passed if none is provided here, so the default is used.","ref":"dsl-ashoban.html#oban-triggers-trigger-stream_batch_size","title":"AshOban.oban.triggers.trigger.stream_batch_size","type":"DSL"},{"doc":"A crontab configuration for when the job should run. Defaults to once per minute (\"* * * * *\"). Use `false` to disable the scheduler entirely.\n","ref":"dsl-ashoban.html#oban-triggers-trigger-scheduler_cron","title":"AshOban.oban.triggers.trigger.scheduler_cron","type":"DSL"},{"doc":"If set to `true`, detailed debug logging will be enabled for this trigger. You can also set `config :ash_oban, debug_all_triggers?: true` to enable debug logging for all triggers.","ref":"dsl-ashoban.html#oban-triggers-trigger-debug?","title":"AshOban.oban.triggers.trigger.debug?","type":"DSL"},{"doc":"The queue to place the scheduler job in. The same queue as job is used by default (but with a priority of 1 so schedulers run first).","ref":"dsl-ashoban.html#oban-triggers-trigger-scheduler_queue","title":"AshOban.oban.triggers.trigger.scheduler_queue","type":"DSL"},{"doc":"Static inputs to supply to the update/destroy action when it is called. Any metadata produced by `read_metadata` will overwrite these values.","ref":"dsl-ashoban.html#oban-triggers-trigger-action_input","title":"AshOban.oban.triggers.trigger.action_input","type":"DSL"},{"doc":"A unique identifier for this trigger.","ref":"dsl-ashoban.html#oban-triggers-trigger-name","title":"AshOban.oban.triggers.trigger.name","type":"DSL"},{"doc":"","ref":"dsl-ashoban.html#oban-triggers-trigger","title":"AshOban.oban.triggers.trigger","type":"DSL"},{"doc":"","ref":"dsl-ashoban.html#oban-triggers","title":"AshOban.oban.triggers","type":"DSL"},{"doc":"The Domain to use when calling actions on this resource. Defaults to the resource's domain.","ref":"dsl-ashoban.html#oban-domain","title":"AshOban.oban.domain","type":"DSL"},{"doc":"","ref":"dsl-ashoban.html#oban","title":"AshOban.oban","type":"DSL"},{"doc":"A behaviour for storing and retrieving an actor from oban job arguments","ref":"AshOban.ActorPersister.html","title":"AshOban.ActorPersister","type":"behaviour"},{"doc":"","ref":"AshOban.ActorPersister.html#c:lookup/1","title":"AshOban.ActorPersister.lookup/1","type":"callback"},{"doc":"","ref":"AshOban.ActorPersister.html#c:store/1","title":"AshOban.ActorPersister.store/1","type":"callback"},{"doc":"","ref":"AshOban.ActorPersister.html#t:actor/0","title":"AshOban.ActorPersister.actor/0","type":"type"},{"doc":"","ref":"AshOban.ActorPersister.html#t:actor_json/0","title":"AshOban.ActorPersister.actor_json/0","type":"type"},{"doc":"Tools for working with AshOban triggers.","ref":"AshOban.html","title":"AshOban","type":"module"},{"doc":"","ref":"AshOban.html#authorize?/0","title":"AshOban.authorize?/0","type":"function"},{"doc":"Builds a specific trigger for the record provided, but does not insert it into the database.","ref":"AshOban.html#build_trigger/3","title":"AshOban.build_trigger/3","type":"function"},{"doc":"- `:actor` - the actor to set on the job. Requires configuring an actor persister.\n\nAll other options are passed through to `c:Oban.Worker.new/2`","ref":"AshOban.html#build_trigger/3-options","title":"Options - AshOban.build_trigger/3","type":"function"},{"doc":"Alters your oban configuration to include the required AshOban configuration.\n\n# Options\n\n* `:require?` (`t:boolean/0`) - Whether to require queues and plugins to be defined in your oban config. This can be helpful to\n  allow the ability to split queues between nodes. See https://hexdocs.pm/oban/splitting-queues.html The default value is `true`.","ref":"AshOban.html#config/3","title":"AshOban.config/3","type":"function"},{"doc":"","ref":"AshOban.html#do_schedule_and_run_triggers/2","title":"AshOban.do_schedule_and_run_triggers/2","type":"function"},{"doc":"","ref":"AshOban.html#lookup_actor/1","title":"AshOban.lookup_actor/1","type":"function"},{"doc":"Runs a specific trigger for the record provided.","ref":"AshOban.html#run_trigger/3","title":"AshOban.run_trigger/3","type":"function"},{"doc":"- `:actor` - the actor to set on the job. Requires configuring an actor persister.\n\nAll other options are passed through to `c:Oban.Worker.new/2`","ref":"AshOban.html#run_trigger/3-options","title":"Options - AshOban.run_trigger/3","type":"function"},{"doc":"Schedules all relevant jobs for the provided trigger or scheduled action","ref":"AshOban.html#schedule/3","title":"AshOban.schedule/3","type":"function"},{"doc":"`:actor` - the actor to set on the job. Requires configuring an actor persister.","ref":"AshOban.html#schedule/3-options","title":"Options - AshOban.schedule/3","type":"function"},{"doc":"Runs the schedulers for the given resource, domain, or otp_app, or list of resources, domains, or otp_apps.\n\nOptions:\n\n- `drain_queues?` - Defaults to false, drains the queues after scheduling. This is primarily for testing\n- `queue`, `with_limit`, `with_recursion`, `with_safety`, `with_scheduled` - passed through to `Oban.drain_queue/2`, if it is called\n- `scheduled_actions?` - Defaults to false, unless a scheduled action name was explicitly provided. Schedules all applicable scheduled actions.\n- `triggers?` - Defaults to true, schedules all applicable scheduled actions.\n- `actor` - The actor to schedule and run the triggers with\n- `oban` - The oban module to use. Defaults to `Oban`\n\nIf the input is:\n* a list - each item is passed into `schedule_and_run_triggers/1`, and the results are merged together.\n* an otp_app - each domain configured in the `ash_domains` of that otp_app is passed into `schedule_and_run_triggers/1`, and the results are merged together.\n* a domain - each reosurce configured in that domain is passed into `schedule_and_run_triggers/1`, and the results are merged together.\n* a tuple of {resource, :trigger_name} - that trigger is scheduled, and the results are merged together.\n* a resource - each trigger configured in that resource is scheduled, and the results are merged together.","ref":"AshOban.html#schedule_and_run_triggers/2","title":"AshOban.schedule_and_run_triggers/2","type":"function"},{"doc":"","ref":"AshOban.html#stacktrace/1","title":"AshOban.stacktrace/1","type":"function"},{"doc":"","ref":"AshOban.html#store_actor/2","title":"AshOban.store_actor/2","type":"function"},{"doc":"","ref":"AshOban.html#t:result/0","title":"AshOban.result/0","type":"type"},{"doc":"","ref":"AshOban.html#t:triggerable/0","title":"AshOban.triggerable/0","type":"type"},{"doc":"Builtin changes for `AshOban`","ref":"AshOban.Changes.BuiltinChanges.html","title":"AshOban.Changes.BuiltinChanges","type":"module"},{"doc":"","ref":"AshOban.Changes.BuiltinChanges.html#run_oban_trigger/2","title":"AshOban.Changes.BuiltinChanges.run_oban_trigger/2","type":"function"},{"doc":"Runs an oban trigger by name.","ref":"AshOban.Changes.RunObanTrigger.html","title":"AshOban.Changes.RunObanTrigger","type":"module"},{"doc":"","ref":"AshOban.Changes.RunObanTrigger.html#change/3","title":"AshOban.Changes.RunObanTrigger.change/3","type":"function"},{"doc":"This check is true if the context `private.ash_oban?` is set to true.\n\nThis context will only ever be set in code that is called internally by\n`ash_oban`, allowing you to create a bypass in your policies on your\nuser/user_token resources.\n\n```elixir\npolicies do\n  bypass AshObanInteraction do\n    authorize_if always()\n  end\nend\n```","ref":"AshOban.Checks.AshObanInteraction.html","title":"AshOban.Checks.AshObanInteraction","type":"module"},{"doc":"","ref":"AshOban.Checks.AshObanInteraction.html#requires_original_data?/2","title":"AshOban.Checks.AshObanInteraction.requires_original_data?/2","type":"function"},{"doc":"","ref":"AshOban.Checks.AshObanInteraction.html#strict_check/3","title":"AshOban.Checks.AshObanInteraction.strict_check/3","type":"function"},{"doc":"","ref":"AshOban.Checks.AshObanInteraction.html#type/0","title":"AshOban.Checks.AshObanInteraction.type/0","type":"function"},{"doc":"Introspection for AshOban","ref":"AshOban.Info.html","title":"AshOban.Info","type":"module"},{"doc":"The Domain to use when calling actions on this resource. Defaults to the resource's domain.","ref":"AshOban.Info.html#oban_domain/1","title":"AshOban.Info.oban_domain/1","type":"function"},{"doc":"The Domain to use when calling actions on this resource. Defaults to the resource's domain.","ref":"AshOban.Info.html#oban_domain!/1","title":"AshOban.Info.oban_domain!/1","type":"function"},{"doc":"oban DSL options\n\nReturns a map containing the and any configured or default values.","ref":"AshOban.Info.html#oban_options/1","title":"AshOban.Info.oban_options/1","type":"function"},{"doc":"","ref":"AshOban.Info.html#oban_scheduled_action/2","title":"AshOban.Info.oban_scheduled_action/2","type":"function"},{"doc":"oban.scheduled_actions DSL entities","ref":"AshOban.Info.html#oban_scheduled_actions/1","title":"AshOban.Info.oban_scheduled_actions/1","type":"function"},{"doc":"","ref":"AshOban.Info.html#oban_trigger/2","title":"AshOban.Info.oban_trigger/2","type":"function"},{"doc":"oban.triggers DSL entities","ref":"AshOban.Info.html#oban_triggers/1","title":"AshOban.Info.oban_triggers/1","type":"function"},{"doc":"","ref":"AshOban.Info.html#oban_triggers_and_scheduled_actions/1","title":"AshOban.Info.oban_triggers_and_scheduled_actions/1","type":"function"},{"doc":"","ref":"AshOban.Info.html#pro?/0","title":"AshOban.Info.pro?/0","type":"function"},{"doc":"A configured scheduled action.","ref":"AshOban.Schedule.html","title":"AshOban.Schedule","type":"module"},{"doc":"","ref":"AshOban.Schedule.html#t:t/0","title":"AshOban.Schedule.t/0","type":"type"},{"doc":"A configured trigger.","ref":"AshOban.Trigger.html","title":"AshOban.Trigger","type":"module"},{"doc":"","ref":"AshOban.Trigger.html#transform/1","title":"AshOban.Trigger.transform/1","type":"function"},{"doc":"","ref":"AshOban.Trigger.html#t:t/0","title":"AshOban.Trigger.t/0","type":"type"},{"doc":"Helpers for testing ash_oban triggers","ref":"AshOban.Test.html","title":"AshOban.Test","type":"module"},{"doc":"Calls `AshOban.schedule_and_run_triggers/2` with `drain_queues?: true`.","ref":"AshOban.Test.html#schedule_and_run_triggers/2","title":"AshOban.Test.schedule_and_run_triggers/2","type":"function"},{"doc":"Used when an invalid value is provided for an action argument","ref":"AshOban.Errors.TriggerNoLongerApplies.html","title":"AshOban.Errors.TriggerNoLongerApplies","type":"exception"},{"doc":"","ref":"AshOban.Errors.TriggerNoLongerApplies.html#exception/0","title":"AshOban.Errors.TriggerNoLongerApplies.exception/0","type":"function"},{"doc":"![Logo](https://github.com/ash-project/ash/blob/main/logos/cropped-for-header-black-text.png?raw=true#gh-light-mode-only)\n![Logo](https://github.com/ash-project/ash/blob/main/logos/cropped-for-header-white-text.png?raw=true#gh-dark-mode-only)\n\n![Elixir CI](https://github.com/ash-project/ash_oban/workflows/CI/badge.svg)\n[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)\n[![Hex version badge](https://img.shields.io/hexpm/v/ash_oban.svg)](https://hex.pm/packages/ash_oban)\n[![Hexdocs badge](https://img.shields.io/badge/docs-hexdocs-purple)](https://hexdocs.pm/ash_oban)\n\n# AshOban\n\nWelcome! This is the extension for integrating [Ash](https://hexdocs.pm/ash) resources with [Oban](https://hexdocs.pm/oban). This extension allows you to easily execute resource actions in the background, and trigger actions based on data conditions.","ref":"readme.html","title":"Home","type":"extras"},{"doc":"- [Getting Started with AshOban](documentation/tutorials/getting-started-with-ash-oban.md)","ref":"readme.html#tutorials","title":"Tutorials - Home","type":"extras"},{"doc":"- [AshOban DSL](documentation/dsls/DSL:-AshOban.md)","ref":"readme.html#reference","title":"Reference - Home","type":"extras"},{"doc":"# Getting Started With Ash Oban\n\nAshOban will likely grow to provide many more oban-related features, but for now the primary focus is on \"triggers\".\n\nA trigger describes an action that is run periodically.","ref":"getting-started-with-ash-oban.html","title":"Getting Started With Ash Oban","type":"extras"},{"doc":"If you haven't already, read the [Ash Getting Started Guide](https://hexdocs.pm/ash/get-started.html), and familiarize yourself with Ash and Ash resources.","ref":"getting-started-with-ash-oban.html#get-familiar-with-ash-resources","title":"Get familiar with Ash resources - Getting Started With Ash Oban","type":"extras"},{"doc":"```elixir\n{:ash_oban, \"~> 0.2.4\"}\n```","ref":"getting-started-with-ash-oban.html#bring-in-the-ash_oban-dependency","title":"Bring in the `ash_oban` dependency - Getting Started With Ash Oban","type":"extras"},{"doc":"First, follow the [Oban setup guide](https://hexdocs.pm/oban/installation.html).","ref":"getting-started-with-ash-oban.html#setup","title":"Setup - Getting Started With Ash Oban","type":"extras"},{"doc":"If you are using Oban Pro, set the following configuration:\n\n```elixir\nconfig :ash_oban, :pro?, true\n```\n\nOban Pro lives in a separate hex repository, and therefore we, unfortunately, cannot have an explicit version dependency on it.\nWhat this means is that any version you use in hex will technically be accepted, and if you don't have the oban pro package installed\nand you use the above configuration, you will get compile time errors/warnings.","ref":"getting-started-with-ash-oban.html#oban-pro","title":"Oban Pro - Getting Started With Ash Oban","type":"extras"},{"doc":"Next, allow AshOban to alter your configuration in your Application module:\n\n```elixir\n# Replace this\n{Oban, your_oban_config}\n\n# With this\n{Oban, AshOban.config(Application.fetch_env!(:my_app, :ash_domains), your_oban_config)}\n# OR this, to selectively enable AshOban only for specific domains\n{Oban, AshOban.config([YourDomain, YourOtherDomain], your_oban_config)}\n```","ref":"getting-started-with-ash-oban.html#setting-up-ashoban","title":"Setting up AshOban - Getting Started With Ash Oban","type":"extras"},{"doc":"Finally, configure your triggers in your resources.\n\nAdd the `AshOban` extension:\n\n```elixir\nuse Ash.Resource, domain: MyDomain, extensions: [AshOban]\n```\n\nFor example:\n\n```elixir\noban do\n  triggers do\n    # add a trigger called `:process`\n    trigger :process do\n      # this trigger calls the `process` action\n      action :process\n      # for any record that has `processed != true`\n      where expr(processed != true)\n      # checking for matches every minute\n      scheduler_cron \"* * * * *\"\n      on_error :errored\n    end\n  end\nend\n```\n\nSee the DSL documentation for more: [`AshOban`](/documentation/dsl/DSL:-AshOban.md)","ref":"getting-started-with-ash-oban.html#usage","title":"Usage - Getting Started With Ash Oban","type":"extras"},{"doc":"Error handling is done by adding an `on_error` to your trigger. This is an update action that will get the error as an argument called `:error`. The error will be an Ash error class. These error classes can contain many kinds of errors, so you will need to figure out handling specific errors on your own. Be sure to add the `:error` argument to the action if you want to receive the error.\n\nThis is _not_ foolproof. You want to be sure that your `on_error` action is as simple as possible, because if an exception is raised during the `on_error` action, the oban job will fail. If you are relying on your `on_error` logic to alter the resource to make it no longer apply to a trigger, consider making your action do _only that_. Then you can add another trigger watching for things in an errored state to do more rich error handling behavior.","ref":"getting-started-with-ash-oban.html#handling-errors","title":"Handling Errors - Getting Started With Ash Oban","type":"extras"},{"doc":"To remove or disable triggers, _do not just remove them from your resource_. Due to the way that Oban Pro implements cron jobs, if you just remove them from your resource, the cron will attempt to continue scheduling jobs. Instead, set `paused true` or `delete true` on the trigger. See the oban docs for more: https://getoban.pro/docs/pro/0.14.1/Oban.Pro.Plugins.DynamicCron.html#module-using-and-configuring\n\nPS: `delete true` is also indempotent, so there is no issue with deploying with that flag set to true multiple times. After you have deployed once with `delete true` you can safely delete the trigger.\n\nWhen not using Oban Pro, all crons are simply loaded on boot time and there is no side effects to simply deleting an unused trigger.","ref":"getting-started-with-ash-oban.html#changing-triggers-when-using-oban-pro","title":"Changing Triggers when using Oban Pro - Getting Started With Ash Oban","type":"extras"},{"doc":"AshOban adds two new transaction reasons, as it uses explicit transactions to ensure that each triggered record is properly locked and executed in serially.\n\n```elixir\n%{\n  type: :ash_oban_trigger,\n  metadata: %{\n    resource: Resource,\n    trigger: :trigger_name,\n    primary_key: %{primary_key_fields: value}\n  }\n}\n```\n\nand\n\n```elixir\n%{\n  type: :ash_oban_trigger_error,\n  metadata: %{\n    resource: Resource\n    trigger: :trigger_name,\n    primary_key: %{primary_key_fields: value},\n    error:  \n  }\n}\n```","ref":"getting-started-with-ash-oban.html#transactions","title":"Transactions - Getting Started With Ash Oban","type":"extras"},{"doc":"As of v0.2, `authorize?: true` is passed into every action that is called. This may be a breaking change for some users that are using policies. There are two ways to get around this:\n\n1. you can set `config :ash_oban, authorize?: false` (easiest, reverts to old behavior, but not recommended)\n2. you can install the bypass at the top of your policies in any resource that you have triggers on that has policies:\n\n```elixir\npolicies do\n  bypass AshOban.Checks.AshObanInteraction do\n    authorize_if always()\n  end\n\n  ...the rest of your policies\nend\n```","ref":"getting-started-with-ash-oban.html#authorizing-actions","title":"Authorizing actions - Getting Started With Ash Oban","type":"extras"},{"doc":"Create a module that is responsible for translating the current user to a value that will be JSON encoded, and for turning that encoded value back into an actor.\n\n```elixir\ndefmodule MyApp.AshObanActorPersister do\n  use AshOban.PersistActor\n\n  def store(%MyApp.User{id: id}), do: %{\"type\" => \"user\", \"id\" => id}\n\n  def lookup(%{\"type\" => \"user\", \"id\" => id}), do: MyApp.Accounts.get(MyApp.User, id)\n\n  # This allows you to set a default actor\n  # in cases where no actor was present\n  # when scheduling.\n  def lookup(nil), do: {:ok, nil}\nend\n```\n\nThen, configure this in application config.\n\n```elixir\nconfig :ash_oban, :actor_persister, MyApp.AshObanActorPersister\n```","ref":"getting-started-with-ash-oban.html#persisting-the-actor-along-with-a-job","title":"Persisting the actor along with a job - Getting Started With Ash Oban","type":"extras"},{"doc":"There are a few things that are important to keep in mind:\n\n1. The actor could be deleted or otherwise unavailable when you look it up. You very likely want your `lookup/1` to return an error in that scenario.\n\n2. The actor can have changed between when the job was scheduled and when the trigger is executing. It can even change across retries. If you are trying to authorize access for a given trigger's update action to a given actor, keep in mind that just because the trigger is running for a given action, does _not_ mean that the conditions that allowed them to originally _schedule_ that action are still true.","ref":"getting-started-with-ash-oban.html#considerations","title":"Considerations - Getting Started With Ash Oban","type":"extras"},{"doc":"<!--\nThis file was generated by Spark. Do not edit it by hand.\n-->\n# DSL: AshOban\n\nTools for working with AshOban triggers.","ref":"dsl-ashoban.html","title":"DSL: AshOban","type":"extras"},{"doc":"","ref":"dsl-ashoban.html#oban","title":"oban - DSL: AshOban","type":"extras"},{"doc":"* [triggers](#oban-triggers)\n   * trigger\n * [scheduled_actions](#oban-scheduled_actions)\n   * schedule","ref":"dsl-ashoban.html#nested-dsls","title":"Nested DSLs - DSL: AshOban","type":"extras"},{"doc":"```\noban do\n  triggers do\n    trigger :process do\n      action :process\n      where expr(processed != true)\n      worker_read_action(:read)\n    end\n  end\nend\n\n```","ref":"dsl-ashoban.html#examples","title":"Examples - DSL: AshOban","type":"extras"},{"doc":"| Name | Type | Default | Docs |\n|------|------|---------|------|\n| [`domain`](#oban-domain){: #oban-domain } | `module` |  | The Domain to use when calling actions on this resource. Defaults to the resource's domain. |","ref":"dsl-ashoban.html#options","title":"Options - DSL: AshOban","type":"extras"},{"doc":"","ref":"dsl-ashoban.html#oban-triggers","title":"oban.triggers - DSL: AshOban","type":"extras"},{"doc":"* [trigger](#oban-triggers-trigger)","ref":"dsl-ashoban.html#nested-dsls","title":"Nested DSLs - DSL: AshOban","type":"extras"},{"doc":"```\ntriggers do\n  trigger :process do\n    action :process\n    where expr(processed != true)\n    worker_read_action(:read)\n  end\nend\n\n```","ref":"dsl-ashoban.html#examples","title":"Examples - DSL: AshOban","type":"extras"},{"doc":"```elixir\ntrigger name\n```","ref":"dsl-ashoban.html#oban-triggers-trigger","title":"oban.triggers.trigger - DSL: AshOban","type":"extras"},{"doc":"```\ntrigger :process do\n  action :process\n  where expr(processed != true)\n  worker_read_action(:read)\nend\n\n```","ref":"dsl-ashoban.html#examples","title":"Examples - DSL: AshOban","type":"extras"},{"doc":"| Name | Type | Default | Docs |\n|------|------|---------|------|\n| [`name`](#oban-triggers-trigger-name){: #oban-triggers-trigger-name } | `atom` |  | A unique identifier for this trigger. |","ref":"dsl-ashoban.html#arguments","title":"Arguments - DSL: AshOban","type":"extras"},{"doc":"| Name | Type | Default | Docs |\n|------|------|---------|------|\n| [`action`](#oban-triggers-trigger-action){: #oban-triggers-trigger-action .spark-required} | `atom` |  | The action to be triggered. Defaults to the identifier of the resource plus the name of the trigger |\n| [`action_input`](#oban-triggers-trigger-action_input){: #oban-triggers-trigger-action_input } | `map` |  | Static inputs to supply to the update/destroy action when it is called. Any metadata produced by `read_metadata` will overwrite these values. |\n| [`scheduler_queue`](#oban-triggers-trigger-scheduler_queue){: #oban-triggers-trigger-scheduler_queue } | `atom` |  | The queue to place the scheduler job in. The same queue as job is used by default (but with a priority of 1 so schedulers run first). |\n| [`debug?`](#oban-triggers-trigger-debug?){: #oban-triggers-trigger-debug? } | `boolean` | `false` | If set to `true`, detailed debug logging will be enabled for this trigger. You can also set `config :ash_oban, debug_all_triggers?: true` to enable debug logging for all triggers. |\n| [`scheduler_cron`](#oban-triggers-trigger-scheduler_cron){: #oban-triggers-trigger-scheduler_cron } | `String.t \\| false` | `\"* * * * *\"` | A crontab configuration for when the job should run. Defaults to once per minute (\"* * * * *\"). Use `false` to disable the scheduler entirely. |\n| [`stream_batch_size`](#oban-triggers-trigger-stream_batch_size){: #oban-triggers-trigger-stream_batch_size } | `pos_integer` |  | The batch size to pass when streaming records from using `Ash.stream!/2`. No batch size is passed if none is provided here, so the default is used. |\n| [`queue`](#oban-triggers-trigger-queue){: #oban-triggers-trigger-queue } | `atom` |  | The queue to place the worker job in. The trigger name is used by default. |\n| [`record_limit`](#oban-triggers-trigger-record_limit){: #oban-triggers-trigger-record_limit } | `pos_integer` |  | If set, any given run of the scheduler will only ever schedule this many items maximum |\n| [`log_errors?`](#oban-triggers-trigger-log_errors?){: #oban-triggers-trigger-log_errors? } | `boolean` | `true` | Whether or not to log errors that occur when performing an action. |\n| [`log_final_error?`](#oban-triggers-trigger-log_final_error?){: #oban-triggers-trigger-log_final_error? } | `boolean` | `true` | If true, logs that an error occurred on the final attempt to perform an action even if `log_errors?` is set to false. |\n| [`worker_priority`](#oban-triggers-trigger-worker_priority){: #oban-triggers-trigger-worker_priority } | `non_neg_integer` | `2` | A number from 0 to 3, where 0 is the highest priority and 3 is the lowest. |\n| [`scheduler_priority`](#oban-triggers-trigger-scheduler_priority){: #oban-triggers-trigger-scheduler_priority } | `non_neg_integer` | `3` | A number from 0 to 3, where 0 is the highest priority and 3 is the lowest. |\n| [`max_scheduler_attempts`](#oban-triggers-trigger-max_scheduler_attempts){: #oban-triggers-trigger-max_scheduler_attempts } | `pos_integer` | `1` | How many times to attempt scheduling of the triggered action. |\n| [`max_attempts`](#oban-triggers-trigger-max_attempts){: #oban-triggers-trigger-max_attempts } | `pos_integer` | `1` | How many times to attempt the job. After all attempts have been exhausted, the scheduler may just reschedule it. Use the `on_error` action to update the record to make the scheduler no longer apply. |\n| [`read_metadata`](#oban-triggers-trigger-read_metadata){: #oban-triggers-trigger-read_metadata } | `(any -> any)` |  | Takes a record, and returns metadata to be given to the update action as an argument called `metadata`. |\n| [`state`](#oban-triggers-trigger-state){: #oban-triggers-trigger-state } | `:active \\| :paused \\| :deleted` | `:active` | Describes the state of the cron job. See the getting started guide for more information. The most important thing is that you *do not remove a trigger from a resource if you are using oban pro*. |\n| [`read_action`](#oban-triggers-trigger-read_action){: #oban-triggers-trigger-read_action } | `atom` |  | The read action to use when querying records. Defaults to the primary read. This action *must* support keyset pagination. |\n| [`worker_read_action`](#oban-triggers-trigger-worker_read_action){: #oban-triggers-trigger-worker_read_action } | `atom` |  | The read action to use when fetching the individual records for the trigger. Defaults to `read_action`. If you customize this, ensure your action handles scenarios where the trigger is no longer relevant. |\n| [`where`](#oban-triggers-trigger-where){: #oban-triggers-trigger-where } | `any` |  | The filter expression to determine if something should be triggered |\n| [`on_error`](#oban-triggers-trigger-on_error){: #oban-triggers-trigger-on_error } | `atom` |  | An update action to call after the last attempt has failed. See the getting started guide for more. |","ref":"dsl-ashoban.html#options","title":"Options - DSL: AshOban","type":"extras"},{"doc":"Target: `AshOban.Trigger`","ref":"dsl-ashoban.html#introspection","title":"Introspection - DSL: AshOban","type":"extras"},{"doc":"A section for configured scheduled actions. Supports generic and create actions.","ref":"dsl-ashoban.html#oban-scheduled_actions","title":"oban.scheduled_actions - DSL: AshOban","type":"extras"},{"doc":"* [schedule](#oban-scheduled_actions-schedule)","ref":"dsl-ashoban.html#nested-dsls","title":"Nested DSLs - DSL: AshOban","type":"extras"},{"doc":"```\nscheduled_actions do\n  schedule :import, \"0 */6 * * *\", action: :import\nend\n\n```","ref":"dsl-ashoban.html#examples","title":"Examples - DSL: AshOban","type":"extras"},{"doc":"```elixir\nschedule name, cron\n```","ref":"dsl-ashoban.html#oban-scheduled_actions-schedule","title":"oban.scheduled_actions.schedule - DSL: AshOban","type":"extras"},{"doc":"| Name | Type | Default | Docs |\n|------|------|---------|------|\n| [`name`](#oban-scheduled_actions-schedule-name){: #oban-scheduled_actions-schedule-name } | `atom` |  | A unique identifier for this scheduled action. |\n| [`cron`](#oban-scheduled_actions-schedule-cron){: #oban-scheduled_actions-schedule-cron } | `String.t` |  | The schedule in crontab notation |","ref":"dsl-ashoban.html#arguments","title":"Arguments - DSL: AshOban","type":"extras"},{"doc":"| Name | Type | Default | Docs |\n|------|------|---------|------|\n| [`action_input`](#oban-scheduled_actions-schedule-action_input){: #oban-scheduled_actions-schedule-action_input } | `map` |  | Inputs to supply to the action when it is called. |\n| [`action`](#oban-scheduled_actions-schedule-action){: #oban-scheduled_actions-schedule-action } | `atom` |  | The generic or create action to call when the schedule is triggered. |\n| [`queue`](#oban-scheduled_actions-schedule-queue){: #oban-scheduled_actions-schedule-queue } | `atom` |  | The queue to place the job in. Defaults to the resources short name plus the name of the scheduled action (not the action name). |\n| [`state`](#oban-scheduled_actions-schedule-state){: #oban-scheduled_actions-schedule-state } | `:active \\| :paused \\| :deleted` | `:active` | Describes the state of the cron job. See the getting started guide for more information. The most important thing is that you *do not remove a scheduled action from a resource if you are using oban pro*. |\n| [`max_attempts`](#oban-scheduled_actions-schedule-max_attempts){: #oban-scheduled_actions-schedule-max_attempts } | `pos_integer` | `1` | How many times to attempt the job. The action will receive a `last_oban_attempt?` argument on the last attempt, and you should handle errors accordingly. |\n| [`priority`](#oban-scheduled_actions-schedule-priority){: #oban-scheduled_actions-schedule-priority } | `non_neg_integer` | `3` | A number from 0 to 3, where 0 is the highest priority and 3 is the lowest. |\n| [`debug?`](#oban-scheduled_actions-schedule-debug?){: #oban-scheduled_actions-schedule-debug? } | `boolean` | `false` | If set to `true`, detailed debug logging will be enabled for this trigger. You can also set `config :ash_oban, debug_all_triggers?: true` to enable debug logging for all triggers. |","ref":"dsl-ashoban.html#options","title":"Options - DSL: AshOban","type":"extras"},{"doc":"Target: `AshOban.Schedule`\n\n\n\n\n\n\n\n .spark-required::after { content: \"*\"; color: red !important; }","ref":"dsl-ashoban.html#introspection","title":"Introspection - DSL: AshOban","type":"extras"},{"doc":"# Change Log\n\nAll notable changes to this project will be documented in this file.\nSee [Conventional Commits](Https://conventionalcommits.org) for commit guidelines.\n\n<!-- changelog -->\n\n## [v0.2.4](https://github.com/ash-project/ash_oban/compare/v0.2.3...v0.2.4) (2024-07-19)","ref":"changelog.html","title":"Change Log","type":"extras"},{"doc":"* loosen postgrex version requirement\n\n## [v0.2.3](https://github.com/ash-project/ash_oban/compare/v0.2.3-rc.1...v0.2.3) (2024-05-10)","ref":"changelog.html#improvements","title":"Improvements: - Change Log","type":"extras"},{"doc":"* plugins can just be modules\n\n## [v0.2.3-rc.1](https://github.com/ash-project/ash_oban/compare/v0.2.3-rc.0...v0.2.3-rc.1) (2024-04-03)","ref":"changelog.html#bug-fixes","title":"Bug Fixes: - Change Log","type":"extras"},{"doc":"* use `skip_unknown_inputs` to avoid unnecessary errors\n\n* oban pro state active (#22)\n\n* detect oban pro plugin usage and support dynamic queues (#20)\n\n## [v0.2.3-rc.0](https://github.com/ash-project/ash_oban/compare/v0.2.2...v0.2.3-rc.0) (2024-03-29)","ref":"changelog.html#bug-fixes","title":"Bug Fixes: - Change Log","type":"extras"},{"doc":"* update to ash 3.0\n\n## [v0.2.2](https://github.com/ash-project/ash_oban/compare/v0.2.1...v0.2.2) (2024-03-05)","ref":"changelog.html#improvements","title":"Improvements: - Change Log","type":"extras"},{"doc":"* properly catch when trigger no longer applies","ref":"changelog.html#bug-fixes","title":"Bug Fixes: - Change Log","type":"extras"},{"doc":"* validate primary keys provided for job scheduling\n\n* builds_trigger/3 to enable job composition without execution (#18)\n\n## [v0.2.1](https://github.com/ash-project/ash_oban/compare/v0.2.0...v0.2.1) (2024-02-28)","ref":"changelog.html#improvements","title":"Improvements: - Change Log","type":"extras"},{"doc":"* only drain queues when oban is in testing mode\n\n* properly discard all non applicable jobs","ref":"changelog.html#bug-fixes","title":"Bug Fixes: - Change Log","type":"extras"},{"doc":"* support `Oban.Pro.Testing.drain_jobs`\n\n## [v0.2.0](https://github.com/ash-project/ash_oban/compare/v0.1.14...v0.2.0) (2024-02-20)","ref":"changelog.html#improvements","title":"Improvements: - Change Log","type":"extras"},{"doc":"* authorize always by default","ref":"changelog.html#breaking-changes","title":"Breaking Changes: - Change Log","type":"extras"},{"doc":"* allow turning new authorization behavior off\n\n* add `actor_persister`, and use it automatically\n\n* authorize?: true always\n\n## [v0.1.14](https://github.com/ash-project/ash_oban/compare/v0.1.13...v0.1.14) (2024-02-16)","ref":"changelog.html#improvements","title":"Improvements: - Change Log","type":"extras"},{"doc":"* properly schedule scheduled actions\n\n## [v0.1.13](https://github.com/ash-project/ash_oban/compare/v0.1.12...v0.1.13) (2024-01-12)","ref":"changelog.html#improvements","title":"Improvements: - Change Log","type":"extras"},{"doc":"* Do not wrap `paused` and `delete` Cron options into `events` (#15)\n\n* properly honor the `drain_queues?` option\n\n## [v0.1.12](https://github.com/ash-project/ash_oban/compare/v0.1.11...v0.1.12) (2023-12-12)","ref":"changelog.html#bug-fixes","title":"Bug Fixes: - Change Log","type":"extras"},{"doc":"* make draining queues optional for `AshOban.schedule_and_run_triggers`\n\n## [v0.1.11](https://github.com/ash-project/ash_oban/compare/v0.1.10...v0.1.11) (2023-12-12)","ref":"changelog.html#improvements","title":"Improvements: - Change Log","type":"extras"},{"doc":"* move schedule_and_run_triggers to `AshOban`\n\n## [v0.1.10](https://github.com/ash-project/ash_oban/compare/v0.1.9...v0.1.10) (2023-12-07)","ref":"changelog.html#improvements","title":"Improvements: - Change Log","type":"extras"},{"doc":"* fallback clause to match valid configurations\n\n* add `cron` to opt schema\n\n* reverted part of refactor in 82cb0f90d9c0550c98ca5a8081ef8bd581c66e0d (#14)\n\n* nested pausing states under `events` option\n\n* only supply metadata if `read_metadata` is set\n\n* pass metadata argument on the udpate action","ref":"changelog.html#bug-fixes","title":"Bug Fixes: - Change Log","type":"extras"},{"doc":"* make `AshOban.Test` more configurable for scheduled actions\n\n* add `scheduled_action` for scheduling create/generic actions\n\n* log all errors by default, using `log_errors?` config\n\n* expose drain options to AshOban.Test.schedule_and_run_triggers (#12)\n\n* add `log_final_error?` and default it to `true`\n\n* don't log on raised exception, for consistency\n\n* support `require?: false` option on `config/3`.\n\n* support `action_input` on triggers\n\n## [v0.1.9](https://github.com/ash-project/ash_oban/compare/v0.1.8...v0.1.9) (2023-10-04)","ref":"changelog.html#improvements","title":"Improvements: - Change Log","type":"extras"},{"doc":"* more granular & more broad testing helpers\n\n* more debug logs, make debugging opt-in\n\n## [v0.1.8](https://github.com/ash-project/ash_oban/compare/v0.1.7...v0.1.8) (2023-09-16)","ref":"changelog.html#improvements","title":"Improvements: - Change Log","type":"extras"},{"doc":"* still validate queues even when no schedulers present\n\n## [v0.1.7](https://github.com/ash-project/ash_oban/compare/v0.1.6...v0.1.7) (2023-09-16)","ref":"changelog.html#improvements","title":"Improvements: - Change Log","type":"extras"},{"doc":"* don't schedule triggers with no scheduler\n\n* make override job options optional (#8)","ref":"changelog.html#bug-fixes","title":"Bug Fixes: - Change Log","type":"extras"},{"doc":"* support providing an otp app to schedule and run triggers\n\n* support apis/resources for ash_oban\n\n* support overriding job opts in run_trigger (#7)\n\n* support destroy actions in the trigger action\n\n* debug logs\n\n## [v0.1.6](https://github.com/ash-project/ash_oban/compare/v0.1.5...v0.1.6) (2023-08-29)","ref":"changelog.html#improvements","title":"Improvements: - Change Log","type":"extras"},{"doc":"* verify trigger action exists in transformer","ref":"changelog.html#bug-fixes","title":"Bug Fixes: - Change Log","type":"extras"},{"doc":"* use read_metadata when manually scheduling\n\n* allow `false` as the value for `scheduler_cron`\n\n* add worker/scheduler priorities\n\n## [v0.1.5](https://github.com/ash-project/ash_oban/compare/v0.1.4...v0.1.5) (2023-08-15)","ref":"changelog.html#improvements","title":"Improvements: - Change Log","type":"extras"},{"doc":"* use same read_action in handle_error and in work\n\n* another syntax issue with `drain_queue/2`\n\n* drain_queue syntax issue\n\n* Update base engine to support rename Oban.Pro.Engines.Smart","ref":"changelog.html#bug-fixes","title":"Bug Fixes: - Change Log","type":"extras"},{"doc":"* only invoke error handler on last attempt\n\n* drain each queue twice\n\n* add test helper for running triggers\n\n* trigger_read_action, defaulting to read action\n\n* read with primary read for trigger\n\n* log error on scheduler failure\n\n## [v0.1.4](https://github.com/ash-project/ash_oban/compare/v0.1.3...v0.1.4) (2023-06-10)","ref":"changelog.html#improvements","title":"Improvements: - Change Log","type":"extras"},{"doc":"* support `record_limit` to limit max processed records\n\n## [v0.1.3](https://github.com/ash-project/ash_oban/compare/v0.1.2...v0.1.3) (2023-05-18)","ref":"changelog.html#improvements","title":"Improvements: - Change Log","type":"extras"},{"doc":"* properly raise errors instead of swallowing them\n\n* don't use `authorize?: false` for operations.\n\n## [v0.1.2](https://github.com/ash-project/ash_oban/compare/v0.1.1...v0.1.2) (2023-05-08)","ref":"changelog.html#bug-fixes","title":"Bug Fixes: - Change Log","type":"extras"},{"doc":"* make scheduler default queue the same as worker\n\n## [v0.1.1](https://github.com/ash-project/ash_oban/compare/v0.1.0...v0.1.1) (2023-05-01)","ref":"changelog.html#improvements","title":"Improvements: - Change Log","type":"extras"},{"doc":"* add_error/1 does not exist\n\n* `insert_all/1` not `insert_all!/1`","ref":"changelog.html#bug-fixes","title":"Bug Fixes: - Change Log","type":"extras"},{"doc":"* handle actions w/ before_transaction/after_transaction hooks better\n\n## [v0.1.0](https://github.com/ash-project/ash_oban/compare/v0.1.0...v0.1.0) (2023-04-28)","ref":"changelog.html#improvements","title":"Improvements: - Change Log","type":"extras"},{"doc":"* initial feature set","ref":"changelog.html#features","title":"Features: - Change Log","type":"extras"}],"producer":{"name":"ex_doc","version":[48,46,51,52,46,50]}}